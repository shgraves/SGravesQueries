<?xml version="1.0" encoding="utf-8"?>
<Report ID="Dashboards.Acquisitions.NewCustomerDashboard" SavedBy="JOMAX\shgraves" SavedAt="1/23/2015 10:09:16 AM" EngineVersion="11.0.43" SecurityReportRightID="LogiCT">
  <StyleSheet Theme="GDRPortal" StyleSheet="ERHubTheme.css" />
  <DefaultRequestParams PanelHeight="400" PanelWidth="400" rptDay="@Date.Today~" />
  <DefaultRequestParams islNewCustTrendChannel="All Channels" islNewCustTrendRegion="All Regions" rptMonth="=DateAdd(&quot;m&quot;, DateDiff(&quot;m&quot;, &quot;1900-01-01&quot;, DateAdd(&quot;d&quot;,-1, &quot;@Request.rptDay~&quot;)),&quot;1900-01-01&quot;)" rptCurrentMonth="=DateAdd(&quot;m&quot;, DateDiff(&quot;m&quot;, &quot;1900-01-01&quot;, DateAdd(&quot;d&quot;,-1, &quot;@Date.Today~&quot;)),&quot;1900-01-01&quot;)" />
  <LocalData ID="ldEconDays" IdeDisplayStatus="Collapsed">
    <DataLayer Type="SQL" ID="dlEconDays" ConnectionID="connM1BIG-biLogiReporting" Source="DECLARE @startDate 	DATE&#xD;&#xA;DECLARE @endDate   	DATE&#xD;&#xA;&#xD;&#xA;declare @output table(&#xD;&#xA;	econDays_mtd 		FLOAT	DEFAULT 0.0&#xD;&#xA;	, econDays_monthEnd	FLOAT	DEFAULT 0.0&#xD;&#xA;	, econDays_14d		FLOAT	DEFAULT 0.0&#xD;&#xA;	)&#xD;&#xA;&#xD;&#xA;SET @startDate = CASE WHEN '@Request.rptMonth~' &lt; DATEADD(DAY, -14, '@Request.rptDay~') THEN '@Request.rptMonth~' ELSE DATEADD(DAY, -14, '@Request.rptDay~') END&#xD;&#xA;SET @endDate = CASE WHEN '@Request.rptDay~' &lt; DATEADD(MONTH, 1, '@Request.rptMonth~') THEN DATEADD(MONTH, 1, '@Request.rptMonth~') ELSE '@Request.rptDay~' END&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;INSERT INTO @output(&#xD;&#xA;	econDays_mtd&#xD;&#xA;	, econDays_monthEnd&#xD;&#xA;	, econDays_14d&#xD;&#xA;	)&#xD;&#xA;SELECT &#xD;&#xA;	econDays_mtd = SUM(CASE WHEN acquisitionDate &gt;= '@Request.rptMonth~' AND acquisitionDate &lt; '@Request.rptDay~' THEN economicdays ELSE 0 END)&#xD;&#xA;	, econDays_monthEnd = SUM(CASE WHEN acquisitionDate &gt;= '@Request.rptMonth~' AND acquisitionDate &lt; DATEADD(MONTH, 1, '@Request.rptMonth~') THEN economicDays ELSE 0 END)&#xD;&#xA;	, econDays_14d = SUM(CASE WHEN acquisitionDate &gt;= DATEADD(DAY, -14, '@Request.rptDay~') and acquisitionDate &lt; '@Request.rptDay~' THEN economicDays ELSE 0 END)&#xD;&#xA;FROM &#xD;&#xA;	BiLogiReporting.dbo.rptNewCustomerEconomicDays rNCED WITH (NOLOCK)&#xD;&#xA;WHERE&#xD;&#xA;	acquisitionDate &gt;= @startDate&#xD;&#xA;	AND acquisitionDate &lt; @endDate&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;SELECT &#xD;&#xA;	econDays_mtd&#xD;&#xA;	, econDays_monthEnd&#xD;&#xA;	, econDays_14d&#xD;&#xA;FROM &#xD;&#xA;	@output&#xD;&#xA;	" />
  </LocalData>
  <LocalData ID="ldNCForecast">
    <DataLayer Type="SQL" Source="SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;&#xD;&#xA;SET NOCOUNT ON;&#xD;&#xA;SET STATISTICS IO OFF;&#xD;&#xA;SET STATISTICS TIME OFF;&#xD;&#xA;&#xD;&#xA;/********************/&#xD;&#xA;/*  Declarations    */&#xD;&#xA;/************************************************************************************************************************/&#xD;&#xA;/*  This section defined variables and constants used in the programs                                                   */&#xD;&#xA;/************************************************************************************************************************/&#xD;&#xA;&#xD;&#xA;    /********************************************************************************************************************/&#xD;&#xA;    /*  Standard variable values                                                                                        */&#xD;&#xA;    /********************************************************************************************************************/&#xD;&#xA;	DECLARE @true	INT = 1&#xD;&#xA;	DECLARE @false 	INT = 0&#xD;&#xA;&#xD;&#xA;    /********************************************************************************************************************/&#xD;&#xA;    /*	Pre-Defined Constants																							*/&#xD;&#xA;    /********************************************************************************************************************/&#xD;&#xA;	&#xD;&#xA;    /********************************************************************************************************************/&#xD;&#xA;    /*	Passed Variables                                                                                                */&#xD;&#xA;    /********************************************************************************************************************/&#xD;&#xA;	DECLARE @start 				DATE = '@Request.rptMonth~'&#xD;&#xA;	DECLARE @end 				DATE = '@Request.rptDay~'&#xD;&#xA;	DECLARE @current 			DATE = '@Request.rptCurrentMonth~'&#xD;&#xA;&#xD;&#xA;    /********************************************************************************************************************/&#xD;&#xA;    /*	Variables set during the course of the code execution															*/&#xD;&#xA;    /********************************************************************************************************************/&#xD;&#xA;	DECLARE @isCurrentMonth 	INT = CASE WHEN @start = @current THEN @true ELSE @false END&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;/********************/&#xD;&#xA;/*  Processing		*/&#xD;&#xA;/********************************************************************************************************************/&#xD;&#xA;/*  If current month, use input forecast; if prior month, use actual MTD values										*/&#xD;&#xA;/********************************************************************************************************************/&#xD;&#xA;&#xD;&#xA;	IF @isCurrentMonth = @true &#xD;&#xA;		BEGIN&#xD;&#xA;			SELECT TOP 1 NCForecast, REPLACE(CONVERT(VARCHAR, CONVERT(MONEY, NCForecast),1),'.00','') AS NCForecastText&#xD;&#xA;			FROM [BiLogiReporting].[dbo].[rptNewCustomerDashboardParameters] WITH (NOLOCK)&#xD;&#xA;			OPTION (MAXDOP 1);&#xD;&#xA;		END&#xD;&#xA;	ELSE&#xD;&#xA;		BEGIN&#xD;&#xA;			SELECT SUM(newCusts) AS NCForecast, REPLACE(CONVERT(VARCHAR, CONVERT(MONEY, SUM(newCusts)),1),'.00','') AS NCForecastText&#xD;&#xA;			FROM [BiLogiReporting].[dbo].[rptNewCustomerDaily_new] WITH (NOLOCK)&#xD;&#xA;			WHERE rptDate &gt;= @start AND rptDate &lt; DATEADD(MONTH, 1, @start)&#xD;&#xA;			OPTION (MAXDOP 1);&#xD;&#xA;		END&#xD;&#xA;		&#xD;&#xA;    &#xD;&#xA;&#xD;&#xA;&#xD;&#xA;" ConnectionID="connM1BIG-BIGReporting" ID="dlNCForecast" />
  </LocalData>
  <LocalData ID="ldNewCustomerTotals">
    <DataLayer Type="SQL" Source="/********************************************************************************************************************&#xD;&#xA;    Name:			Total New Customers&#xD;&#xA;    Author:			Scott Cooper&#xD;&#xA;    Create Date:	2013/05/01&#xD;&#xA;    Description:	This calculates total new customer information across all regions and channels.  It collects info&#xD;&#xA;                        at the channel/subcategory level, applies a factor based on the past 14 days, then returns&#xD;&#xA;                        overall totals as the sum of those channel/subcategory results.&#xD;&#xA;	&#xD;&#xA;    Processing:&#xD;&#xA;&#xD;&#xA;    Assumptions / Special Processing:&#xD;&#xA;&#xD;&#xA;    User-Defined Variables used to influence execution flow:&#xD;&#xA;	    @start				DATE			/*  Start Date for measurement (beginning of month)		*/&#xD;&#xA;		@end				DATE			/*	End Date for measurement							*/&#xD;&#xA;		@current			DATE			/*	Current Month start date							*/&#xD;&#xA;		@isCurrentMonth		INT				/*	Is measurement month same as current month?			*/&#xD;&#xA;		@econDays_mtd  		FLOAT 			/*	Economic days MTD									*/&#xD;&#xA;		@econDays_monthEnd 	FLOAT 			/*	Economic days for full measurement month			*/&#xD;&#xA;		@econDays_14d 		FLOAT 			/*	Economic days for past 14 days						*/&#xD;&#xA;&#xD;&#xA;	Temporary Tables Utilized:&#xD;&#xA;        @output             Table containing results to display&#xD;&#xA;&#xD;&#xA;    Modifications:&#xD;&#xA;        20130501    Scott Cooper			Initial Coding&#xD;&#xA;&#xD;&#xA;*******************************************************************************************************************/&#xD;&#xA;SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;&#xD;&#xA;SET NOCOUNT ON;&#xD;&#xA;SET STATISTICS IO OFF;&#xD;&#xA;SET STATISTICS TIME OFF;&#xD;&#xA;&#xD;&#xA;/********************/&#xD;&#xA;/*  Declarations    */&#xD;&#xA;/************************************************************************************************************************/&#xD;&#xA;/*  This section defined variables and constants used in the programs                                                   */&#xD;&#xA;/************************************************************************************************************************/&#xD;&#xA;&#xD;&#xA;    /********************************************************************************************************************/&#xD;&#xA;    /*  Standard variable values                                                                                        */&#xD;&#xA;    /********************************************************************************************************************/&#xD;&#xA;	DECLARE @true	INT = 1&#xD;&#xA;	DECLARE @false 	INT = 0&#xD;&#xA;&#xD;&#xA;    /********************************************************************************************************************/&#xD;&#xA;    /*	Pre-Defined Constants																							*/&#xD;&#xA;    /********************************************************************************************************************/&#xD;&#xA;	&#xD;&#xA;    /********************************************************************************************************************/&#xD;&#xA;    /*	Passed Variables                                                                                                */&#xD;&#xA;    /********************************************************************************************************************/&#xD;&#xA;	DECLARE @start 				DATE = '@Request.rptMonth~'&#xD;&#xA;	DECLARE @end 				DATE = '@Request.rptDay~'&#xD;&#xA;	DECLARE @current 			DATE = '@Request.rptCurrentMonth~'&#xD;&#xA;&#xD;&#xA;    /********************************************************************************************************************/&#xD;&#xA;    /*	Variables set during the course of the code execution															*/&#xD;&#xA;    /********************************************************************************************************************/&#xD;&#xA;	DECLARE @isCurrentMonth 	INT = CASE WHEN @start = @current THEN @true ELSE @false END&#xD;&#xA;&#xD;&#xA;	DECLARE @econDays_mtd  		FLOAT &#xD;&#xA;	DECLARE @econDays_monthEnd 	FLOAT &#xD;&#xA;	DECLARE @econDays_14d 		FLOAT &#xD;&#xA;&#xD;&#xA;&#xD;&#xA;/********************/&#xD;&#xA;/*  Initial Setup   */&#xD;&#xA;/********************************************************************************************************************/&#xD;&#xA;/*  This section creates the needed table structures and assigns the promo codes and pf_IDs to be measured          */&#xD;&#xA;/********************************************************************************************************************/&#xD;&#xA;&#xD;&#xA;	DECLARE @output TABLE(&#xD;&#xA;		region 				VARCHAR(50)&#xD;&#xA;		, channel 			VARCHAR(50)&#xD;&#xA;		, subCategory		VARCHAR(50)&#xD;&#xA;		, newCustsMTD 		INT 			DEFAULT 0&#xD;&#xA;		, newCusts14d 		INT 			DEFAULT 0&#xD;&#xA;		, rate14d 			FLOAT 			DEFAULT 0&#xD;&#xA;		, newCustsMonthEnd 	FLOAT 			DEFAULT 0&#xD;&#xA;		, newCustsPY 		INT				DEFAULT 0&#xD;&#xA;		, newCustsPYMTD		INT				DEFAULT 0&#xD;&#xA;		)&#xD;&#xA;&#xD;&#xA;/********************/&#xD;&#xA;/*  Processing		*/&#xD;&#xA;/********************************************************************************************************************/&#xD;&#xA;/*  This section processes the needed information																	*/&#xD;&#xA;/********************************************************************************************************************/&#xD;&#xA;	SELECT @econDays_mtd = sum(economicDays) from biLogiReporting.dbo.rptNewCustomerEconomicDays d (nolock) where acquisitionDate &gt;= @start and acquisitionDate &lt; @end&#xD;&#xA;	SELECT @econDays_monthEnd = sum(economicDays) from biLogiReporting.dbo.rptNewCustomerEconomicDays d (nolock) where acquisitionDate &gt;= @start and acquisitionDate &lt; dateadd(month, 1, @start)&#xD;&#xA;	SELECT @econDays_14d = sum(economicDays) from biLogiReporting.dbo.rptNewCustomerEconomicDays d (nolock) where acquisitionDate &gt;= dateadd(d,-14,@end) and acquisitionDate &lt; @end&#xD;&#xA;&#xD;&#xA;	-- populate the regions, subcategories &amp; channels&#xD;&#xA;	INSERT INTO @output(&#xD;&#xA;		region&#xD;&#xA;		, channel&#xD;&#xA;		, subCategory&#xD;&#xA;		)&#xD;&#xA;	SELECT DISTINCT &#xD;&#xA;		Region&#xD;&#xA;		, Channel&#xD;&#xA;		, SubCategory &#xD;&#xA;	FROM &#xD;&#xA;		[BiLogiReporting].[dbo].[rptNewCustomerDaily_new] WITH (NOLOCK)&#xD;&#xA;    WHERE&#xD;&#xA;    	rptDate &gt;= DATEADD(YEAR, -1, @start)&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;    -- update w/current new customers (last 14 days)&#xD;&#xA;	UPDATE &#xD;&#xA;		o&#xD;&#xA;	SET &#xD;&#xA;		region = x.region&#xD;&#xA;		, channel = x.channel&#xD;&#xA;		, subCategory = x.subcategory&#xD;&#xA;		, newCusts14d = x.newCusts14d&#xD;&#xA;		, rate14d = x.rate14d&#xD;&#xA;	FROM &#xD;&#xA;		@output o&#xD;&#xA;		INNER JOIN &#xD;&#xA;			(&#xD;&#xA;				SELECT&#xD;&#xA;					Region&#xD;&#xA;					, Channel&#xD;&#xA;					, SubCategory&#xD;&#xA;					, SUM(NewCusts) AS newCusts14d&#xD;&#xA;					, SUM(NewCusts) / @econDays_14d AS rate14d&#xD;&#xA;				FROM &#xD;&#xA;					[BiLogiReporting].[dbo].[rptNewCustomerDaily_new] nc WITH (NOLOCK)&#xD;&#xA;				WHERE&#xD;&#xA;					rptDate &gt;= DATEADD(DAY, -14, @end) &#xD;&#xA;					AND rptDate &lt; @end&#xD;&#xA;				GROUP BY &#xD;&#xA;					Region&#xD;&#xA;					, Channel&#xD;&#xA;					, SubCategory&#xD;&#xA;			) x &#xD;&#xA;			ON o.Region = x.Region &#xD;&#xA;			AND o.Channel = x.Channel&#xD;&#xA;			AND o.SubCategory = x.SubCategory&#xD;&#xA;	OPTION (MAXDOP 1);&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;	-- update w/actual MTD numbers and project ME numbers&#xD;&#xA;	UPDATE &#xD;&#xA;		o&#xD;&#xA;	SET &#xD;&#xA;		newCustsMTD = x.newCustsMTD&#xD;&#xA;    	, newCustsMonthEnd = CASE WHEN @isCurrentMonth = @true THEN COALESCE(x.newCustsMTD, 0) + (@econDays_monthEnd - @econDays_mtd) * o.rate14d ELSE 0 END&#xD;&#xA;	FROM &#xD;&#xA;		@output o&#xD;&#xA;	LEFT OUTER JOIN&#xD;&#xA;		(&#xD;&#xA;			SELECT &#xD;&#xA;				Region&#xD;&#xA;				, Channel&#xD;&#xA;				, SuBCategory&#xD;&#xA;				, SUM(NewCusts) AS newCustsMTD&#xD;&#xA;			FROM &#xD;&#xA;				[BiLogiReporting].[dbo].[rptNewCustomerDaily_new] nc WITH (NOLOCK)&#xD;&#xA;			WHERE&#xD;&#xA;				rptDate &gt;= @start &#xD;&#xA;				AND rptDate &lt; @end&#xD;&#xA;			GROUP BY &#xD;&#xA;				Region&#xD;&#xA;				, Channel&#xD;&#xA;				, SubCategory&#xD;&#xA;		) x &#xD;&#xA;		ON o.Region = x.Region &#xD;&#xA;		AND o.Channel = x.Channel&#xD;&#xA;		AND o.SubCategory = x.SubCategory&#xD;&#xA;	OPTION (MAXDOP 1);&#xD;&#xA;&#xD;&#xA;    	&#xD;&#xA;	-- update w/actual PY numbers&#xD;&#xA;	UPDATE&#xD;&#xA;		o&#xD;&#xA;	SET &#xD;&#xA;		newCustsPY = x.newCustsPY&#xD;&#xA;	FROM &#xD;&#xA;		@output o&#xD;&#xA;		INNER JOIN&#xD;&#xA;			(&#xD;&#xA;				SELECT&#xD;&#xA;					Region&#xD;&#xA;					, Channel&#xD;&#xA;					, SubCategory&#xD;&#xA;					, SUM (NewCusts) AS newCustsPY&#xD;&#xA;				FROM &#xD;&#xA;					[BiLogiReporting].[dbo].[rptNewCustomerDaily_new] nc WITH (NOLOCK)&#xD;&#xA;				WHERE&#xD;&#xA;					rptDate &gt;= DATEADD(YEAR, -1, @start) &#xD;&#xA;					AND rptDate &lt; DATEADD(YEAR, -1, DATEADD(MONTH, 1, @start))&#xD;&#xA;				GROUP BY &#xD;&#xA;					Region&#xD;&#xA;					, Channel&#xD;&#xA;					, SubCategory&#xD;&#xA;			) x &#xD;&#xA;			ON o.Region = x.Region &#xD;&#xA;			AND o.Channel = x.Channel&#xD;&#xA;			AND o.SubCategory = x.SubCategory&#xD;&#xA;&#xD;&#xA;	-- update w/actual PY MTD numbers&#xD;&#xA;	UPDATE &#xD;&#xA;		o&#xD;&#xA;	SET &#xD;&#xA;		newCustsPYMTD = x.newCustsPYMTD&#xD;&#xA;	FROM &#xD;&#xA;		@output o&#xD;&#xA;	LEFT OUTER JOIN&#xD;&#xA;		(&#xD;&#xA;			SELECT &#xD;&#xA;				Region&#xD;&#xA;				, Channel&#xD;&#xA;				, SuBCategory&#xD;&#xA;				, SUM(NewCusts) AS newCustsPYMTD&#xD;&#xA;			FROM &#xD;&#xA;				[BiLogiReporting].[dbo].[rptNewCustomerDaily_new] nc WITH (NOLOCK)&#xD;&#xA;			WHERE&#xD;&#xA;				rptDate &gt;= DATEADD(YEAR, -1, @start)&#xD;&#xA;				AND rptDate &lt; DATEADD(YEAR, -1, @end)&#xD;&#xA;			GROUP BY &#xD;&#xA;				Region&#xD;&#xA;				, Channel&#xD;&#xA;				, SubCategory&#xD;&#xA;		) x &#xD;&#xA;		ON o.Region = x.Region &#xD;&#xA;		AND o.Channel = x.Channel&#xD;&#xA;		AND o.SubCategory = x.SubCategory&#xD;&#xA;	OPTION (MAXDOP 1);&#xD;&#xA;&#xD;&#xA;	-- if not current month, set MTD totals = actual MTD totals, not projections&#xD;&#xA;	IF @isCurrentMonth = @false&#xD;&#xA;		BEGIN&#xD;&#xA;			UPDATE &#xD;&#xA;				o&#xD;&#xA;			SET &#xD;&#xA;				newCustsMonthEnd = x.newCustsMonthEnd&#xD;&#xA;			FROM &#xD;&#xA;				@output o&#xD;&#xA;				INNER JOIN &#xD;&#xA;					(&#xD;&#xA;						SELECT&#xD;&#xA;							Region&#xD;&#xA;							, Channel&#xD;&#xA;							, SubCategory&#xD;&#xA;							, SUM(NewCusts) AS newCustsMonthEnd&#xD;&#xA;						FROM &#xD;&#xA;							[BiLogiReporting].[dbo].[rptNewCustomerDaily_new] nc WITH (NOLOCK)&#xD;&#xA;						WHERE&#xD;&#xA;							rptDate &gt;= @start&#xD;&#xA;							AND rptDate &lt; DATEADD(MONTH, 1, @start)&#xD;&#xA;						GROUP BY &#xD;&#xA;							Region&#xD;&#xA;							, Channel&#xD;&#xA;							, SubCategory&#xD;&#xA;					) x &#xD;&#xA;					ON o.Region = x.Region &#xD;&#xA;					AND o.Channel = x.Channel&#xD;&#xA;					AND o.SubCategory = x.SubCategory&#xD;&#xA;			OPTION (MAXDOP 1);&#xD;&#xA;		END&#xD;&#xA;&#xD;&#xA;	-- output&#xD;&#xA;    SELECT &#xD;&#xA;	    SUM(newCustsPY) AS newCustsPY, REPLACE(CONVERT(VARCHAR, CONVERT(MONEY, SUM(newCustsPY)),1),'.00','') AS newCustsPYText&#xD;&#xA;	    , SUM(newCustsPYMTD) AS newCustsPYMTD&#xD;&#xA;	    , SUM(newCustsMTD) AS newCustsMTD&#xD;&#xA;    	, CAST(ROUND(SUM(newCustsMonthEnd), 0) AS INT) AS projection&#xD;&#xA;	    , @isCurrentMonth AS isCurrentMonth&#xD;&#xA;	FROM &#xD;&#xA;		@output o &#xD;&#xA;&#xD;&#xA;" ConnectionID="connM1BIG-BIGReporting" ID="dlTotalNewCusts">
      <CalculatedColumn Formula="(parseInt(@Data.projection~/100000)+1)*100000" ID="calcProjectionBuffer" />
      <CalculatedColumn Formula="(parseInt(@Data.newCustsPY~/100000)+1)*100000" ID="calcPYProjectionBuffer" />
      <CalculatedColumn Formula="IIF(@Request.rptMonth~=@Request.rptCurrentMonth~,(1.0*@Local.NCForecast~)/(1.0*@Data.projection~),1.0)" ID="calcProjectionMarketingFactor" />
    </DataLayer>
  </LocalData>
  <ReportHeader>
    <IncludeSharedElement DefinitionFile="SharedElements.SharedHeader" ID="sharedHeaderElement" SharedElementID="sharedHeader" />
  </ReportHeader>
  <Body>
    <PopupPanel Caption="Enter New Acquisition Forecast" Height="80" PopupModal="Yes" Draggable="False" Width="300" ID="ppUpdateMarketingForecast" HideCloseX="True" Class="ThemeAlignCenter">
      <Label Caption="NOTE:  Updates to Acquisition Forecast are visible to all users who view the Dashboard" Class="ThemeTextSmall" />
      <LineBreak />
      <InputText ID="itNewMarketingForecast" Format="#0" InputMaxLength="6" CaptionClass="ThemeAlignCenter" DefaultValue="@Local.NCForecast~" Tooltip="Enter The New Acquisition Forecast (no commas)" />
      <LineBreak />
      <Button ID="btnUpdateNewMarketingForecast" Caption="Update" Tooltip="Update Acquisition Forecast">
        <Action Type="Process" ID="apUpdateNCForecast" Process="procStoreMarketingFactor" TaskID="tskUpdateNCForecast" Validate="False">
          <WaitPage Caption="Refreshing With Updated Forecast" />
          <LinkParams projection="@Local.projection~" />
        </Action>
        <Action Type="ShowElement" ElementID="ppUpdateMarketingForecast" Display="Hide" ID="aseUpdateNewMarketingForecast" />
      </Button>
      <Spaces Size="2" />
      <Button ID="btnResetNewMarketingForecast" Caption="Reset" Tooltip="Reset Marketing Factor to 1.0 (@Local.projection~)">
        <Action Type="Process" ID="apRestNewMarketingForecast" Process="procStoreMarketingFactor" TaskID="tskResetNCForecast" Validate="False">
          <WaitPage Caption="Refreshing With Reset Forecast" />
          <LinkParams projection="@Local.projection~" />
        </Action>
        <Action Type="ShowElement" ElementID="ppUpdateMarketingForecast" Display="Hide" ID="aseResetNewMarketingForecast" />
      </Button>
      <Spaces Size="8" />
      <ConditionalClass Condition="2&gt;1" Class="ThemeHeaderLarge" />
      <Button ID="btnCancelNewMarketingForecast" Caption="Cancel" Tooltip="Cancel Update">
        <Action Type="ShowElement" ElementID="ppUpdateMarketingForecast" Display="Hide" ID="aseCancelNewMarketingForecast" />
      </Button>
    </PopupPanel>
    <Rows ID="rowHeader" IdeDisplayStatus="Collapsed">
      <Row>
        <Column>
          <Division ID="divTitle" Class="rdAlternateTextColorWhite">
            <IncludeHtml Html="&lt;h2&gt;New Customer Dashboard&lt;/h2&gt;" />
          </Division>
        </Column>
        <Column>
          <Spaces Size="6" />
          <InputDate ID="rptDay" Caption="Report Date:" DefaultValue="@Request.rptDay~" CaptionClass="rdAlternateTextColorWhite" />
          <Spaces Size="3" />
          <Button ID="btnSubmit" Caption="Submit">
            <Action Type="Report" ID="actSubmitReport">
              <Remark>
                <LinkParams rptDay="@Request.rptDay~" rptMonth="@Request.rptMonth~" rptCurrentMonth="@Request.rptCurrentMonth~" />
              </Remark>
              <Target Type="Report" ID="tgtNewCustomerDashboard" Report="Dashboards.Acquisitions.NewCustomerDashboard" RequestForwarding="True">
                <WaitPage Caption="Refreshing With Updated Report Date" />
              </Target>
            </Action>
          </Button>
        </Column>
        <Column>
          <Spaces Size="6" />
          <Label Caption="Marketing Factor: " Class="rdAlternateTextColorWhite" Format="Fixed" Tooltip="Marketing Factor adjusts economic day trending based on current or proposed Marketing efforts" ID="lblMarketingFactorCaption" />
          <Spaces Size="3" />
          <Label Caption="@Local.calcProjectionMarketingFactor~" Class="rdAlternateTextColorWhite" Format="#0.00%" Tooltip="Marketing Factor adjusts economic day trending based on current or proposed Marketing efforts" ID="lblMarketingFactor" />
          <Spaces Size="3" />
          <Button ID="btnShowGetMarketingFactorForm" Caption="Change Forecast" Tooltip="Enter A New Acquisition Forecast">
            <ConditionalClass Condition="&quot;@Request.rptMonth~&quot; != &quot;@Request.rptCurrentMonth~&quot;" Class="ThemeHidden" />
            <Action Type="ShowElement" ElementID="ppUpdateMarketingForecast" ID="aseUpdateMarketingForecast" />
          </Button>
        </Column>
      </Row>
    </Rows>
    <Dashboard2 SaveFile="@Function.AppPhysicalPath~\Dashboard\NewCust_@Function.UserName~.xml" ID="dashSiteBuilder" SaveFileStarter="@Function.AppPhysicalPath~\Dashboard\NewCustdefault.xml" DashboardAdjustable="True" DashboardColumns="4">
      <Panel ID="pnlNewCust_ChannelTable" Caption="New Customers by Channel" IdeDisplayStatus="Collapsed">
        <PanelContent IdeDisplayStatus="Collapsed">
          <DataTable ID="dtNewCustTableChannel" Width="550" WidthScale="px">
            <DataLayer Type="SQL" Source="/********************************************************************************************************************&#xD;&#xA;    Name:			New Customers By Channel / SubCategory&#xD;&#xA;    Author:			Scott Cooper&#xD;&#xA;    Create Date:	2013/05/01&#xD;&#xA;    Description:	This displays new customer information by channel/subcategory for all regions&#xD;&#xA;	&#xD;&#xA;    Processing:&#xD;&#xA;&#xD;&#xA;    Assumptions / Special Processing:&#xD;&#xA;&#xD;&#xA;    User-Defined Variables:&#xD;&#xA;	    @start				DATE			/*  Start Date for measurement (beginning of month)		*/&#xD;&#xA;		@end				DATE			/*	End Date for measurement							*/&#xD;&#xA;		@current			DATE			/*	Current Month start date							*/&#xD;&#xA;		@isCurrentMonth		INT				/*	Is measurement month same as current month?			*/&#xD;&#xA;		@marketingFactor	FLOAT			/*	Multiplier based on economic day projectiong		*/&#xD;&#xA;		@econDays_mtd  		FLOAT 			/*	Economic days MTD									*/&#xD;&#xA;		@econDays_monthEnd 	FLOAT 			/*	Economic days for full measurement month			*/&#xD;&#xA;		@econDays_14d 		FLOAT 			/*	Economic days for past 14 days						*/&#xD;&#xA;		@subCategoryRollup	VARCHAR(50)		/*	Label for all subcategories							*/&#xD;&#xA;		@subCategoryHeading VARCHAR(1)		/*	SubCategory to display (where detail records exist	*/&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;	TEMPORARY Tables Utilized:&#xD;&#xA;        @output             TABLE containing results TO display&#xD;&#xA;&#xD;&#xA;    Modifications:&#xD;&#xA;        20130501    Scott Cooper			Updates TO initial coding BY MXNguyen&#xD;&#xA;		20130710	Mike Nguyen				Added Budget&#xD;&#xA;&#xD;&#xA;*******************************************************************************************************************/&#xD;&#xA;SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;&#xD;&#xA;SET NOCOUNT ON;&#xD;&#xA;SET STATISTICS IO OFF;&#xD;&#xA;SET STATISTICS TIME OFF;&#xD;&#xA;&#xD;&#xA;/********************/&#xD;&#xA;/*  Declarations    */&#xD;&#xA;/************************************************************************************************************************/&#xD;&#xA;/*  This section defined variables and constants used in the programs                                                   */&#xD;&#xA;/************************************************************************************************************************/&#xD;&#xA;&#xD;&#xA;    /********************************************************************************************************************/&#xD;&#xA;    /*  Standard variable values                                                                                        */&#xD;&#xA;    /********************************************************************************************************************/&#xD;&#xA;	DECLARE @true	INT = 1&#xD;&#xA;	DECLARE @false 	INT = 0&#xD;&#xA;&#xD;&#xA;    /********************************************************************************************************************/&#xD;&#xA;    /*	Pre-Defined Constants																							*/&#xD;&#xA;    /********************************************************************************************************************/&#xD;&#xA;	DECLARE @subCategoryRollup 	VARCHAR(50) = 'All'&#xD;&#xA;	DECLARE	@subCategoryHeading VARCHAR(1)	= '+'&#xD;&#xA;	&#xD;&#xA;    /********************************************************************************************************************/&#xD;&#xA;    /*	Passed Variables                                                                                                */&#xD;&#xA;    /********************************************************************************************************************/&#xD;&#xA;	DECLARE @start 				DATE = '@Request.rptMonth~'&#xD;&#xA;	DECLARE @end 				DATE = '@Request.rptDay~'&#xD;&#xA;	DECLARE @current 			DATE = '@Request.rptCurrentMonth~'&#xD;&#xA;&#xD;&#xA;    /********************************************************************************************************************/&#xD;&#xA;    /*	Variables set during the course of the code execution															*/&#xD;&#xA;    /********************************************************************************************************************/&#xD;&#xA;	DECLARE @isCurrentMonth 	INT = CASE WHEN @start = @current THEN @true ELSE @false END&#xD;&#xA;	DECLARE @marketingFactor 	FLOAT = CASE WHEN @isCurrentMonth = @true THEN CAST('@Local.calcProjectionMarketingFactor~' AS FLOAT) ELSE 1.0 END&#xD;&#xA;&#xD;&#xA;	DECLARE @econDays_mtd  		FLOAT &#xD;&#xA;	DECLARE @econDays_monthEnd 	FLOAT &#xD;&#xA;	DECLARE @econDays_14d 		FLOAT &#xD;&#xA;&#xD;&#xA;&#xD;&#xA;/********************/&#xD;&#xA;/*  Initial Setup   */&#xD;&#xA;/********************************************************************************************************************/&#xD;&#xA;/*  This section creates the needed table structures and assigns the promo codes and pf_IDs to be measured          */&#xD;&#xA;/********************************************************************************************************************/&#xD;&#xA;&#xD;&#xA;	DECLARE @output TABLE(&#xD;&#xA;		region 				VARCHAR(50)&#xD;&#xA;		, channel 			VARCHAR(50)&#xD;&#xA;		, subCategory		VARCHAR(50)&#xD;&#xA;		, newCustsMTD 		INT 			DEFAULT 0&#xD;&#xA;		, newCusts14d 		INT 			DEFAULT 0&#xD;&#xA;		, rate14d 			FLOAT 			DEFAULT 0&#xD;&#xA;		, newCustsMonthEnd 	FLOAT 			DEFAULT 0&#xD;&#xA;		, newCustsPY 		INT				DEFAULT 0&#xD;&#xA;		)&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;/********************/&#xD;&#xA;/*  Processing		*/&#xD;&#xA;/********************************************************************************************************************/&#xD;&#xA;/*  This section processes the needed information																	*/&#xD;&#xA;/********************************************************************************************************************/&#xD;&#xA;	SELECT @econDays_mtd = SUM(economicDays) FROM biLogiReporting.dbo.rptNewCustomerEconomicDays d (NOLOCK) WHERE acquisitionDate &gt;= @start AND acquisitionDate &lt; @end&#xD;&#xA;	SELECT @econDays_monthEnd = SUM(economicDays) FROM biLogiReporting.dbo.rptNewCustomerEconomicDays d (NOLOCK) WHERE acquisitionDate &gt;= @start AND acquisitionDate &lt; DATEADD(MONTH, 1, @start)&#xD;&#xA;	SELECT @econDays_14d = SUM(economicDays) FROM biLogiReporting.dbo.rptNewCustomerEconomicDays d (NOLOCK) WHERE acquisitionDate &gt;= DATEADD(d,-14,@end) AND acquisitionDate &lt; @end&#xD;&#xA;&#xD;&#xA;	-- populate the regions, subcategories &amp; channels&#xD;&#xA;	INSERT INTO @output(&#xD;&#xA;		region&#xD;&#xA;		, channel&#xD;&#xA;		, subCategory&#xD;&#xA;		)&#xD;&#xA;	SELECT DISTINCT &#xD;&#xA;		Region&#xD;&#xA;		, Channel&#xD;&#xA;		, SubCategory &#xD;&#xA;	FROM &#xD;&#xA;		[BiLogiReporting].[dbo].[rptNewCustomerDaily_new] WITH (NOLOCK)&#xD;&#xA;	WHERE&#xD;&#xA;    	rptDate &gt;= DATEADD(YEAR, -1, @start)&#xD;&#xA;		AND (region = '@Request.islNewCustTrendRegion~' OR '@Request.islNewCustTrendRegion~' = 'All Regions' OR '@Request.islNewCustTrendRegion~' = '')&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;    -- update w/current new customers (last 14 days)&#xD;&#xA;	UPDATE &#xD;&#xA;		o&#xD;&#xA;	SET &#xD;&#xA;		region = x.region&#xD;&#xA;		, channel = x.channel&#xD;&#xA;		, subCategory = x.subcategory&#xD;&#xA;		, newCusts14d = x.newCusts14d&#xD;&#xA;		, rate14d = x.rate14d&#xD;&#xA;	FROM &#xD;&#xA;		@output o&#xD;&#xA;		INNER JOIN &#xD;&#xA;			(&#xD;&#xA;				SELECT&#xD;&#xA;					Region&#xD;&#xA;					, Channel&#xD;&#xA;					, SubCategory&#xD;&#xA;					, SUM(NewCusts) AS newCusts14d&#xD;&#xA;					, SUM(NewCusts) / @econDays_14d AS rate14d&#xD;&#xA;				FROM &#xD;&#xA;					[BiLogiReporting].[dbo].[rptNewCustomerDaily_new] nc WITH (NOLOCK)&#xD;&#xA;				WHERE&#xD;&#xA;					rptDate &gt;= DATEADD(DAY, -14, @end) &#xD;&#xA;					AND rptDate &lt; @end&#xD;&#xA;					AND (region = '@Request.islNewCustTrendRegion~' OR '@Request.islNewCustTrendRegion~' = 'All Regions' OR '@Request.islNewCustTrendRegion~' = '')&#xD;&#xA;				GROUP BY &#xD;&#xA;					Region&#xD;&#xA;					, Channel&#xD;&#xA;					, SubCategory&#xD;&#xA;			) x &#xD;&#xA;			ON o.Region = x.Region &#xD;&#xA;			AND o.Channel = x.Channel&#xD;&#xA;			AND o.SubCategory = x.SubCategory&#xD;&#xA;	OPTION (MAXDOP 1);&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;	-- update w/actual MTD numbers and project ME numbers (if current month)&#xD;&#xA;	UPDATE &#xD;&#xA;		o&#xD;&#xA;	SET &#xD;&#xA;		newCustsMTD = x.newCustsMTD&#xD;&#xA;    	, newCustsMonthEnd = CASE WHEN @isCurrentMonth = @true THEN COALESCE(x.newCustsMTD, 0) + (@econDays_monthEnd - @econDays_mtd) * o.rate14d ELSE 0 END&#xD;&#xA;	FROM &#xD;&#xA;		@output o&#xD;&#xA;	LEFT OUTER JOIN&#xD;&#xA;		(&#xD;&#xA;			SELECT &#xD;&#xA;				Region&#xD;&#xA;				, Channel&#xD;&#xA;				, SubCategory&#xD;&#xA;				, SUM(NewCusts) AS newCustsMTD&#xD;&#xA;			FROM &#xD;&#xA;				[BiLogiReporting].[dbo].[rptNewCustomerDaily_new] nc WITH (NOLOCK)&#xD;&#xA;			WHERE&#xD;&#xA;				rptDate &gt;= @start &#xD;&#xA;				AND rptDate &lt; @end&#xD;&#xA;				AND (region = '@Request.islNewCustTrendRegion~' OR '@Request.islNewCustTrendRegion~' = 'All Regions' OR '@Request.islNewCustTrendRegion~' = '')&#xD;&#xA;			GROUP BY &#xD;&#xA;				Region&#xD;&#xA;				, Channel&#xD;&#xA;				, SubCategory&#xD;&#xA;		) x &#xD;&#xA;		ON o.Region = x.Region &#xD;&#xA;		AND o.Channel = x.Channel&#xD;&#xA;		AND o.SubCategory = x.SubCategory&#xD;&#xA;	OPTION (MAXDOP 1);&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;	-- update w/actual PY numbers&#xD;&#xA;	UPDATE&#xD;&#xA;		o&#xD;&#xA;	SET &#xD;&#xA;		newCustsPY = x.newCustsPY&#xD;&#xA;	FROM &#xD;&#xA;		@output o&#xD;&#xA;		INNER JOIN&#xD;&#xA;			(&#xD;&#xA;				SELECT&#xD;&#xA;					Region&#xD;&#xA;					, Channel&#xD;&#xA;					, SubCategory&#xD;&#xA;					, SUM (NewCusts) AS newCustsPY&#xD;&#xA;				FROM &#xD;&#xA;					[BiLogiReporting].[dbo].[rptNewCustomerDaily_new] nc WITH (NOLOCK)&#xD;&#xA;				WHERE&#xD;&#xA;					rptDate &gt;= DATEADD(YEAR, -1, @start) &#xD;&#xA;					AND rptDate &lt; DATEADD(YEAR, -1, DATEADD(MONTH, 1, @start))&#xD;&#xA;					AND (region = '@Request.islNewCustTrendRegion~' OR '@Request.islNewCustTrendRegion~' = 'All Regions' OR '@Request.islNewCustTrendRegion~' = '')&#xD;&#xA;				GROUP BY &#xD;&#xA;					Region&#xD;&#xA;					, Channel&#xD;&#xA;					, SubCategory&#xD;&#xA;			) x &#xD;&#xA;			ON o.Region = x.Region &#xD;&#xA;			AND o.Channel = x.Channel&#xD;&#xA;			AND o.SubCategory = x.SubCategory&#xD;&#xA;&#xD;&#xA;	-- if not current month, set MTD totals = actual MTD totals, not projections&#xD;&#xA;	IF @isCurrentMonth = @false&#xD;&#xA;		BEGIN&#xD;&#xA;			UPDATE &#xD;&#xA;				o&#xD;&#xA;			SET &#xD;&#xA;				newCustsMonthEnd = x.newCustsMonthEnd&#xD;&#xA;			FROM &#xD;&#xA;				@output o&#xD;&#xA;				INNER JOIN &#xD;&#xA;					(&#xD;&#xA;						SELECT&#xD;&#xA;							Region&#xD;&#xA;							, Channel&#xD;&#xA;							, SubCategory&#xD;&#xA;							, SUM(NewCusts) AS newCustsMonthEnd&#xD;&#xA;						FROM &#xD;&#xA;							[BiLogiReporting].[dbo].[rptNewCustomerDaily_new] nc WITH (NOLOCK)&#xD;&#xA;						WHERE&#xD;&#xA;							rptDate &gt;= @start&#xD;&#xA;							AND rptDate &lt; DATEADD(MONTH, 1, @start)&#xD;&#xA;						GROUP BY &#xD;&#xA;							Region&#xD;&#xA;							, Channel&#xD;&#xA;							, SubCategory&#xD;&#xA;					) x &#xD;&#xA;					ON o.Region = x.Region &#xD;&#xA;					AND o.Channel = x.Channel&#xD;&#xA;					AND o.SubCategory = x.SubCategory&#xD;&#xA;			OPTION (MAXDOP 1);&#xD;&#xA;		END&#xD;&#xA;&#xD;&#xA;	-- output&#xD;&#xA;	SELECT&#xD;&#xA;		a.channel&#xD;&#xA;		, a.channelHeading&#xD;&#xA;		, a.subCategoryHeading&#xD;&#xA;		, a.isSummary&#xD;&#xA;		, a.sortOrder&#xD;&#xA;		, a.newCustsMTD&#xD;&#xA;		, a.newCustsMonthEnd&#xD;&#xA;		, a.newCustsPY&#xD;&#xA;		, a.variance&#xD;&#xA;		, COALESCE(budget.NewCusts,0) AS budget&#xD;&#xA;		, a.newCustsMonthEnd - COALESCE(budget.NewCusts,0) AS varBudget&#xD;&#xA;	FROM (&#xD;&#xA;		SELECT &#xD;&#xA;			o.channel&#xD;&#xA;			, COALESCE(headSummary.channelHeading, head.channelHeading) AS channelHeading&#xD;&#xA;			, CASE WHEN headSummary.channelHeading IS NULL THEN '' ELSE @subCategoryHeading END AS subCategoryHeading&#xD;&#xA;			, head.isSummary&#xD;&#xA;			, MIN(head.sortOrder) AS sortOrder&#xD;&#xA;			, SUM(o.newCustsMTD) AS newCustsMTD&#xD;&#xA;			, SUM((o.newCustsMonthEnd) * @marketingFactor) AS newCustsMonthEnd&#xD;&#xA;			, SUM(o.newCustsPY) AS newCustsPY&#xD;&#xA;			, (SUM(o.newCustsMonthEnd) * @marketingFactor) - SUM(o.newCustsPY) AS variance&#xD;&#xA;		FROM &#xD;&#xA;			@output o &#xD;&#xA;			INNER JOIN [BiLogiReporting].[dbo].[rptNewCustomerDaily_channelHeadings] head WITH (NOLOCK)&#xD;&#xA;				ON o.channel = head.channel&#xD;&#xA;    			AND o.subcategory = head.subcategory&#xD;&#xA;			LEFT OUTER JOIN [BiLogiReporting].[dbo].[rptNewCustomerDaily_channelHeadings] headSummary WITH (NOLOCK)&#xD;&#xA;				ON o.channel = headSummary.channel&#xD;&#xA;				AND headSummary.isSummary = @true&#xD;&#xA;		WHERE &#xD;&#xA;			head.isSummary = @false&#xD;&#xA;		GROUP BY &#xD;&#xA;   			o.channel&#xD;&#xA;			, COALESCE(headSummary.channelHeading, head.channelHeading)&#xD;&#xA;			, CASE WHEN headSummary.channelHeading IS NULL THEN '' ELSE @subCategoryHeading END&#xD;&#xA;			, head.isSummary&#xD;&#xA;		) AS a&#xD;&#xA;	LEFT OUTER JOIN&#xD;&#xA;		(&#xD;&#xA;		SELECT&#xD;&#xA;			RptChannel&#xD;&#xA;			, sum(NewCusts) as NewCusts&#xD;&#xA;		FROM [BiLogiReporting].[dbo].[rptNewCustomerBudget] WITH (NOLOCK)&#xD;&#xA;		WHERE month = @start&#xD;&#xA;		AND (RptRegion = '@Request.islNewCustTrendRegion~' OR '@Request.islNewCustTrendRegion~' = 'All Regions' OR '@Request.islNewCustTrendRegion~' = '')&#xD;&#xA;		GROUP BY RptChannel&#xD;&#xA;		) budget on a.channel = budget.RptChannel&#xD;&#xA;    ORDER BY &#xD;&#xA;        a.sortOrder&#xD;&#xA;" ConnectionID="connM1BIG-BIGReporting" ID="dlNewCustomersChannel">
              <CalculatedColumn Formula="@Data.newCustsMonthEnd~ - @Data.newCustsPY~" ID="ccVariance" />
              <CalculatedColumn Formula="IIF(@Data.newCustsPY~=0,1,@Data.newCustsMonthEnd~ / @Data.newCustsPY~ -1)" ID="ccVariancePct" ErrorResult="0" />
              <DataLayerLink ID="dlLinkNewCustomers" />
              <AggregateColumn AggregateColumn="newCustsMonthEnd" ID="aggNewCustsMonthEnd" AggregateFunction="Sum" />
              <AggregateColumn AggregateColumn="newCustsPY" ID="aggNewCustsPY" AggregateFunction="Sum" />
              <CalculatedColumn Formula="IIF(@Data.aggNewCustsPY~=0,1,@Data.aggNewCustsMonthEnd~ / @Data.aggNewCustsPY~ -1)" ID="ccVarianceTotalPct" ErrorResult="0" />
            </DataLayer>
            <DataTableColumn ID="colChannel" Header="Channel">
              <Label ID="lblChannel" Caption="@Data.channelHeading~" Tooltip="Click to expand channel totals by region">
                <Action Type="ShowElement" ID="actShowChannelRegions" ElementID="mirChannelRegions" />
              </Label>
              <DataColumnSort DataColumn="Channel" />
            </DataTableColumn>
            <DataTableColumn ID="colSubCategory" Tooltip="Displays &quot;+&quot; if subcategory totals exist for channel" Class="center" IdeDisplayStatus="Collapsed">
              <Label ID="lblSubCategory" Caption="@Data.subCategoryHeading~" Tooltip="Click to expand channel subcategory totals" Class="center">
                <Action Type="ShowElement" ID="actShowSubCategory" ElementID="mirSubCategory" />
              </Label>
            </DataTableColumn>
            <DataTableColumn ID="colgacNewCustsMTD" Header="MTD" Class="ThemeAlignRight" IdeDisplayStatus="Collapsed">
              <Label ID="lblgacNewCustsMTD" Caption="@Data.newCustsMTD~" Format="#,0" />
              <DataColumnSort DataColumn="gacNewCustsMTD" DataType="Number" />
              <DataColumnSummary DataColumn="newCustsMTD" Function="Sum" ID="dcSumNewCustsMTD" />
            </DataTableColumn>
            <DataTableColumn ID="colgacNewCustsMonthEnd" Header="=MonthName(Month(&quot;@Request.rptMonth~&quot;),&quot;true&quot;)+&quot; &quot;+Year(&quot;@Request.rptMonth~&quot;)+&quot;*&quot;" Class="ThemeAlignRight" IdeDisplayStatus="Collapsed">
              <Label ID="lblgacNewCustsMonthEnd" Caption="@Data.newCustsMonthEnd~" Format="#,0" />
              <DataColumnSort DataColumn="gacNewCustsMonthEnd" DataType="Number" />
              <DataColumnSummary DataColumn="newCustsMonthEnd" Function="Sum" ID="dcSumNewCustsMonthEnd" />
            </DataTableColumn>
            <DataTableColumn ID="colgacNewCustsPY" Header="=MonthName(Month(&quot;@Request.rptMonth~&quot;),&quot;true&quot;)+&quot; &quot;+Year(Dateadd(&quot;yyyy&quot;,&quot;-1&quot;,&quot;@Request.rptMonth~&quot;))" Class="ThemeAlignRight" IdeDisplayStatus="Collapsed">
              <Label ID="lblgacNewCustsPY" Caption="@Data.newCustsPY~" Format="#,0" />
              <DataColumnSort DataColumn="gacNewCustsPY" DataType="Number" />
              <DataColumnSummary DataColumn="newCustsPY" Function="Sum" ID="dcSumNewCustsPY" />
            </DataTableColumn>
            <DataTableColumn ID="colccVariance" Header="var" Class="ThemeAlignRight" Tooltip="Variance vs Prior Year" IdeDisplayStatus="Collapsed">
              <Label ID="lblccVariance" Caption="@Data.ccVariance~" Format="#,#;(#,#)">
                <ConditionalClass Class="ThemeTextNegative" Condition="@Data.ccVariance~ &lt; 0" />
              </Label>
              <DataColumnSort DataColumn="ccVariance" />
              <DataColumnSummary DataColumn="ccVariance" Function="Sum" ID="dcVariance" />
            </DataTableColumn>
            <DataTableColumn ID="colccVariancePct" Header="% var" Class="ThemeAlignRight" Tooltip="Variance vs Prior Year">
              <Label ID="lblccVariancePct" Caption="@Data.ccVariancePct~" Format="0.0%;(0.0%)">
                <TooltipPanel ID="tpChannel" IdeDisplayStatus="Collapsed">
                  <Chart Type="XY" XYChartType="Line" ChartHeight="200" ChartWidth="300" ChartDataColumn="newCusts" ChartLabelColumn="rptDate" ChartTitle="@Data.channel~ 30-day trend vs PY" LegendLabel="Current" BackgroundColor="White">
                    <DataLayer Type="SQL" Source="declare @ReportDate datetime = '@Request.rptDay~'&#xD;&#xA;&#xD;&#xA;select&#xD;&#xA;	a.rptDate&#xD;&#xA;	, newCusts&#xD;&#xA;	, pyDate&#xD;&#xA;	, newCustsPY&#xD;&#xA;from&#xD;&#xA;(&#xD;&#xA;select&#xD;&#xA;	rptDate&#xD;&#xA;	, sum(newCusts) as newCusts&#xD;&#xA;from [BiLogiReporting].[dbo].[rptNewCustomerDaily_new] nc (nolock)&#xD;&#xA;where rptDate &gt; dateadd(d, -30, @ReportDate) and rptDate &lt; @ReportDate&#xD;&#xA;and Channel = '@Data.channel~'&#xD;&#xA;group by rptDate&#xD;&#xA;) a&#xD;&#xA;left join&#xD;&#xA;(&#xD;&#xA;select&#xD;&#xA;	dateadd(d,364,rptDate) as rptDate&#xD;&#xA;	, rptDate as pyDate&#xD;&#xA;	, sum(newCusts) as newCustsPY&#xD;&#xA;from [BiLogiReporting].[dbo].[rptNewCustomerDaily_new] nc (nolock)&#xD;&#xA;where rptDate &gt; dateadd(d, -394, @ReportDate) and rptDate &lt; dateadd(d,-364,@ReportDate)&#xD;&#xA;and Channel = '@Data.channel~'&#xD;&#xA;group by dateadd(d,364,rptDate)&#xD;&#xA;	, rptDate&#xD;&#xA;) b on a.rptdate = b.rptdate&#xD;&#xA;order by rptDate&#xD;&#xA;;" ConnectionID="connM1BIG-BIGReporting" />
                    <ExtraXYDataColumn ChartDataColumn="newCustsPY" LegendLabel="PY" />
                    <FontLabel FontAngle="45" FontSize="8" BorderColor="Black" FontColor="Black" />
                    <LabelScale LinearTickIncrement="Weeks" LinearTickMinorIncrement="Weeks" Format="MM/dd" ScalingMode="LinearTime" />
                    <DataScale Format="#,#" />
                    <FontChartTitle FontSize="10" FontColor="Black" />
                    <FontData FontSize="8" FontColor="Black" BorderColor="Black" />
                    <Legend LegendOrientation="Horizontal" LegendTop="170" LegendLeft="160" BackgroundColor="White" BorderColor="White">
                      <FontLegend FontSize="8" FontColor="Black" />
                    </Legend>
                  </Chart>
                </TooltipPanel>
                <ConditionalClass Class="ThemeTextNegative" Condition="@Data.ccVariancePct~ &lt; 0" />
              </Label>
              <DataColumnSort DataColumn="ccVariancePct" />
              <DataColumnSummary DataColumn="ccVarianceTotalPct" Function="Average" ID="dcVariancePct" />
            </DataTableColumn>
            <DataTableColumn ID="colBudget" Header="Budget" Class="ThemeAlignRight" IdeDisplayStatus="Collapsed" Tooltip="2.75M Budget">
              <Label ID="lblBudget" Caption="@Data.budget~" Format="#,0" />
              <DataColumnSort DataColumn="budget" DataType="Number" />
              <DataColumnSummary DataColumn="budget" Function="Sum" ID="dcSumBudget" />
            </DataTableColumn>
            <DataTableColumn ID="colVarBudget" Header="vtb" Class="ThemeAlignRight" Tooltip="Variance to Budget" IdeDisplayStatus="Collapsed">
              <Label ID="lblVarBudget" Caption="@Data.varBudget~" Format="#,#;(#,#)">
                <ConditionalClass Class="ThemeTextNegative" Condition="@Data.varBudget~ &lt; 0" />
              </Label>
              <DataColumnSort DataColumn="varBudget" DataType="Number" />
              <DataColumnSummary DataColumn="varBudget" Function="Sum" ID="dcSumVarBudget" />
            </DataTableColumn>
            <SummaryRow ID="srTotal" Caption="Total" />
            <MoreInfoRow ID="mirChannelRegions" ShowModes="None" ColumnSpanFirst="2">
              <IncludeFrame ID="srptChannelRegions" Width="700" Height="400">
                <Target Type="IncludeFrameReport" ID="tgtChannelRegions" Report="Dashboards.Acquisitions.NewCustomerChannelViewDrillDown" RequestForwarding="True" />
                <LinkParams rptDay="@Request.rptDay~" rptMonth="@Request.rptMonth~" marketingFactor="@Local.calcProjectionMarketingFactor~" rptCurrentMonth="@Request.rptCurrentMonth~" channel="@Data.channelHeading~" />
              </IncludeFrame>
            </MoreInfoRow>
            <MoreInfoRow ID="mirSubCategory" ShowModes="None" ColumnSpanFirst="2" IdeDisplayStatus="Collapsed">
              <IncludeFrame ID="srptSubCategory">
                <Target Type="IncludeFrameReport" ID="tgtSubCategories" Report="Dashboards.Acquisitions.NewCustomerChannelSubCategoryDrillDown" RequestForwarding="True" />
                <LinkParams rptDay="@Request.rptDay~" rptMonth="@Request.rptMonth~" marketingFactor="@Local.calcProjectionMarketingFactor~" channel="@Data.channelHeading~" rptCurrentMonth="@Request.rptCurrentMonth~" />
              </IncludeFrame>
            </MoreInfoRow>
          </DataTable>
          <Label Caption="*Projection based on acquisitions per economic day in the prior 14 days" Class="ThemeTextSmall" />
          <LineBreak />
          <Label Caption="Mouseover '%var' column to view chart" Class="ThemeTextSmall" />
        </PanelContent>
      </Panel>
      <Panel ID="pnlNewCust_RegionTable" Caption="New Customers by Region">
        <PanelContent>
          <DataTable ID="dtNewCustTableRegion" Width="550" WidthScale="px">
            <DataLayer Type="SQL" Source="/********************************************************************************************************************&#xD;&#xA;    Name:			New Customers By Region&#xD;&#xA;    Author:			Scott Cooper&#xD;&#xA;    Create Date:	2013/05/01&#xD;&#xA;    Description:	This displays new customer information by region&#xD;&#xA;	&#xD;&#xA;    Processing:&#xD;&#xA;&#xD;&#xA;    Assumptions / Special Processing:&#xD;&#xA;&#xD;&#xA;    User-Defined Variables:&#xD;&#xA;	    @start				DATE			/*  Start Date for measurement (beginning of month)		*/&#xD;&#xA;		@end				DATE			/*	End Date for measurement							*/&#xD;&#xA;		@current			DATE			/*	Current Month start date							*/&#xD;&#xA;		@isCurrentMonth		INT				/*	Is measurement month same as current month?			*/&#xD;&#xA;		@marketingFactor	FLOAT			/*	Multiplier based on economic day projectiong		*/&#xD;&#xA;		@econDays_mtd  		FLOAT 			/*	Economic days MTD									*/&#xD;&#xA;		@econDays_monthEnd 	FLOAT 			/*	Economic days for full measurement month			*/&#xD;&#xA;		@econDays_14d 		FLOAT 			/*	Economic days for past 14 days						*/&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;	Temporary Tables Utilized:&#xD;&#xA;        @output             Table containing results to display&#xD;&#xA;&#xD;&#xA;    Modifications:&#xD;&#xA;        20130501    Scott Cooper			Updates to initial coding by MXNguyen&#xD;&#xA;		20130710	Mike Nguyen				Added Budget&#xD;&#xA;&#xD;&#xA;*******************************************************************************************************************/&#xD;&#xA;SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;&#xD;&#xA;SET NOCOUNT ON;&#xD;&#xA;SET STATISTICS IO OFF;&#xD;&#xA;SET STATISTICS TIME OFF;&#xD;&#xA;&#xD;&#xA;/********************/&#xD;&#xA;/*  Declarations    */&#xD;&#xA;/************************************************************************************************************************/&#xD;&#xA;/*  This section defined variables and constants used in the programs                                                   */&#xD;&#xA;/************************************************************************************************************************/&#xD;&#xA;&#xD;&#xA;    /********************************************************************************************************************/&#xD;&#xA;    /*  Standard variable values                                                                                        */&#xD;&#xA;    /********************************************************************************************************************/&#xD;&#xA;	DECLARE @true	INT = 1&#xD;&#xA;	DECLARE @false 	INT = 0&#xD;&#xA;&#xD;&#xA;    /********************************************************************************************************************/&#xD;&#xA;    /*	Pre-Defined Constants																							*/&#xD;&#xA;    /********************************************************************************************************************/&#xD;&#xA;	&#xD;&#xA;    /********************************************************************************************************************/&#xD;&#xA;    /*	Passed Variables                                                                                                */&#xD;&#xA;    /********************************************************************************************************************/&#xD;&#xA;	DECLARE @start 				DATE = '@Request.rptMonth~'&#xD;&#xA;	DECLARE @end 				DATE = '@Request.rptDay~'&#xD;&#xA;	DECLARE @current 			DATE = '@Request.rptCurrentMonth~'&#xD;&#xA;&#xD;&#xA;    /********************************************************************************************************************/&#xD;&#xA;    /*	Variables set during the course of the code execution															*/&#xD;&#xA;    /********************************************************************************************************************/&#xD;&#xA;	DECLARE @isCurrentMonth 	INT = CASE WHEN @start = @current THEN @true ELSE @false END&#xD;&#xA;	DECLARE @marketingFactor 	FLOAT = CASE WHEN @isCurrentMonth = @true THEN CAST('@Local.calcProjectionMarketingFactor~' AS FLOAT) ELSE 1.0 END&#xD;&#xA;&#xD;&#xA;	DECLARE @econDays_mtd  		FLOAT &#xD;&#xA;	DECLARE @econDays_monthEnd 	FLOAT &#xD;&#xA;	DECLARE @econDays_14d 		FLOAT &#xD;&#xA;&#xD;&#xA;&#xD;&#xA;/********************/&#xD;&#xA;/*  Initial Setup   */&#xD;&#xA;/********************************************************************************************************************/&#xD;&#xA;/*  This section creates the needed table structures and assigns the promo codes and pf_IDs to be measured          */&#xD;&#xA;/********************************************************************************************************************/&#xD;&#xA;&#xD;&#xA;	DECLARE @output TABLE(&#xD;&#xA;		region 				VARCHAR(50)&#xD;&#xA;		, channel 			VARCHAR(50)&#xD;&#xA;		, subCategory		VARCHAR(50)&#xD;&#xA;		, sortOrder			INT				DEFAULT 0&#xD;&#xA;		, newCustsMTD 		INT 			DEFAULT 0&#xD;&#xA;		, newCusts14d 		INT 			DEFAULT 0&#xD;&#xA;		, rate14d 			FLOAT 			DEFAULT 0&#xD;&#xA;		, newCustsMonthEnd 	FLOAT 			DEFAULT 0&#xD;&#xA;		, newCustsPY 		INT				DEFAULT 0&#xD;&#xA;		)&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;/********************/&#xD;&#xA;/*  Processing		*/&#xD;&#xA;/********************************************************************************************************************/&#xD;&#xA;/*  This section processes the needed information																	*/&#xD;&#xA;/********************************************************************************************************************/&#xD;&#xA;	SELECT @econDays_mtd = sum(economicDays) from biLogiReporting.dbo.rptNewCustomerEconomicDays d (nolock) where acquisitionDate &gt;= @start and acquisitionDate &lt; @end&#xD;&#xA;	SELECT @econDays_monthEnd = sum(economicDays) from biLogiReporting.dbo.rptNewCustomerEconomicDays d (nolock) where acquisitionDate &gt;= @start and acquisitionDate &lt; dateadd(month, 1, @start)&#xD;&#xA;	SELECT @econDays_14d = sum(economicDays) from biLogiReporting.dbo.rptNewCustomerEconomicDays d (nolock) where acquisitionDate &gt;= dateadd(d,-14,@end) and acquisitionDate &lt; @end&#xD;&#xA;&#xD;&#xA;	-- populate the regions, subcategories &amp; channels&#xD;&#xA;	INSERT INTO @output(&#xD;&#xA;		region&#xD;&#xA;		, channel&#xD;&#xA;		, subCategory&#xD;&#xA;		)&#xD;&#xA;	SELECT DISTINCT &#xD;&#xA;		Region&#xD;&#xA;		, Channel&#xD;&#xA;		, SubCategory &#xD;&#xA;	FROM &#xD;&#xA;		[BiLogiReporting].[dbo].[rptNewCustomerDaily_new] WITH (NOLOCK)&#xD;&#xA;	WHERE&#xD;&#xA;    	rptDate &gt;= DATEADD(YEAR, -1, @start)&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;    -- update w/current new customers (last 14 days)&#xD;&#xA;	UPDATE &#xD;&#xA;		o&#xD;&#xA;	SET &#xD;&#xA;		region = x.region&#xD;&#xA;		, channel = x.channel&#xD;&#xA;		, subCategory = x.subcategory&#xD;&#xA;		, newCusts14d = x.newCusts14d&#xD;&#xA;		, rate14d = x.rate14d&#xD;&#xA;	FROM &#xD;&#xA;		@output o&#xD;&#xA;		INNER JOIN &#xD;&#xA;			(&#xD;&#xA;				SELECT&#xD;&#xA;					Region&#xD;&#xA;					, Channel&#xD;&#xA;					, SubCategory&#xD;&#xA;					, SUM(NewCusts) AS newCusts14d&#xD;&#xA;					, SUM(NewCusts) / @econDays_14d AS rate14d&#xD;&#xA;				FROM &#xD;&#xA;					[BiLogiReporting].[dbo].[rptNewCustomerDaily_new] nc WITH (NOLOCK)&#xD;&#xA;				WHERE&#xD;&#xA;					rptDate &gt;= DATEADD(DAY, -14, @end) &#xD;&#xA;					AND rptDate &lt; @end&#xD;&#xA;				GROUP BY &#xD;&#xA;					Region&#xD;&#xA;					, Channel&#xD;&#xA;					, SubCategory&#xD;&#xA;			) x &#xD;&#xA;			ON o.Region = x.Region &#xD;&#xA;			AND o.Channel = x.Channel&#xD;&#xA;			AND o.SubCategory = x.SubCategory&#xD;&#xA;	OPTION (MAXDOP 1);&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;	-- update w/actual MTD numbers and project ME numbers&#xD;&#xA;	UPDATE &#xD;&#xA;		o&#xD;&#xA;	SET &#xD;&#xA;		newCustsMTD = x.newCustsMTD&#xD;&#xA;    	, newCustsMonthEnd = CASE WHEN @isCurrentMonth = @true THEN COALESCE(x.newCustsMTD, 0) + (@econDays_monthEnd - @econDays_mtd) * o.rate14d ELSE 0 END&#xD;&#xA;	FROM &#xD;&#xA;		@output o&#xD;&#xA;	LEFT OUTER JOIN&#xD;&#xA;		(&#xD;&#xA;			SELECT &#xD;&#xA;				Region&#xD;&#xA;				, Channel&#xD;&#xA;				, SuBCategory&#xD;&#xA;				, SUM(NewCusts) AS newCustsMTD&#xD;&#xA;			FROM &#xD;&#xA;				[BiLogiReporting].[dbo].[rptNewCustomerDaily_new] nc WITH (NOLOCK)&#xD;&#xA;			WHERE&#xD;&#xA;				rptDate &gt;= @start &#xD;&#xA;				AND rptDate &lt; @end&#xD;&#xA;			GROUP BY &#xD;&#xA;				Region&#xD;&#xA;				, Channel&#xD;&#xA;				, SubCategory&#xD;&#xA;		) x &#xD;&#xA;		ON o.Region = x.Region &#xD;&#xA;		AND o.Channel = x.Channel&#xD;&#xA;		AND o.SubCategory = x.SubCategory&#xD;&#xA;	OPTION (MAXDOP 1);&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;	-- update w/actual PY numbers&#xD;&#xA;	UPDATE&#xD;&#xA;		o&#xD;&#xA;	SET &#xD;&#xA;		newCustsPY = x.newCustsPY&#xD;&#xA;	FROM &#xD;&#xA;		@output o&#xD;&#xA;		INNER JOIN&#xD;&#xA;			(&#xD;&#xA;				SELECT&#xD;&#xA;					Region&#xD;&#xA;					, Channel&#xD;&#xA;					, SubCategory&#xD;&#xA;					, SUM (NewCusts) AS newCustsPY&#xD;&#xA;				FROM &#xD;&#xA;					[BiLogiReporting].[dbo].[rptNewCustomerDaily_new] nc WITH (NOLOCK)&#xD;&#xA;				WHERE&#xD;&#xA;					rptDate &gt;= DATEADD(YEAR, -1, @start) &#xD;&#xA;					AND rptDate &lt; DATEADD(YEAR, -1, DATEADD(MONTH, 1, @start))&#xD;&#xA;				GROUP BY &#xD;&#xA;					Region&#xD;&#xA;					, Channel&#xD;&#xA;					, SubCategory&#xD;&#xA;			) x &#xD;&#xA;			ON o.Region = x.Region &#xD;&#xA;			AND o.Channel = x.Channel&#xD;&#xA;			AND o.SubCategory = x.SubCategory&#xD;&#xA;	&#xD;&#xA;	-- if not current month, set MTD totals = actual MTD totals, not projections&#xD;&#xA;	IF @isCurrentMonth = @false&#xD;&#xA;		BEGIN&#xD;&#xA;			UPDATE &#xD;&#xA;				o&#xD;&#xA;			SET &#xD;&#xA;				newCustsMonthEnd = x.newCustsMonthEnd&#xD;&#xA;			FROM &#xD;&#xA;				@output o&#xD;&#xA;				INNER JOIN &#xD;&#xA;					(&#xD;&#xA;						SELECT&#xD;&#xA;							Region&#xD;&#xA;							, Channel&#xD;&#xA;							, SubCategory&#xD;&#xA;							, SUM(NewCusts) AS newCustsMonthEnd&#xD;&#xA;						FROM &#xD;&#xA;							[BiLogiReporting].[dbo].[rptNewCustomerDaily_new] nc WITH (NOLOCK)&#xD;&#xA;						WHERE&#xD;&#xA;							rptDate &gt;= @start&#xD;&#xA;							AND rptDate &lt; DATEADD(MONTH, 1, @start)&#xD;&#xA;						GROUP BY &#xD;&#xA;							Region&#xD;&#xA;							, Channel&#xD;&#xA;							, SubCategory&#xD;&#xA;					) x &#xD;&#xA;					ON o.Region = x.Region &#xD;&#xA;					AND o.Channel = x.Channel&#xD;&#xA;					AND o.SubCategory = x.SubCategory&#xD;&#xA;			OPTION (MAXDOP 1);&#xD;&#xA;		END&#xD;&#xA;&#xD;&#xA;	-- output&#xD;&#xA;	SELECT&#xD;&#xA;		a.region&#xD;&#xA;		, a.sortOrder&#xD;&#xA;		, a.newCustsMTDRegion&#xD;&#xA;		, a.newCustsMonthEndRegion&#xD;&#xA;		, a.newCustsPYRegion&#xD;&#xA;		, a.varianceRegion&#xD;&#xA;		, COALESCE(budget.NewCusts,0) AS budget&#xD;&#xA;		, a.newCustsMonthEndRegion - COALESCE(budget.NewCusts,0) AS varBudget&#xD;&#xA;	FROM&#xD;&#xA;		(&#xD;&#xA;		SELECT &#xD;&#xA;			o.region&#xD;&#xA;			, COALESCE(RH.sortOrder, 999) AS sortOrder&#xD;&#xA;			, SUM(o.newCustsMTD) AS newCustsMTDRegion&#xD;&#xA;			, SUM((o.newCustsMonthEnd) * @marketingFactor) AS newCustsMonthEndRegion&#xD;&#xA;			, SUM(o.newCustsPY) AS newCustsPYRegion&#xD;&#xA;			, (SUM(o.newCustsMonthEnd) * @marketingFactor) - SUM(o.newCustsPY) AS varianceRegion&#xD;&#xA;		FROM &#xD;&#xA;			@output o &#xD;&#xA;			LEFT OUTER JOIN [BiLogiReporting].[dbo].[rptNewCustomerDaily_RegionHeadings] RH WITH (NOLOCK)&#xD;&#xA;				ON o.region = RH.region&#xD;&#xA;		GROUP BY &#xD;&#xA;			o.region&#xD;&#xA;			, COALESCE(RH.sortOrder, 999)&#xD;&#xA;		) AS a&#xD;&#xA;	LEFT OUTER JOIN&#xD;&#xA;		(&#xD;&#xA;		SELECT&#xD;&#xA;			RptRegion&#xD;&#xA;			, sum(NewCusts) as NewCusts&#xD;&#xA;		FROM &#xD;&#xA;			[BiLogiReporting].[dbo].[rptNewCustomerBudget] WITH (NOLOCK)&#xD;&#xA;		WHERE &#xD;&#xA;			month = @start&#xD;&#xA;		GROUP BY &#xD;&#xA;			RptRegion&#xD;&#xA;		) budget on a.Region = budget.RptRegion&#xD;&#xA;    ORDER BY &#xD;&#xA;		a.sortOrder		" ConnectionID="connM1BIG-BIGReporting" ID="dlNewCustomersRegion">
              <SortFilter SortColumn="sortOrder" DataType="Number" SortSequence="Ascending" />
              <CalculatedColumn Formula="@Data.newCustsMonthEndRegion~ - @Data.newCustsPYRegion~" ID="ccVarianceRegion" />
              <CalculatedColumn Formula="@Data.newCustsMonthEndRegion~ / @Data.newCustsPYRegion~ -1" ID="ccVariancePctRegion" ErrorResult="0" />
              <DataLayerLink ID="dlLinkNewCustomersRegion" />
              <AggregateColumn AggregateColumn="newCustsMonthEndRegion" ID="aggNewCustsMonthEndRegion" AggregateFunction="Sum" />
              <AggregateColumn AggregateColumn="newCustsPYRegion" ID="aggNewCustsPYRegion" AggregateFunction="Sum" />
              <CalculatedColumn Formula="@Data.aggNewCustsMonthEndRegion~ / @Data.aggNewCustsPYRegion~ -1" ID="ccVarianceTotalPctRegion" ErrorResult="0" />
            </DataLayer>
            <DataTableColumn ID="colRegion" Header="Region" Width="100">
              <Label ID="lblRegion" Caption="@Data.region~">
                <Action Type="ShowElement" ID="actShowChannelRegions" ElementID="mirChannelRegions" />
              </Label>
              <Remark>
                <DataColumnSort DataColumn="sortOrder" />
              </Remark>
            </DataTableColumn>
            <DataTableColumn ID="colnewCustsMTDRegion" Header="MTD" Class="ThemeAlignRight" IdeDisplayStatus="Collapsed">
              <Label ID="lblnewCustsMTDRegion" Caption="@Data.newCustsMTDRegion~" Format="#,0" />
              <DataColumnSort DataColumn="newCustsMTDRegion" DataType="Number" />
              <DataColumnSummary DataColumn="newCustsMTDRegion" Function="Sum" ID="dcSumNewCustsMTDRegion" />
            </DataTableColumn>
            <DataTableColumn ID="colnewCustsMonthEndRegion" Header="=MonthName(Month(&quot;@Request.rptMonth~&quot;),&quot;true&quot;)+&quot; &quot;+Year(&quot;@Request.rptMonth~&quot;)+&quot;*&quot;" Class="ThemeAlignRight" IdeDisplayStatus="Collapsed">
              <Label ID="lblnewCustsMonthEndRegion" Caption="@Data.newCustsMonthEndRegion~" Format="#,0" />
              <DataColumnSort DataColumn="newCustsMonthEndRegion" DataType="Number" />
              <DataColumnSummary DataColumn="newCustsMonthEndRegion" Function="Sum" ID="dcSumNewCustsMonthEndRegion" />
            </DataTableColumn>
            <DataTableColumn ID="colnewCustsPYRegion" Header="=MonthName(Month(&quot;@Request.rptMonth~&quot;),&quot;true&quot;)+&quot; &quot;+Year(Dateadd(&quot;yyyy&quot;,&quot;-1&quot;,&quot;@Request.rptMonth~&quot;))" Class="ThemeAlignRight" IdeDisplayStatus="Collapsed">
              <Label ID="lblnewCustsPYRegion" Caption="@Data.newCustsPYRegion~" Format="#,0" />
              <DataColumnSort DataColumn="newCustsPYRegion" DataType="Number" />
              <DataColumnSummary DataColumn="newCustsPYRegion" Function="Sum" ID="dcSumNewCustsPYRegion" />
            </DataTableColumn>
            <DataTableColumn ID="colccVarianceRegion" Header="var" Class="ThemeAlignRight" IdeDisplayStatus="Collapsed" Tooltip="Variance vs Prior Year">
              <Label ID="lblccVarianceRegion" Caption="@Data.ccVarianceRegion~" Format="#,#;(#,#)">
                <ConditionalClass Class="ThemeTextNegative" Condition="@Data.ccVarianceRegion~ &lt; 0" />
              </Label>
              <DataColumnSort DataColumn="ccVarianceRegion" />
              <DataColumnSummary DataColumn="ccVarianceRegion" Function="Sum" ID="dcVarianceRegion" />
            </DataTableColumn>
            <DataTableColumn ID="colccVariancePctRegion" Header="% var" Class="ThemeAlignRight" Tooltip="Variance vs Prior Year" IdeDisplayStatus="Collapsed">
              <Label ID="lblccVariancePctRegion" Caption="@Data.ccVariancePctRegion~" Format="0.0%;(0.0%)">
                <TooltipPanel ID="tpRegion">
                  <Chart Type="XY" XYChartType="Line" ChartHeight="250" ChartWidth="360" ChartDataColumn="newCusts" ChartLabelColumn="rptDate" ChartTitle="@Data.region~ 30-day trend vs PY" LegendLabel="Current" BackgroundColor="White">
                    <DataLayer Type="SQL" Source="declare @ReportDate datetime = '@Request.rptDay~'&#xD;&#xA;&#xD;&#xA;select&#xD;&#xA;	a.rptDate&#xD;&#xA;	, newCusts&#xD;&#xA;	, pyDate&#xD;&#xA;	, newCustsPY&#xD;&#xA;from&#xD;&#xA;(&#xD;&#xA;select&#xD;&#xA;	rptDate&#xD;&#xA;	, sum(newCusts) as newCusts&#xD;&#xA;from [BiLogiReporting].[dbo].[rptNewCustomerDaily_new] nc (nolock)&#xD;&#xA;where rptDate &gt; dateadd(d, -30, @ReportDate) and rptDate &lt; @ReportDate&#xD;&#xA;and Region = '@Data.region~'&#xD;&#xA;group by rptDate&#xD;&#xA;) a&#xD;&#xA;left join&#xD;&#xA;(&#xD;&#xA;select&#xD;&#xA;	dateadd(d,364,rptDate) as rptDate&#xD;&#xA;	, rptDate as pyDate&#xD;&#xA;	, sum(newCusts) as newCustsPY&#xD;&#xA;from [BiLogiReporting].[dbo].[rptNewCustomerDaily_new] nc (nolock)&#xD;&#xA;where rptDate &gt; dateadd(d, -394, @ReportDate) and rptDate &lt; dateadd(d,-364,@ReportDate)&#xD;&#xA;and Region = '@Data.region~'&#xD;&#xA;group by dateadd(d,364,rptDate)&#xD;&#xA;	, rptDate&#xD;&#xA;) b on a.rptdate = b.rptdate&#xD;&#xA;order by rptDate&#xD;&#xA;;" ConnectionID="connM1BIG-BIGReporting" />
                    <ExtraXYDataColumn ChartDataColumn="newCustsPY" LegendLabel="PY" />
                    <FontLabel FontAngle="45" FontSize="8" BorderColor="Black" FontColor="Black" />
                    <LabelScale LinearTickIncrement="Weeks" LinearTickMinorIncrement="Weeks" Format="MM/dd" ScalingMode="LinearTime" />
                    <DataScale Format="#,#" />
                    <FontChartTitle FontSize="10" FontColor="Black" />
                    <FontData FontSize="8" FontColor="Black" BorderColor="Black" />
                    <Legend LegendOrientation="Horizontal" LegendTop="170" LegendLeft="160" BackgroundColor="White" BorderColor="White">
                      <FontLegend FontSize="8" FontColor="Black" />
                    </Legend>
                  </Chart>
                </TooltipPanel>
                <ConditionalClass Class="ThemeTextNegative" Condition="@Data.ccVariancePctRegion~ &lt; 0" />
              </Label>
              <DataColumnSort DataColumn="ccVariancePctRegion" />
              <DataColumnSummary DataColumn="ccVarianceTotalPctRegion" Function="Average" ID="dcVariancePctRegion" />
            </DataTableColumn>
            <DataTableColumn ID="colBudget" Header="Budget" Class="ThemeAlignRight" IdeDisplayStatus="Collapsed" Tooltip="2.75M Budget">
              <Label ID="lblBudget" Caption="@Data.budget~" Format="#,0" />
              <DataColumnSort DataColumn="budget" DataType="Number" />
              <DataColumnSummary DataColumn="budget" Function="Sum" ID="dcSumBudget" />
            </DataTableColumn>
            <DataTableColumn ID="colVarBudget" Header="vtb" Class="ThemeAlignRight" IdeDisplayStatus="Collapsed" Tooltip="Variance to Budget">
              <Label ID="lblVarBudget" Caption="@Data.varBudget~" Format="#,#;(#,#)">
                <ConditionalClass Class="ThemeTextNegative" Condition="@Data.varBudget~ &lt; 0" />
              </Label>
              <DataColumnSort DataColumn="varBudget" DataType="Number" />
              <DataColumnSummary DataColumn="varBudget" Function="Sum" ID="dcSumVarBudget" />
            </DataTableColumn>
            <SummaryRow ID="srTotalRegion" Caption="Total" />
            <MoreInfoRow ID="mirChannelRegions" ShowModes="None" ColumnSpanFirst="2" IdeDisplayStatus="Collapsed">
              <IncludeFrame ID="srptChannelRegions" Width="700" Height="400">
                <Target Type="IncludeFrameReport" ID="tgtChannelRegions" Report="Dashboards.Acquisitions.NewCustomerRegionViewDrillDown" RequestForwarding="True" />
                <LinkParams rptDay="@Request.rptDay~" rptMonth="@Request.rptMonth~" marketingFactor="@Local.calcProjectionMarketingFactor~" region="@Data.region~" rptCurrentMonth="@Request.rptCurrentMonth~" />
              </IncludeFrame>
            </MoreInfoRow>
          </DataTable>
          <DataTable ID="dtNewCustTableRegionInt" Width="550" WidthScale="px" IdeDisplayStatus="Collapsed">
            <DataLayer Type="SQL" Source="/********************************************************************************************************************&#xD;&#xA;    Name:			New Customers By Region&#xD;&#xA;    Author:			Scott Cooper&#xD;&#xA;    Create Date:	2013/05/01&#xD;&#xA;    Description:	This displays new customer information by region&#xD;&#xA;	&#xD;&#xA;    Processing:&#xD;&#xA;&#xD;&#xA;    Assumptions / Special Processing:&#xD;&#xA;&#xD;&#xA;    User-Defined Variables:&#xD;&#xA;	    @start				DATE			/*  Start Date for measurement (beginning of month)		*/&#xD;&#xA;		@end				DATE			/*	End Date for measurement							*/&#xD;&#xA;		@current			DATE			/*	Current Month start date							*/&#xD;&#xA;		@isCurrentMonth		INT				/*	Is measurement month same as current month?			*/&#xD;&#xA;		@marketingFactor	FLOAT			/*	Multiplier based on economic day projectiong		*/&#xD;&#xA;		@econDays_mtd  		FLOAT 			/*	Economic days MTD									*/&#xD;&#xA;		@econDays_monthEnd 	FLOAT 			/*	Economic days for full measurement month			*/&#xD;&#xA;		@econDays_14d 		FLOAT 			/*	Economic days for past 14 days						*/&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;	Temporary Tables Utilized:&#xD;&#xA;        @output             Table containing results to display&#xD;&#xA;&#xD;&#xA;    Modifications:&#xD;&#xA;        20130501    Scott Cooper			Updates to initial coding by MXNguyen&#xD;&#xA;		20130710	Mike Nguyen				Added Budget&#xD;&#xA;&#xD;&#xA;*******************************************************************************************************************/&#xD;&#xA;SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;&#xD;&#xA;SET NOCOUNT ON;&#xD;&#xA;SET STATISTICS IO OFF;&#xD;&#xA;SET STATISTICS TIME OFF;&#xD;&#xA;&#xD;&#xA;/********************/&#xD;&#xA;/*  Declarations    */&#xD;&#xA;/************************************************************************************************************************/&#xD;&#xA;/*  This section defined variables and constants used in the programs                                                   */&#xD;&#xA;/************************************************************************************************************************/&#xD;&#xA;&#xD;&#xA;    /********************************************************************************************************************/&#xD;&#xA;    /*  Standard variable values                                                                                        */&#xD;&#xA;    /********************************************************************************************************************/&#xD;&#xA;	DECLARE @true	INT = 1&#xD;&#xA;	DECLARE @false 	INT = 0&#xD;&#xA;&#xD;&#xA;    /********************************************************************************************************************/&#xD;&#xA;    /*	Pre-Defined Constants																							*/&#xD;&#xA;    /********************************************************************************************************************/&#xD;&#xA;	&#xD;&#xA;    /********************************************************************************************************************/&#xD;&#xA;    /*	Passed Variables                                                                                                */&#xD;&#xA;    /********************************************************************************************************************/&#xD;&#xA;	DECLARE @start 				DATE = '@Request.rptMonth~'&#xD;&#xA;	DECLARE @end 				DATE = '@Request.rptDay~'&#xD;&#xA;	DECLARE @current 			DATE = '@Request.rptCurrentMonth~'&#xD;&#xA;&#xD;&#xA;    /********************************************************************************************************************/&#xD;&#xA;    /*	Variables set during the course of the code execution															*/&#xD;&#xA;    /********************************************************************************************************************/&#xD;&#xA;	DECLARE @isCurrentMonth 	INT = CASE WHEN @start = @current THEN @true ELSE @false END&#xD;&#xA;	DECLARE @marketingFactor 	FLOAT = CASE WHEN @isCurrentMonth = @true THEN CAST('@Local.calcProjectionMarketingFactor~' AS FLOAT) ELSE 1.0 END&#xD;&#xA;&#xD;&#xA;	DECLARE @econDays_mtd  		FLOAT &#xD;&#xA;	DECLARE @econDays_monthEnd 	FLOAT &#xD;&#xA;	DECLARE @econDays_14d 		FLOAT &#xD;&#xA;&#xD;&#xA;&#xD;&#xA;/********************/&#xD;&#xA;/*  Initial Setup   */&#xD;&#xA;/********************************************************************************************************************/&#xD;&#xA;/*  This section creates the needed table structures and assigns the promo codes and pf_IDs to be measured          */&#xD;&#xA;/********************************************************************************************************************/&#xD;&#xA;&#xD;&#xA;	DECLARE @output TABLE(&#xD;&#xA;		region 				VARCHAR(50)&#xD;&#xA;		, channel 			VARCHAR(50)&#xD;&#xA;		, subCategory		VARCHAR(50)&#xD;&#xA;		, newCustsMTD 		INT 			DEFAULT 0&#xD;&#xA;		, newCusts14d 		INT 			DEFAULT 0&#xD;&#xA;		, rate14d 			FLOAT 			DEFAULT 0&#xD;&#xA;		, newCustsMonthEnd 	FLOAT 			DEFAULT 0&#xD;&#xA;		, newCustsPY 		INT				DEFAULT 0&#xD;&#xA;		)&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;/********************/&#xD;&#xA;/*  Processing		*/&#xD;&#xA;/********************************************************************************************************************/&#xD;&#xA;/*  This section processes the needed information																	*/&#xD;&#xA;/********************************************************************************************************************/&#xD;&#xA;	SELECT @econDays_mtd = SUM(economicDays) FROM biLogiReporting.dbo.rptNewCustomerEconomicDays d (NOLOCK) WHERE acquisitionDate &gt;= @start AND acquisitionDate &lt; @end&#xD;&#xA;	SELECT @econDays_monthEnd = SUM(economicDays) FROM biLogiReporting.dbo.rptNewCustomerEconomicDays d (NOLOCK) WHERE acquisitionDate &gt;= @start AND acquisitionDate &lt; DATEADD(MONTH, 1, @start)&#xD;&#xA;	SELECT @econDays_14d = SUM(economicDays) FROM biLogiReporting.dbo.rptNewCustomerEconomicDays d (NOLOCK) WHERE acquisitionDate &gt;= DATEADD(d,-14,@end) AND acquisitionDate &lt; @end&#xD;&#xA;&#xD;&#xA;	-- populate the regions, subcategories &amp; channels&#xD;&#xA;	INSERT INTO @output(&#xD;&#xA;		region&#xD;&#xA;		, channel&#xD;&#xA;		, subCategory&#xD;&#xA;		)&#xD;&#xA;	SELECT DISTINCT &#xD;&#xA;		CASE WHEN Region = 'China' THEN 'China'&#xD;&#xA;			ELSE 'Other International' END&#xD;&#xA;		, Channel&#xD;&#xA;		, SubCategory &#xD;&#xA;	FROM &#xD;&#xA;		[BiLogiReporting].[dbo].[rptNewCustomerDaily_new] WITH (NOLOCK)&#xD;&#xA;	WHERE&#xD;&#xA;    	rptDate &gt;= DATEADD(YEAR, -1, @start)&#xD;&#xA;		AND Region != 'United States'&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;    -- update w/current new customers (last 14 days)&#xD;&#xA;	UPDATE &#xD;&#xA;		o&#xD;&#xA;	SET &#xD;&#xA;		region = x.region&#xD;&#xA;		, channel = x.channel&#xD;&#xA;		, subCategory = x.subcategory&#xD;&#xA;		, newCusts14d = x.newCusts14d&#xD;&#xA;		, rate14d = x.rate14d&#xD;&#xA;	FROM &#xD;&#xA;		@output o&#xD;&#xA;		INNER JOIN &#xD;&#xA;			(&#xD;&#xA;				SELECT&#xD;&#xA;					CASE WHEN Region = 'China' THEN 'China'&#xD;&#xA;						ELSE 'Other International' END AS Region&#xD;&#xA;					, Channel&#xD;&#xA;					, SubCategory&#xD;&#xA;					, SUM(NewCusts) AS newCusts14d&#xD;&#xA;					, SUM(NewCusts) / @econDays_14d AS rate14d&#xD;&#xA;				FROM &#xD;&#xA;					[BiLogiReporting].[dbo].[rptNewCustomerDaily_new] nc WITH (NOLOCK)&#xD;&#xA;				WHERE&#xD;&#xA;					rptDate &gt;= DATEADD(DAY, -14, @end) &#xD;&#xA;					AND rptDate &lt; @end&#xD;&#xA;					AND Region != 'United States'&#xD;&#xA;				GROUP BY &#xD;&#xA;					CASE WHEN Region = 'China' THEN 'China'&#xD;&#xA;						ELSE 'Other International' END&#xD;&#xA;					, Channel&#xD;&#xA;					, SubCategory&#xD;&#xA;			) x &#xD;&#xA;			ON o.Region = x.Region &#xD;&#xA;			AND o.Channel = x.Channel&#xD;&#xA;			AND o.SubCategory = x.SubCategory&#xD;&#xA;	OPTION (MAXDOP 1);&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;	-- update w/actual MTD numbers and project ME numbers&#xD;&#xA;	UPDATE &#xD;&#xA;		o&#xD;&#xA;	SET &#xD;&#xA;		newCustsMTD = x.newCustsMTD&#xD;&#xA;    	, newCustsMonthEnd = CASE WHEN @isCurrentMonth = @true THEN COALESCE(x.newCustsMTD, 0) + (@econDays_monthEnd - @econDays_mtd) * o.rate14d ELSE 0 END&#xD;&#xA;	FROM &#xD;&#xA;		@output o&#xD;&#xA;	LEFT OUTER JOIN&#xD;&#xA;		(&#xD;&#xA;			SELECT &#xD;&#xA;				CASE WHEN Region = 'China' THEN 'China'&#xD;&#xA;					ELSE 'Other International' END AS Region&#xD;&#xA;				, Channel&#xD;&#xA;				, SuBCategory&#xD;&#xA;				, SUM(NewCusts) AS newCustsMTD&#xD;&#xA;			FROM &#xD;&#xA;				[BiLogiReporting].[dbo].[rptNewCustomerDaily_new] nc WITH (NOLOCK)&#xD;&#xA;			WHERE&#xD;&#xA;				rptDate &gt;= @start &#xD;&#xA;				AND rptDate &lt; @end&#xD;&#xA;				AND Region != 'United States'&#xD;&#xA;			GROUP BY &#xD;&#xA;				CASE WHEN Region = 'China' THEN 'China'&#xD;&#xA;					ELSE 'Other International' END&#xD;&#xA;				, Channel&#xD;&#xA;				, SubCategory&#xD;&#xA;		) x &#xD;&#xA;		ON o.Region = x.Region &#xD;&#xA;		AND o.Channel = x.Channel&#xD;&#xA;		AND o.SubCategory = x.SubCategory&#xD;&#xA;	OPTION (MAXDOP 1);&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;	-- update w/actual PY numbers&#xD;&#xA;	UPDATE&#xD;&#xA;		o&#xD;&#xA;	SET &#xD;&#xA;		newCustsPY = x.newCustsPY&#xD;&#xA;	FROM &#xD;&#xA;		@output o&#xD;&#xA;		INNER JOIN&#xD;&#xA;			(&#xD;&#xA;				SELECT&#xD;&#xA;					CASE WHEN Region = 'China' THEN 'China'&#xD;&#xA;						ELSE 'Other International' END AS Region&#xD;&#xA;					, Channel&#xD;&#xA;					, SubCategory&#xD;&#xA;					, SUM (NewCusts) AS newCustsPY&#xD;&#xA;				FROM &#xD;&#xA;					[BiLogiReporting].[dbo].[rptNewCustomerDaily_new] nc WITH (NOLOCK)&#xD;&#xA;				WHERE&#xD;&#xA;					rptDate &gt;= DATEADD(YEAR, -1, @start) &#xD;&#xA;					AND rptDate &lt; DATEADD(YEAR, -1, DATEADD(MONTH, 1, @start))&#xD;&#xA;					AND Region != 'United States'&#xD;&#xA;				GROUP BY &#xD;&#xA;					CASE WHEN Region = 'China' THEN 'China'&#xD;&#xA;						ELSE 'Other International' END&#xD;&#xA;					, Channel&#xD;&#xA;					, SubCategory&#xD;&#xA;			) x &#xD;&#xA;			ON o.Region = x.Region &#xD;&#xA;			AND o.Channel = x.Channel&#xD;&#xA;			AND o.SubCategory = x.SubCategory&#xD;&#xA;&#xD;&#xA;	-- if not current month, set MTD totals = actual MTD totals, not projections&#xD;&#xA;	IF @isCurrentMonth = @false&#xD;&#xA;		BEGIN&#xD;&#xA;			UPDATE &#xD;&#xA;				o&#xD;&#xA;			SET &#xD;&#xA;				newCustsMonthEnd = x.newCustsMonthEnd&#xD;&#xA;			FROM &#xD;&#xA;				@output o&#xD;&#xA;				INNER JOIN &#xD;&#xA;					(&#xD;&#xA;						SELECT&#xD;&#xA;							CASE WHEN Region = 'China' THEN 'China'&#xD;&#xA;								ELSE 'Other International' END AS Region&#xD;&#xA;							, Channel&#xD;&#xA;							, SubCategory&#xD;&#xA;							, SUM(NewCusts) AS newCustsMonthEnd&#xD;&#xA;						FROM &#xD;&#xA;							[BiLogiReporting].[dbo].[rptNewCustomerDaily_new] nc WITH (NOLOCK)&#xD;&#xA;						WHERE&#xD;&#xA;							rptDate &gt;= @start&#xD;&#xA;							AND rptDate &lt; DATEADD(MONTH, 1, @start)&#xD;&#xA;							AND Region != 'United States'&#xD;&#xA;						GROUP BY &#xD;&#xA;							CASE WHEN Region = 'China' THEN 'China'&#xD;&#xA;								ELSE 'Other International' END &#xD;&#xA;							, Channel&#xD;&#xA;							, SubCategory&#xD;&#xA;					) x &#xD;&#xA;					ON o.Region = x.Region &#xD;&#xA;					AND o.Channel = x.Channel&#xD;&#xA;					AND o.SubCategory = x.SubCategory&#xD;&#xA;			OPTION (MAXDOP 1);&#xD;&#xA;		END&#xD;&#xA;&#xD;&#xA;	&#xD;&#xA;	-- output&#xD;&#xA;	SELECT&#xD;&#xA;		a.regionInt&#xD;&#xA;		, a.newCustsMTDRegionInt&#xD;&#xA;		, a.newCustsMonthEndRegionInt&#xD;&#xA;		, a.newCustsPYRegionInt&#xD;&#xA;		, a.varianceRegionInt&#xD;&#xA;		, ISNULL(budget.NewCusts,0) AS budget&#xD;&#xA;		, (a.newCustsMonthEndRegionInt * @marketingFactor) - ISNULL(budget.NewCusts,0) AS varBudget&#xD;&#xA;	FROM&#xD;&#xA;		(&#xD;&#xA;		SELECT &#xD;&#xA;			'Intl Total' AS regionInt&#xD;&#xA;			, SUM(o.newCustsMTD) AS newCustsMTDRegionInt&#xD;&#xA;			, SUM((o.newCustsMonthEnd) * @marketingFactor) AS newCustsMonthEndRegionInt&#xD;&#xA;			, SUM(o.newCustsPY) AS newCustsPYRegionInt&#xD;&#xA;			, (SUM(o.newCustsMonthEnd) * @marketingFactor) - SUM(o.newCustsPY) AS varianceRegionInt&#xD;&#xA;		FROM &#xD;&#xA;			@output o &#xD;&#xA;		) AS a&#xD;&#xA;	CROSS JOIN&#xD;&#xA;		(&#xD;&#xA;		SELECT&#xD;&#xA;			SUM(NewCusts) as NewCusts&#xD;&#xA;		FROM [BiLogiReporting].[dbo].[rptNewCustomerBudget] WITH (NOLOCK)&#xD;&#xA;		WHERE month = @start&#xD;&#xA;			and RptRegion &lt;&gt; 'United States'&#xD;&#xA;		) budget &#xD;&#xA;&#xD;&#xA;	UNION ALL&#xD;&#xA;&#xD;&#xA;	SELECT&#xD;&#xA;		a.regionInt&#xD;&#xA;		, a.newCustsMTDRegionInt&#xD;&#xA;		, a.newCustsMonthEndRegionInt&#xD;&#xA;		, a.newCustsPYRegionInt&#xD;&#xA;		, a.varianceRegionInt&#xD;&#xA;		, ISNULL(budget.NewCusts,0) AS budget&#xD;&#xA;		, (a.newCustsMonthEndRegionInt * @marketingFactor) - ISNULL(budget.NewCusts,0) AS varBudget&#xD;&#xA;	FROM&#xD;&#xA;		(&#xD;&#xA;		SELECT &#xD;&#xA;			'Intl excl China' AS regionInt&#xD;&#xA;			, SUM(o.newCustsMTD) AS newCustsMTDRegionInt&#xD;&#xA;			, SUM((o.newCustsMonthEnd) * @marketingFactor) AS newCustsMonthEndRegionInt&#xD;&#xA;			, SUM(o.newCustsPY) AS newCustsPYRegionInt&#xD;&#xA;			, (SUM(o.newCustsMonthEnd) * @marketingFactor) - SUM(o.newCustsPY) AS varianceRegionInt&#xD;&#xA;		FROM &#xD;&#xA;			@output o &#xD;&#xA;		WHERE region != 'China'&#xD;&#xA;		GROUP BY &#xD;&#xA;			o.region&#xD;&#xA;		) AS a&#xD;&#xA;	CROSS JOIN&#xD;&#xA;		(&#xD;&#xA;		SELECT&#xD;&#xA;			SUM(NewCusts) as NewCusts&#xD;&#xA;		FROM [BiLogiReporting].[dbo].[rptNewCustomerBudget] WITH (NOLOCK)&#xD;&#xA;		WHERE month = @start&#xD;&#xA;			and RptRegion NOT IN ('United States', 'China')&#xD;&#xA;		) budget &#xD;&#xA;&#xD;&#xA;    ORDER BY &#xD;&#xA;		regionInt desc&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;" ConnectionID="connM1BIG-BIGReporting" ID="dlNewCustomersRegionInt" IdeDisplayStatus="Collapsed">
              <CalculatedColumn Formula="@Data.newCustsMonthEndRegionInt~ - @Data.newCustsPYRegionInt~" ID="ccVarianceRegionInt" />
              <CalculatedColumn Formula="@Data.newCustsMonthEndRegionInt~ / @Data.newCustsPYRegionInt~ -1" ID="ccVariancePctRegionInt" ErrorResult="0" />
              <DataLayerLink ID="dlLinkNewCustomersRegionInt" />
              <AggregateColumn AggregateColumn="newCustsMonthEndRegionInt" ID="aggNewCustsMonthEndRegionInt" AggregateFunction="Sum" />
              <AggregateColumn AggregateColumn="newCustsPYRegionInt" ID="aggNewCustsPYRegionInt" AggregateFunction="Sum" />
              <CalculatedColumn Formula="@Data.aggNewCustsMonthEndRegionInt~ / @Data.aggNewCustsPYRegionInt~-1" ID="ccVarianceTotalPctRegionInt" ErrorResult="0" />
            </DataLayer>
            <DataTableColumn ID="colRegionInt" Header="International">
              <Label ID="lblRegionInt" Caption="@Data.regionInt~">
                <Remark>
                  <Action Type="ShowElement" ID="actShowChannelRegionsInt" ElementID="mirChannelRegionsInt" />
                </Remark>
              </Label>
              <DataColumnSort DataColumn="region" />
            </DataTableColumn>
            <DataTableColumn ID="colnewCustsMTDRegionInt" Header="MTD" Class="ThemeAlignRight" IdeDisplayStatus="Collapsed">
              <Label ID="lblnewCustsMTDRegionInt" Caption="@Data.newCustsMTDRegionInt~" Format="#,0" />
              <DataColumnSort DataColumn="newCustsMTDRegionInt" DataType="Number" />
              <DataColumnSummary DataColumn="newCustsMTDRegionInt" Function="Sum" ID="dcSumNewCustsMTDRegionInt" />
            </DataTableColumn>
            <DataTableColumn ID="colnewCustsMonthEndRegionInt" Header="=MonthName(Month(&quot;@Request.rptMonth~&quot;),&quot;true&quot;)+&quot; &quot;+Year(&quot;@Request.rptMonth~&quot;)+&quot;*&quot;" Class="ThemeAlignRight" IdeDisplayStatus="Collapsed">
              <Label ID="lblnewCustsMonthEndRegionInt" Caption="@Data.newCustsMonthEndRegionInt~" Format="#,0" />
              <DataColumnSort DataColumn="newCustsMonthEndRegionInt" DataType="Number" />
              <DataColumnSummary DataColumn="newCustsMonthEndRegionInt" Function="Sum" ID="dcSumNewCustsMonthEndRegionInt" />
            </DataTableColumn>
            <DataTableColumn ID="colnewCustsPYRegionInt" Header="=MonthName(Month(&quot;@Request.rptMonth~&quot;),&quot;true&quot;)+&quot; &quot;+Year(Dateadd(&quot;yyyy&quot;,&quot;-1&quot;,&quot;@Request.rptMonth~&quot;))" Class="ThemeAlignRight" IdeDisplayStatus="Collapsed">
              <Label ID="lblnewCustsPYRegionInt" Caption="@Data.newCustsPYRegionInt~" Format="#,0" />
              <DataColumnSort DataColumn="newCustsPYRegionInt" DataType="Number" />
              <DataColumnSummary DataColumn="newCustsPYRegionInt" Function="Sum" ID="dcSumNewCustsPYRegionInt" />
            </DataTableColumn>
            <DataTableColumn ID="colccVarianceRegionInt" Header="var" Class="ThemeAlignRight" IdeDisplayStatus="Collapsed">
              <Label ID="lblccVarianceRegionInt" Caption="@Data.ccVarianceRegionInt~" Format="#,#;(#,#)">
                <ConditionalClass Class="ThemeTextNegative" Condition="@Data.ccVarianceRegionInt~ &lt; 0" />
              </Label>
              <DataColumnSort DataColumn="ccVarianceRegionInt" />
              <DataColumnSummary DataColumn="ccVarianceRegionInt" Function="Sum" ID="dcVarianceRegionInt" />
            </DataTableColumn>
            <DataTableColumn ID="colccVariancePctRegionInt" Header="% var" Class="ThemeAlignRight">
              <Label ID="lblccVariancePctRegionInt" Caption="@Data.ccVariancePctRegionInt~" Format="0.0%;(0.0%)">
                <TooltipPanel ID="tpRegionInt">
                  <Chart Type="XY" XYChartType="Line" ChartHeight="250" ChartWidth="360" ChartDataColumn="newCustsInt" ChartLabelColumn="rptDate" ChartTitle="@Data.regionInt~ 30-day trend vs PY" LegendLabel="Current" BackgroundColor="White">
                    <DataLayer Type="SQL" Source="declare @ReportDate datetime = '@Request.rptDay~'&#xD;&#xA;&#xD;&#xA;select&#xD;&#xA;	a.rptDate&#xD;&#xA;	, newCustsInt&#xD;&#xA;	, pyDate&#xD;&#xA;	, newCustsPYInt&#xD;&#xA;from&#xD;&#xA;(&#xD;&#xA;select&#xD;&#xA;	rptDate&#xD;&#xA;	, sum(newCusts) as newCustsInt&#xD;&#xA;from [BiLogiReporting].[dbo].[rptNewCustomerDaily_new] nc (nolock)&#xD;&#xA;where rptDate &gt; dateadd(d, -30, @ReportDate) and rptDate &lt; @ReportDate&#xD;&#xA;	and (('@Data.regionInt~' = 'Intl excl China' and region not in ('United States','China'))&#xD;&#xA;	or ('@Data.regionInt~' = 'Intl Total' and region not in ('United States')))&#xD;&#xA;group by rptDate&#xD;&#xA;) a&#xD;&#xA;left join&#xD;&#xA;(&#xD;&#xA;select&#xD;&#xA;	dateadd(d,364,rptDate) as rptDate&#xD;&#xA;	, rptDate as pyDate&#xD;&#xA;	, sum(newCusts) as newCustsPYInt&#xD;&#xA;from [BiLogiReporting].[dbo].[rptNewCustomerDaily_new] nc (nolock)&#xD;&#xA;where rptDate &gt; dateadd(d, -394, @ReportDate) and rptDate &lt; dateadd(d,-364,@ReportDate)&#xD;&#xA;	and (('@Data.regionInt~' = 'Intl excl China' and region not in ('United States','China'))&#xD;&#xA;	or ('@Data.regionInt~' = 'Intl Total' and region not in ('United States')))&#xD;&#xA;group by dateadd(d,364,rptDate)&#xD;&#xA;	, rptDate&#xD;&#xA;) b on a.rptdate = b.rptdate&#xD;&#xA;order by rptDate&#xD;&#xA;;" ConnectionID="connM1BIG-BIGReporting" />
                    <ExtraXYDataColumn ChartDataColumn="newCustsPYInt" LegendLabel="PY" />
                    <FontLabel FontAngle="45" FontSize="8" BorderColor="Black" FontColor="Black" />
                    <LabelScale LinearTickIncrement="Weeks" LinearTickMinorIncrement="Weeks" Format="MM/dd" ScalingMode="LinearTime" />
                    <DataScale Format="#,#" />
                    <FontChartTitle FontSize="10" FontColor="Black" />
                    <FontData FontSize="8" FontColor="Black" BorderColor="Black" />
                    <Legend LegendOrientation="Horizontal" LegendTop="170" LegendLeft="160" BackgroundColor="White" BorderColor="White">
                      <FontLegend FontSize="8" FontColor="Black" />
                    </Legend>
                  </Chart>
                </TooltipPanel>
                <ConditionalClass Class="ThemeTextNegative" Condition="@Data.ccVariancePctRegionInt~ &lt; 0" />
              </Label>
              <DataColumnSort DataColumn="ccVariancePctRegionInt" />
              <DataColumnSummary DataColumn="ccVarianceTotalPctRegionInt" Function="Average" ID="dcVariancePctRegionInt" />
            </DataTableColumn>
            <DataTableColumn ID="colBudget" Header="Budget" Class="ThemeAlignRight" IdeDisplayStatus="Collapsed">
              <Label ID="lblBudget" Caption="@Data.budget~" Format="#,0" />
              <DataColumnSort DataColumn="budget" DataType="Number" />
              <DataColumnSummary DataColumn="budget" Function="Sum" ID="dcSumBudget" />
            </DataTableColumn>
            <DataTableColumn ID="colVarBudget" Header="vtb" Class="ThemeAlignRight" IdeDisplayStatus="Collapsed">
              <Label ID="lblVarBudget" Caption="@Data.varBudget~" Format="#,#;(#,#)">
                <ConditionalClass Class="ThemeTextNegative" Condition="@Data.varBudget~ &lt; 0" />
              </Label>
              <DataColumnSort DataColumn="varBudget" DataType="Number" />
              <DataColumnSummary DataColumn="varBudget" Function="Sum" ID="dcSumVarBudget" />
            </DataTableColumn>
          </DataTable>
          <Label Caption="*Projection based on acquisitions per economic day in the prior 14 days" Class="ThemeTextSmall" />
          <LineBreak />
          <Label Caption="Mouseover '%var' column to view chart" Class="ThemeTextSmall" />
        </PanelContent>
      </Panel>
      <Panel ID="pnlNewCust_Trend" Caption="New Customer 30-Day Trend">
        <PanelContent>
          <Division Class="ThemeAlignCenter">
            <Spaces Size="25" />
            <InputSelectList OptionCaptionColumn="region" ID="islNewCustTrendRegion" OptionValueColumn="region" DefaultValue="@Request.islNewCustTrendRegion~" IncludeBlank="True" IncludeBlankCaption="All Regions" IncludeBlankValue="All Regions">
              <DataLayer Type="SQL" ConnectionID="connM1BIG-BIGReporting" Source="SELECT &#xD;&#xA;	detail.region&#xD;&#xA;FROM &#xD;&#xA;	(&#xD;&#xA;		SELECT DISTINCT &#xD;&#xA;			NC.region&#xD;&#xA;			, RH.sortOrder&#xD;&#xA;		FROM &#xD;&#xA;			[BiLogiReporting].[dbo].[rptNewCustomerDaily_new] NC WITH (NOLOCK)&#xD;&#xA;			LEFT OUTER JOIN [BiLogiReporting].[dbo].[rptNewCustomerDaily_RegionHeadings] RH WITH (NOLOCK)&#xD;&#xA;				ON NC.region = RH.region&#xD;&#xA;		WHERE &#xD;&#xA;			NC.rptDate &gt;= '@Request.rptMonth~' &#xD;&#xA;			AND NC.rptDate &lt; '@Request.rptDay~'&#xD;&#xA;	&#xD;&#xA;		UNION ALL&#xD;&#xA;			SELECT 'Intl excl China', 1000&#xD;&#xA; &#xD;&#xA;		UNION ALL&#xD;&#xA;			SELECT 'Intl Total', 1001&#xD;&#xA;	) detail&#xD;&#xA;ORDER BY &#xD;&#xA;	detail.sortOrder &#xD;&#xA;OPTION (MAXDOP 1)&#xD;&#xA;&#xD;&#xA;" ID="dlSelectRegion" />
              <EventHandler DhtmlEvent="onchange">
                <Action Type="RefreshElement" ElementID="divNewCustTrendParent" ID="actRefreshTrend" />
              </EventHandler>
            </InputSelectList>
            <Spaces Size="10" />
            <InputSelectList OptionCaptionColumn="channel" ID="islNewCustTrendChannel" OptionValueColumn="channel" DefaultValue="@Request.islNewCustTrendChannel~" IncludeBlank="True" IncludeBlankCaption="All Channels" IncludeBlankValue="All Channels">
              <DataLayer Type="SQL" ConnectionID="connM1BIG-BIGReporting" Source="SELECT distinct channel&#xD;&#xA;  FROM [BiLogiReporting].[dbo].[rptNewCustomerDaily_new] (nolock)&#xD;&#xA;  where rptDate &gt;= '@Request.rptMonth~' and rptDate &lt; '@Request.rptDay~'&#xD;&#xA;  option(maxdop 1);&#xD;&#xA;" ID="dlSelectChannel" />
              <EventHandler DhtmlEvent="onchange">
                <Action Type="RefreshElement" ElementID="divNewCustTrendParent" ID="actRefreshTrend" />
              </EventHandler>
            </InputSelectList>
            <LineBreak />
            <LineBreak />
          </Division>
          <Division ID="divNewCustTrendParent" Class="ThemeAlignCenter">
            <Division ID="divNewCustTrend" Class="ThemeAlignCenter">
              <Chart Type="XY" XYChartType="Line" ID="chtNewCustTrend" ChartDataColumn="newCusts" ChartHeight="240" ChartWidth="400" ChartLabelColumn="rptDate" LegendLabel="Current" BorderBottom="40px" BorderRight="25px">
                <DataLayer Type="SQL" Source="declare @ReportDate datetime = '@Request.rptDay~'&#xD;&#xA;&#xD;&#xA;select&#xD;&#xA;	a.rptDate&#xD;&#xA;	, newCusts&#xD;&#xA;	, pyDate&#xD;&#xA;	, newCustsPY&#xD;&#xA;from&#xD;&#xA;(&#xD;&#xA;select&#xD;&#xA;	rptDate&#xD;&#xA;	, sum(newCusts) as newCusts&#xD;&#xA;from [BiLogiReporting].[dbo].[rptNewCustomerDaily_new] nc (nolock)&#xD;&#xA;where rptDate &gt; dateadd(d, -30, @ReportDate) and rptDate &lt; @ReportDate&#xD;&#xA;and ((region = '@Request.islNewCustTrendRegion~' or '@Request.islNewCustTrendRegion~' = 'All Regions' or '@Request.islNewCustTrendRegion~' = '')&#xD;&#xA;	or ('@Request.islNewCustTrendRegion~' = 'Intl excl China' and region not in ('United States','China'))&#xD;&#xA;	or ('@Request.islNewCustTrendRegion~' = 'Intl Total' and region not in ('United States')))&#xD;&#xA;and (channel = '@Request.islNewCustTrendChannel~' or '@Request.islNewCustTrendChannel~' = 'All Channels' or '@Request.islNewCustTrendChannel~' = '')&#xD;&#xA;group by rptDate&#xD;&#xA;) a&#xD;&#xA;left outer join&#xD;&#xA;(&#xD;&#xA;select&#xD;&#xA;	dateadd(d,364,rptDate) as rptDate&#xD;&#xA;	, rptDate as pyDate&#xD;&#xA;	, sum(newCusts) as newCustsPY&#xD;&#xA;from [BiLogiReporting].[dbo].[rptNewCustomerDaily_new] nc (nolock)&#xD;&#xA;where rptDate &gt; dateadd(d, -394, @ReportDate) and rptDate &lt; dateadd(d,-364,@ReportDate)&#xD;&#xA;and ((region = '@Request.islNewCustTrendRegion~' or '@Request.islNewCustTrendRegion~' = 'All Regions' or '@Request.islNewCustTrendRegion~' = '')&#xD;&#xA;	or ('@Request.islNewCustTrendRegion~' = 'Intl excl China' and region not in ('United States','China'))&#xD;&#xA;	or ('@Request.islNewCustTrendRegion~' = 'Intl Total' and region not in ('United States')))&#xD;&#xA;and (channel = '@Request.islNewCustTrendChannel~' or '@Request.islNewCustTrendChannel~' = 'All Channels' or '@Request.islNewCustTrendChannel~' = '')&#xD;&#xA;group by dateadd(d,364,rptDate)&#xD;&#xA;	, rptDate&#xD;&#xA;) b on a.rptdate = b.rptdate&#xD;&#xA;order by rptDate&#xD;&#xA;option(maxdop 1);&#xD;&#xA;;&#xD;&#xA;" ConnectionID="connM1BIG-BIGReporting" ID="dlNewCustTrend" />
                <ExtraXYDataColumn ChartDataColumn="newCustsPY" ID="ecNewCustsPY" LegendLabel="PY" />
                <FontLabel FontAngle="0" FontSize="8" BorderColor="Black" FontColor="Black" />
                <LabelScale LinearTickIncrement="Weeks" LinearTickMinorIncrement="Weeks" Format="MM/dd" ScalingMode="LinearTime" />
                <DataScale Format="#,#" />
                <FontChartTitle FontSize="10" FontColor="Black" />
                <FontData FontSize="8" FontColor="Black" BorderColor="Black" />
                <Legend LegendOrientation="Horizontal" LegendLeft="140" LegendTop="220" BorderColor="transparent">
                  <FontLegend FontSize="8" FontColor="Black" />
                </Legend>
              </Chart>
              <LineBreak />
              <Label Caption="Show Data" Class="gdDecorated">
                <Action Type="ShowElement" ElementID="divNewCustTrendData" ID="actShowData" />
              </Label>
            </Division>
            <Division ID="divNewCustTrendData" ShowModes="None" Class="ThemeAlignCenter">
              <LineBreak />
              <DataTable ID="dtNewCustTrend" Class="ThemeAlignCenter" WidthScale="%" Width="100">
                <DataLayer Type="SQL" Source="declare @ReportDate datetime = '@Request.rptDay~'&#xD;&#xA;&#xD;&#xA;select&#xD;&#xA;	a.rptDate&#xD;&#xA;	, newCusts&#xD;&#xA;	, pyDate&#xD;&#xA;	, newCustsPY&#xD;&#xA;from&#xD;&#xA;(&#xD;&#xA;select&#xD;&#xA;	rptDate&#xD;&#xA;	, sum(newCusts) as newCusts&#xD;&#xA;from [BiLogiReporting].[dbo].[rptNewCustomerDaily_new] nc (nolock)&#xD;&#xA;where rptDate &gt; dateadd(d, -30, @ReportDate) and rptDate &lt; @ReportDate&#xD;&#xA;and((region = '@Request.islNewCustTrendRegion~' or '@Request.islNewCustTrendRegion~' = 'All Regions' or '@Request.islNewCustTrendRegion~' = '')&#xD;&#xA;	or ('@Request.islNewCustTrendRegion~' = 'Intl excl China' and region not in ('United States','China'))&#xD;&#xA;	or ('@Request.islNewCustTrendRegion~' = 'Intl Total' and region not in ('United States')))&#xD;&#xA;and (channel = '@Request.islNewCustTrendChannel~' or '@Request.islNewCustTrendChannel~' = 'All Channels' or '@Request.islNewCustTrendChannel~' = '')&#xD;&#xA;group by rptDate&#xD;&#xA;) a&#xD;&#xA;LEFT OUTER JOIN&#xD;&#xA;(&#xD;&#xA;select&#xD;&#xA;	dateadd(d,364,rptDate) as rptDate&#xD;&#xA;	, rptDate as pyDate&#xD;&#xA;	, sum(newCusts) as newCustsPY&#xD;&#xA;from [BiLogiReporting].[dbo].[rptNewCustomerDaily_new] nc (nolock)&#xD;&#xA;where rptDate &gt; dateadd(d, -394, @ReportDate) and rptDate &lt; dateadd(d,-364,@ReportDate)&#xD;&#xA;and ((region = '@Request.islNewCustTrendRegion~' or '@Request.islNewCustTrendRegion~' = 'All Regions' or '@Request.islNewCustTrendRegion~' = '')&#xD;&#xA;	or ('@Request.islNewCustTrendRegion~' = 'Intl excl China' and region not in ('United States','China'))&#xD;&#xA;	or ('@Request.islNewCustTrendRegion~' = 'Intl Total' and region not in ('United States')))&#xD;&#xA;and (channel = '@Request.islNewCustTrendChannel~' or '@Request.islNewCustTrendChannel~' = 'All Channels' or '@Request.islNewCustTrendChannel~' = '')&#xD;&#xA;group by dateadd(d,364,rptDate)&#xD;&#xA;	, rptDate&#xD;&#xA;) b on a.rptdate = b.rptdate&#xD;&#xA;order by rptDate&#xD;&#xA;option(maxdop 1);&#xD;&#xA;;&#xD;&#xA;" ConnectionID="connM1BIG-BIGReporting" ID="dlNewCustTrendData">
                  <CalculatedColumn Formula="@Data.newCusts~ - @Data.newCustsPY~" ID="ccNewCustTrendDiff" />
                  <CalculatedColumn Formula="@Data.newCusts~ / @Data.newCustsPY~ -1" ID="ccNewCustTrendDiffPct" />
                  <SortFilter SortColumn="rptDate" DataType="Date" SortSequence="Descending" ID="sfNewCustTrendDate" />
                </DataLayer>
                <Remark>
                  <AutoColumns />
                </Remark>
                <DataTableColumn ID="colNewCustTrend_Date" Header="Date">
                  <Label Caption="@Data.rptDate~" Format="MM/dd/yyyy" ID="lblNewCustTrend_Date" />
                </DataTableColumn>
                <DataTableColumn ID="colNewCustTrend_NewCusts" Header="New Customers" Class="ThemeAlignRight">
                  <Label Caption="@Data.newCusts~" Format="#,#" ID="lblNewCustTrend_NewCusts" />
                </DataTableColumn>
                <DataTableColumn ID="colNewCustTrend_NewCustsPY" Header="Prior Year" Class="ThemeAlignRight">
                  <Label Caption="@Data.newCustsPY~" Format="#,#" ID="lblNewCustTrend_NewCustsPY" />
                </DataTableColumn>
                <DataTableColumn ID="colNewCustTrend_NewCustsDiff" Header="+/(-)" Class="ThemeAlignRight">
                  <Label Caption="@Data.ccNewCustTrendDiff~" Format="#,#;(#,#)" ID="lblNewCustTrend_NewCustsDiff">
                    <ConditionalClass Class="ThemeTextNegative" Condition="@Data.ccNewCustTrendDiff~ &lt; 0" />
                  </Label>
                </DataTableColumn>
                <DataTableColumn ID="colNewCustTrend_NewCustsDiffPct" Header="+/(-)%" Class="ThemeAlignRight">
                  <Label Caption="@Data.ccNewCustTrendDiffPct~" Format="0.0%;(0.0%)" ID="lblNewCustTrend_NewCustsDiffPct">
                    <ConditionalClass Class="ThemeTextNegative" Condition="@Data.ccNewCustTrendDiffPct~ &lt; 0" />
                  </Label>
                </DataTableColumn>
              </DataTable>
            </Division>
          </Division>
        </PanelContent>
      </Panel>
      <Panel ID="pnlNewCust_TrendRolling7" Caption="New Customer Rolling 7-Day Trend">
        <PanelContent>
          <Division Class="ThemeAlignCenter">
            <Spaces Size="25" />
            <InputSelectList OptionCaptionColumn="region" ID="islNewCustTrendRegion7Day" OptionValueColumn="region" DefaultValue="@Request.islNewCustTrendRegion7Day~" IncludeBlank="True" IncludeBlankCaption="All Regions" IncludeBlankValue="All Regions">
              <DataLayer Type="SQL" ConnectionID="connM1BIG-BIGReporting" Source="SELECT &#xD;&#xA;	detail.region&#xD;&#xA;FROM &#xD;&#xA;	(&#xD;&#xA;		SELECT DISTINCT &#xD;&#xA;			NC.region&#xD;&#xA;			, RH.sortOrder&#xD;&#xA;		FROM &#xD;&#xA;			[BiLogiReporting].[dbo].[rptNewCustomerDaily_new] NC WITH (NOLOCK)&#xD;&#xA;			LEFT OUTER JOIN [BiLogiReporting].[dbo].[rptNewCustomerDaily_RegionHeadings] RH WITH (NOLOCK)&#xD;&#xA;				ON NC.region = RH.region&#xD;&#xA;		WHERE &#xD;&#xA;			NC.rptDate &gt;= '@Request.rptMonth~' &#xD;&#xA;			AND NC.rptDate &lt; '@Request.rptDay~'&#xD;&#xA;	&#xD;&#xA;		UNION ALL&#xD;&#xA;			SELECT 'Intl excl China', 1000&#xD;&#xA; &#xD;&#xA;		UNION ALL&#xD;&#xA;			SELECT 'Intl Total', 1001&#xD;&#xA;	) detail&#xD;&#xA;ORDER BY &#xD;&#xA;	detail.sortOrder &#xD;&#xA;OPTION (MAXDOP 1)&#xD;&#xA;" ID="dlSelectRegion7Day" />
              <EventHandler DhtmlEvent="onchange">
                <Action Type="RefreshElement" ElementID="divNewCustTrendParent7Day" ID="actRefreshTrend7Day" />
              </EventHandler>
            </InputSelectList>
            <Spaces Size="10" />
            <InputSelectList OptionCaptionColumn="channel" ID="islNewCustTrendChannel7Day" OptionValueColumn="channel" DefaultValue="@Request.islNewCustTrendChannel7Day~" IncludeBlank="True" IncludeBlankCaption="All Channels" IncludeBlankValue="All Channels">
              <DataLayer Type="SQL" ConnectionID="connM1BIG-BIGReporting" Source="SELECT distinct channel&#xD;&#xA;  FROM [BiLogiReporting].[dbo].[rptNewCustomerDaily_new] (nolock)&#xD;&#xA;  where rptDate &gt;= '@Request.rptMonth~' and rptDate &lt; '@Request.rptDay~'&#xD;&#xA;  option(maxdop 1);&#xD;&#xA;" ID="dlSelectChannel7Day" />
              <EventHandler DhtmlEvent="onchange">
                <Action Type="RefreshElement" ElementID="divNewCustTrendParent7Day" ID="actRefreshTrend7Day" />
              </EventHandler>
            </InputSelectList>
            <LineBreak />
            <LineBreak />
          </Division>
          <Division ID="divNewCustTrendParent7Day" Class="ThemeAlignCenter">
            <Division ID="divNewCustTrend7Day" Class="ThemeAlignCenter">
              <Chart Type="XY" XYChartType="Line" ID="chtNewCustTrend7Day" ChartDataColumn="newCusts7Day" ChartHeight="240" ChartWidth="400" ChartLabelColumn="rptDate" LegendLabel="Current" BorderBottom="40px" BorderRight="25px">
                <DataLayer Type="SQL" Source="declare @ReportDate datetime = '@Request.rptDay~'&#xD;&#xA;&#xD;&#xA;select *&#xD;&#xA;From&#xD;&#xA;(&#xD;&#xA;	select&#xD;&#xA;		a.rptDate&#xD;&#xA;		,AVG(newCusts) OVER (ORDER BY a.rptDate ROWS BETWEEN 6 Preceding and CURRENT ROW) as newCusts7Day&#xD;&#xA;		, pyDate&#xD;&#xA;		,AVG(newCustsPY) OVER (ORDER BY b.pyDate ROWS BETWEEN 6 Preceding and CURRENT ROW) as newCustsPY7Day&#xD;&#xA;	from&#xD;&#xA;	(&#xD;&#xA;	select&#xD;&#xA;		rptDate&#xD;&#xA;		, sum(newCusts) as newCusts&#xD;&#xA;	from [BiLogiReporting].[dbo].[rptNewCustomerDaily_new] nc (nolock)&#xD;&#xA;	where rptDate &gt; dateadd(d, -37, @ReportDate) and rptDate &lt; @ReportDate&#xD;&#xA;	and ((region = '@Request.islNewCustTrendRegion7Day~' or '@Request.islNewCustTrendRegion7Day~' = 'All Regions' or '@Request.islNewCustTrendRegion7Day~' = '')&#xD;&#xA;	or ('@Request.islNewCustTrendRegion7Day~' = 'Intl excl China' and region not in ('United States','China'))&#xD;&#xA;	or ('@Request.islNewCustTrendRegion7Day~' = 'Intl Total' and region not in ('United States')))&#xD;&#xA;	and (channel = '@Request.islNewCustTrendChannel7Day~' or '@Request.islNewCustTrendChannel7Day~' = 'All Channels' or '@Request.islNewCustTrendChannel7Day~' = '')&#xD;&#xA;	group by rptDate&#xD;&#xA;	) a&#xD;&#xA;	left outer join&#xD;&#xA;	(&#xD;&#xA;	select&#xD;&#xA;		dateadd(d,364,rptDate) as rptDate&#xD;&#xA;		, rptDate as pyDate&#xD;&#xA;		, sum(newCusts) as newCustsPY&#xD;&#xA;	from [BiLogiReporting].[dbo].[rptNewCustomerDaily_new] nc (nolock)&#xD;&#xA;	where rptDate &gt; dateadd(d, -401, @ReportDate) and rptDate &lt; dateadd(d,-364,@ReportDate)&#xD;&#xA;	and ((region = '@Request.islNewCustTrendRegion7Day~' or '@Request.islNewCustTrendRegion7Day~' = 'All Regions' or '@Request.islNewCustTrendRegion7Day~' = '')&#xD;&#xA;		or ('@Request.islNewCustTrendRegion7Day~' = 'Intl excl China' and region not in ('United States','China'))&#xD;&#xA;		or ('@Request.islNewCustTrendRegion7Day~' = 'Intl Total' and region not in ('United States')))&#xD;&#xA;	and (channel = '@Request.islNewCustTrendChannel7Day~' or '@Request.islNewCustTrendChannel7Day~' = 'All Channels' or '@Request.islNewCustTrendChannel7Day~' = '')&#xD;&#xA;	group by dateadd(d,364,rptDate)&#xD;&#xA;		, rptDate&#xD;&#xA;	) b on a.rptdate = b.rptdate&#xD;&#xA;) a&#xD;&#xA;where rptdate &gt;= dateadd(d, -30, @ReportDate)&#xD;&#xA;order by rptDate&#xD;&#xA;option(maxdop 1);&#xD;&#xA;;&#xD;&#xA;" ConnectionID="connM1BIG-BIGReporting" ID="dlNewCustTrend7Day" />
                <ExtraXYDataColumn ChartDataColumn="newCustsPY7Day" ID="ecNewCustsPY7Day" LegendLabel="PY" />
                <FontLabel FontAngle="0" FontSize="8" BorderColor="Black" FontColor="Black" />
                <LabelScale LinearTickIncrement="Weeks" LinearTickMinorIncrement="Weeks" Format="MM/dd" ScalingMode="LinearTime" />
                <DataScale Format="#,#" TickDensity="25" />
                <FontChartTitle FontSize="10" FontColor="Black" />
                <FontData FontSize="8" FontColor="Black" BorderColor="Black" />
                <Legend LegendOrientation="Horizontal" LegendLeft="140" LegendTop="220" BorderColor="transparent">
                  <FontLegend FontSize="8" FontColor="Black" />
                </Legend>
              </Chart>
              <LineBreak />
              <Label Caption="Show Data" Class="gdDecorated">
                <Action Type="ShowElement" ElementID="divNewCustTrendData7Day" ID="actShowData7Day" />
              </Label>
            </Division>
            <Division ID="divNewCustTrendData7Day" ShowModes="None" Class="ThemeAlignCenter">
              <LineBreak />
              <DataTable ID="dtNewCustTrend7Day" Class="ThemeAlignCenter" WidthScale="%" Width="100">
                <DataLayer Type="SQL" Source="declare @ReportDate datetime = '@Request.rptDay~'&#xD;&#xA;select *&#xD;&#xA;From&#xD;&#xA;(&#xD;&#xA;	select&#xD;&#xA;		a.rptDate&#xD;&#xA;		, AVG(newCusts) OVER (ORDER BY a.rptDate ROWS BETWEEN 6 Preceding and CURRENT ROW) as newCusts7Day&#xD;&#xA;		, pyDate&#xD;&#xA;		, AVG(newCustsPY) OVER (ORDER BY b.pyDate ROWS BETWEEN 6 Preceding and CURRENT ROW) as newCustsPY7Day&#xD;&#xA;	from&#xD;&#xA;	(&#xD;&#xA;	select&#xD;&#xA;		rptDate&#xD;&#xA;		, sum(newCusts) as newCusts&#xD;&#xA;	from [BiLogiReporting].[dbo].[rptNewCustomerDaily_new] nc (nolock)&#xD;&#xA;	where rptDate &gt; dateadd(d, -37, @ReportDate) and rptDate &lt; @ReportDate&#xD;&#xA;	and ((region = '@Request.islNewCustTrendRegion7Day~' or '@Request.islNewCustTrendRegion7Day~' = 'All Regions' or '@Request.islNewCustTrendRegion7Day~' = '')&#xD;&#xA;	or ('@Request.islNewCustTrendRegion7Day~' = 'Intl excl China' and region not in ('United States','China'))&#xD;&#xA;	or ('@Request.islNewCustTrendRegion7Day~' = 'Intl Total' and region not in ('United States')))&#xD;&#xA;	and (channel = '@Request.islNewCustTrendChannel7Day~' or '@Request.islNewCustTrendChannel7Day~' = 'All Channels' or '@Request.islNewCustTrendChannel7Day~' = '')&#xD;&#xA;	group by rptDate&#xD;&#xA;	) a&#xD;&#xA;	LEFT OUTER JOIN&#xD;&#xA;	(&#xD;&#xA;	select&#xD;&#xA;		dateadd(d,364,rptDate) as rptDate&#xD;&#xA;		, rptDate as pyDate&#xD;&#xA;		, sum(newCusts) as newCustsPY&#xD;&#xA;	from [BiLogiReporting].[dbo].[rptNewCustomerDaily_new] nc (nolock)&#xD;&#xA;	where rptDate &gt; dateadd(d, -401, @ReportDate) and rptDate &lt; dateadd(d,-364,@ReportDate)&#xD;&#xA;	and ((region = '@Request.islNewCustTrendRegion7Day~' or '@Request.islNewCustTrendRegion7Day~' = 'All Regions' or '@Request.islNewCustTrendRegion7Day~' = '')&#xD;&#xA;	or ('@Request.islNewCustTrendRegion7Day~' = 'Intl excl China' and region not in ('United States','China'))&#xD;&#xA;	or ('@Request.islNewCustTrendRegion7Day~' = 'Intl Total' and region not in ('United States')))&#xD;&#xA;	and (channel = '@Request.islNewCustTrendChannel7Day~' or '@Request.islNewCustTrendChannel7Day~' = 'All Channels' or '@Request.islNewCustTrendChannel7Day~' = '')&#xD;&#xA;	group by dateadd(d,364,rptDate)&#xD;&#xA;		, rptDate&#xD;&#xA;	) b on a.rptdate = b.rptdate&#xD;&#xA;) a &#xD;&#xA;where rptdate &gt;= dateadd(d, -30, @ReportDate)&#xD;&#xA;order by rptDate&#xD;&#xA;option(maxdop 1);&#xD;&#xA;;&#xD;&#xA;" ConnectionID="connM1BIG-BIGReporting" ID="dlNewCustTrendData7Day">
                  <CalculatedColumn Formula="@Data.newCusts7Day~ - @Data.newCustsPY7Day~" ID="ccNewCustTrendDiff7Day" />
                  <CalculatedColumn Formula="@Data.newCusts7Day~ / @Data.newCustsPY7Day~ -1" ID="ccNewCustTrendDiffPct7Day" />
                  <SortFilter SortColumn="rptDate" DataType="Date" SortSequence="Descending" ID="sfNewCustTrendDate7Day" />
                </DataLayer>
                <Remark>
                  <AutoColumns />
                </Remark>
                <DataTableColumn ID="colNewCustTrend_Date7Day" Header="Date">
                  <Label Caption="@Data.rptDate~" Format="MM/dd/yyyy" ID="lblNewCustTrend_Date7Day" />
                </DataTableColumn>
                <DataTableColumn ID="colNewCustTrend_NewCusts7Day" Header="New Customers" Class="ThemeAlignRight">
                  <Label Caption="@Data.newCusts7Day~" Format="#,#" ID="lblNewCustTrend_NewCusts7Day" />
                </DataTableColumn>
                <DataTableColumn ID="colNewCustTrend_NewCustsPY7Day" Header="Prior Year" Class="ThemeAlignRight">
                  <Label Caption="@Data.newCustsPY7Day~" Format="#,#" ID="lblNewCustTrend_NewCustsPY7Day" />
                </DataTableColumn>
                <DataTableColumn ID="colNewCustTrend_NewCustsDiff7Day" Header="+/(-)" Class="ThemeAlignRight">
                  <Label Caption="@Data.ccNewCustTrendDiff7Day~" Format="#,#;(#,#)" ID="lblNewCustTrend_NewCustsDiff7Day">
                    <ConditionalClass Class="ThemeTextNegative" Condition="@Data.ccNewCustTrendDiff7Day~ &lt; 0" />
                  </Label>
                </DataTableColumn>
                <DataTableColumn ID="colNewCustTrend_NewCustsDiffPct7Day" Header="+/(-)%" Class="ThemeAlignRight">
                  <Label Caption="@Data.ccNewCustTrendDiffPct7Day~" Format="0.0%;(0.0%)" ID="lblNewCustTrend_NewCustsDiffPct7Day">
                    <ConditionalClass Class="ThemeTextNegative" Condition="@Data.ccNewCustTrendDiffPct7Day~ &lt; 0" />
                  </Label>
                </DataTableColumn>
              </DataTable>
            </Division>
          </Division>
        </PanelContent>
      </Panel>
      <Panel ID="pnlNewCust_HeatMapChannel" Caption="Channel Heat Map" IdeDisplayStatus="Collapsed">
        <PanelContent>
          <Division Class="ThemeAlignCenter">
            <Spaces Size="25" />
            <InputSelectList OptionCaptionColumn="region" ID="islHeatMapRegion" OptionValueColumn="region" DefaultValue="@Request.islNewCustTrendRegion~" IncludeBlank="True" IncludeBlankCaption="All Regions" IncludeBlankValue="All Regions">
              <DataLayer Type="SQL" ConnectionID="connM1BIG-BIGReporting" Source="SELECT &#xD;&#xA;	detail.region&#xD;&#xA;FROM &#xD;&#xA;	(&#xD;&#xA;		SELECT DISTINCT &#xD;&#xA;			NC.region&#xD;&#xA;			, RH.sortOrder&#xD;&#xA;		FROM &#xD;&#xA;			[BiLogiReporting].[dbo].[rptNewCustomerDaily_new] NC WITH (NOLOCK)&#xD;&#xA;			LEFT OUTER JOIN [BiLogiReporting].[dbo].[rptNewCustomerDaily_RegionHeadings] RH WITH (NOLOCK)&#xD;&#xA;				ON NC.region = RH.region&#xD;&#xA;		WHERE &#xD;&#xA;			NC.rptDate &gt;= '@Request.rptMonth~' &#xD;&#xA;			AND NC.rptDate &lt; '@Request.rptDay~'&#xD;&#xA;	&#xD;&#xA;		UNION ALL&#xD;&#xA;			SELECT 'Intl excl China', 1000&#xD;&#xA; &#xD;&#xA;		UNION ALL&#xD;&#xA;			SELECT 'Intl Total', 1001&#xD;&#xA;	) detail&#xD;&#xA;ORDER BY &#xD;&#xA;	detail.sortOrder &#xD;&#xA;OPTION (MAXDOP 1)&#xD;&#xA;" ID="dlSelectRegion" />
              <EventHandler DhtmlEvent="onchange">
                <Action Type="RefreshElement" ElementID="hmNewCustsChannel" ID="actRefreshChannelHM" />
              </EventHandler>
            </InputSelectList>
            <Spaces Size="10" />
            <LineBreak />
            <LineBreak />
          </Division>
          <Chart Type="Heatmap" HeatmapSizeDataColumn="newCustsMonthEnd" HeatmapColorDataColumn="variance" HeatmapLabelDataColumn="channel" ChartHeight="360" ChartWidth="500" ID="hmNewCustsChannel" LowValueColor="Red" HighValueColor="Green" MediumValueColor="Yellow">
            <DataLayer Type="SQL" ID="dlNewCustHeatMapChannel" Source="/********************************************************************************************************************&#xD;&#xA;    Name:			New Customers By Channel / SubCategory&#xD;&#xA;    Author:			Scott Cooper&#xD;&#xA;    Create Date:	2013/05/01&#xD;&#xA;    Description:	This displays new customer information by channel/subcategory for all regions&#xD;&#xA;	&#xD;&#xA;    Processing:&#xD;&#xA;&#xD;&#xA;    Assumptions / Special Processing:&#xD;&#xA;&#xD;&#xA;    User-Defined Variables:&#xD;&#xA;	    @start				DATE			/*  Start Date for measurement (beginning of month)		*/&#xD;&#xA;		@end				DATE			/*	End Date for measurement							*/&#xD;&#xA;		@current			DATE			/*	Current Month start date							*/&#xD;&#xA;		@isCurrentMonth		INT				/*	Is measurement month same as current month?			*/&#xD;&#xA;		@marketingFactor	FLOAT			/*	Multiplier based on economic day projectiong		*/&#xD;&#xA;		@econDays_mtd  		FLOAT 			/*	Economic days MTD									*/&#xD;&#xA;		@econDays_monthEnd 	FLOAT 			/*	Economic days for full measurement month			*/&#xD;&#xA;		@econDays_14d 		FLOAT 			/*	Economic days for past 14 days						*/&#xD;&#xA;		@subCategoryRollup	VARCHAR(50)		/*	Label for all subcategories							*/&#xD;&#xA;		@subCategoryHeading VARCHAR(1)		/*	SubCategory to display (where detail records exist	*/&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;	TEMPORARY Tables Utilized:&#xD;&#xA;        @output             TABLE containing results TO display&#xD;&#xA;&#xD;&#xA;    Modifications:&#xD;&#xA;        20130501    Scott Cooper			Updates TO initial coding BY MXNguyen&#xD;&#xA;		20130710	Mike Nguyen				Added Budget&#xD;&#xA;&#xD;&#xA;*******************************************************************************************************************/&#xD;&#xA;SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;&#xD;&#xA;SET NOCOUNT ON;&#xD;&#xA;SET STATISTICS IO OFF;&#xD;&#xA;SET STATISTICS TIME OFF;&#xD;&#xA;&#xD;&#xA;/********************/&#xD;&#xA;/*  Declarations    */&#xD;&#xA;/************************************************************************************************************************/&#xD;&#xA;/*  This section defined variables and constants used in the programs                                                   */&#xD;&#xA;/************************************************************************************************************************/&#xD;&#xA;&#xD;&#xA;    /********************************************************************************************************************/&#xD;&#xA;    /*  Standard variable values                                                                                        */&#xD;&#xA;    /********************************************************************************************************************/&#xD;&#xA;	DECLARE @true	INT = 1&#xD;&#xA;	DECLARE @false 	INT = 0&#xD;&#xA;&#xD;&#xA;    /********************************************************************************************************************/&#xD;&#xA;    /*	Pre-Defined Constants																							*/&#xD;&#xA;    /********************************************************************************************************************/&#xD;&#xA;	DECLARE @subCategoryRollup 	VARCHAR(50) = 'All'&#xD;&#xA;	DECLARE	@subCategoryHeading VARCHAR(1)	= '+'&#xD;&#xA;	&#xD;&#xA;    /********************************************************************************************************************/&#xD;&#xA;    /*	Passed Variables                                                                                                */&#xD;&#xA;    /********************************************************************************************************************/&#xD;&#xA;	DECLARE @start 				DATE = '@Request.rptMonth~'&#xD;&#xA;	DECLARE @end 				DATE = '@Request.rptDay~'&#xD;&#xA;	DECLARE @current 			DATE = '@Request.rptCurrentMonth~'&#xD;&#xA;&#xD;&#xA;    /********************************************************************************************************************/&#xD;&#xA;    /*	Variables set during the course of the code execution															*/&#xD;&#xA;    /********************************************************************************************************************/&#xD;&#xA;	DECLARE @isCurrentMonth 	INT = CASE WHEN @start = @current THEN @true ELSE @false END&#xD;&#xA;	DECLARE @marketingFactor 	FLOAT = CASE WHEN @isCurrentMonth = @true THEN CAST('@Local.calcProjectionMarketingFactor~' AS FLOAT) ELSE 1.0 END&#xD;&#xA;&#xD;&#xA;	DECLARE @econDays_mtd  		FLOAT &#xD;&#xA;	DECLARE @econDays_monthEnd 	FLOAT &#xD;&#xA;	DECLARE @econDays_14d 		FLOAT &#xD;&#xA;&#xD;&#xA;&#xD;&#xA;/********************/&#xD;&#xA;/*  Initial Setup   */&#xD;&#xA;/********************************************************************************************************************/&#xD;&#xA;/*  This section creates the needed table structures and assigns the promo codes and pf_IDs to be measured          */&#xD;&#xA;/********************************************************************************************************************/&#xD;&#xA;&#xD;&#xA;	DECLARE @output TABLE(&#xD;&#xA;		region 				VARCHAR(50)&#xD;&#xA;		, channel 			VARCHAR(50)&#xD;&#xA;		, subCategory		VARCHAR(50)&#xD;&#xA;		, newCustsMTD 		INT 			DEFAULT 0&#xD;&#xA;		, newCusts14d 		INT 			DEFAULT 0&#xD;&#xA;		, rate14d 			FLOAT 			DEFAULT 0&#xD;&#xA;		, newCustsMonthEnd 	FLOAT 			DEFAULT 0&#xD;&#xA;		, newCustsPY 		INT				DEFAULT 0&#xD;&#xA;		)&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;/********************/&#xD;&#xA;/*  Processing		*/&#xD;&#xA;/********************************************************************************************************************/&#xD;&#xA;/*  This section processes the needed information																	*/&#xD;&#xA;/********************************************************************************************************************/&#xD;&#xA;	SELECT @econDays_mtd = SUM(economicDays) FROM biLogiReporting.dbo.rptNewCustomerEconomicDays d (NOLOCK) WHERE acquisitionDate &gt;= @start AND acquisitionDate &lt; @end&#xD;&#xA;	SELECT @econDays_monthEnd = SUM(economicDays) FROM biLogiReporting.dbo.rptNewCustomerEconomicDays d (NOLOCK) WHERE acquisitionDate &gt;= @start AND acquisitionDate &lt; DATEADD(MONTH, 1, @start)&#xD;&#xA;	SELECT @econDays_14d = SUM(economicDays) FROM biLogiReporting.dbo.rptNewCustomerEconomicDays d (NOLOCK) WHERE acquisitionDate &gt;= DATEADD(d,-14,@end) AND acquisitionDate &lt; @end&#xD;&#xA;&#xD;&#xA;	-- populate the regions, subcategories &amp; channels&#xD;&#xA;	INSERT INTO @output(&#xD;&#xA;		region&#xD;&#xA;		, channel&#xD;&#xA;		, subCategory&#xD;&#xA;		)&#xD;&#xA;	SELECT DISTINCT &#xD;&#xA;		Region&#xD;&#xA;		, Channel&#xD;&#xA;		, SubCategory &#xD;&#xA;	FROM &#xD;&#xA;		[BiLogiReporting].[dbo].[rptNewCustomerDaily_new] WITH (NOLOCK)&#xD;&#xA;	WHERE&#xD;&#xA;    	rptDate &gt;= DATEADD(YEAR, -1, @start)&#xD;&#xA;		and ((Region = '@Request.islHeatMapRegion~' or '@Request.islHeatMapRegion~' = 'All Regions' or '@Request.islHeatMapRegion~' = '')&#xD;&#xA;		or ('@Request.islHeatMapRegion~' = 'Intl excl China' and Region not in ('United States','China'))&#xD;&#xA;		or ('@Request.islHeatMapRegion~' = 'Intl Total' and Region not in ('United States')))&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;    -- update w/current new customers (last 14 days)&#xD;&#xA;	UPDATE &#xD;&#xA;		o&#xD;&#xA;	SET &#xD;&#xA;		region = x.region&#xD;&#xA;		, channel = x.channel&#xD;&#xA;		, subCategory = x.subcategory&#xD;&#xA;		, newCusts14d = x.newCusts14d&#xD;&#xA;		, rate14d = x.rate14d&#xD;&#xA;	FROM &#xD;&#xA;		@output o&#xD;&#xA;		INNER JOIN &#xD;&#xA;			(&#xD;&#xA;				SELECT&#xD;&#xA;					Region&#xD;&#xA;					, Channel&#xD;&#xA;					, SubCategory&#xD;&#xA;					, SUM(NewCusts) AS newCusts14d&#xD;&#xA;					, SUM(NewCusts) / @econDays_14d AS rate14d&#xD;&#xA;				FROM &#xD;&#xA;					[BiLogiReporting].[dbo].[rptNewCustomerDaily_new] nc WITH (NOLOCK)&#xD;&#xA;				WHERE&#xD;&#xA;					rptDate &gt;= DATEADD(DAY, -14, @end) &#xD;&#xA;					AND rptDate &lt; @end&#xD;&#xA;					AND ((Region = '@Request.islHeatMapRegion~' or '@Request.islHeatMapRegion~' = 'All Regions' or '@Request.islHeatMapRegion~' = '')&#xD;&#xA;					or ('@Request.islHeatMapRegion~' = 'Intl excl China' and Region not in ('United States','China'))&#xD;&#xA;					or ('@Request.islHeatMapRegion~' = 'Intl Total' and Region not in ('United States')))&#xD;&#xA;&#xD;&#xA;				GROUP BY &#xD;&#xA;					Region&#xD;&#xA;					, Channel&#xD;&#xA;					, SubCategory&#xD;&#xA;			) x &#xD;&#xA;			ON o.Region = x.Region &#xD;&#xA;			AND o.Channel = x.Channel&#xD;&#xA;			AND o.SubCategory = x.SubCategory&#xD;&#xA;	OPTION (MAXDOP 1);&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;	-- update w/actual MTD numbers and project ME numbers (if current month)&#xD;&#xA;	UPDATE &#xD;&#xA;		o&#xD;&#xA;	SET &#xD;&#xA;		newCustsMTD = x.newCustsMTD&#xD;&#xA;    	, newCustsMonthEnd = CASE WHEN @isCurrentMonth = @true THEN COALESCE(x.newCustsMTD, 0) + (@econDays_monthEnd - @econDays_mtd) * o.rate14d ELSE 0 END&#xD;&#xA;	FROM &#xD;&#xA;		@output o&#xD;&#xA;	LEFT OUTER JOIN&#xD;&#xA;		(&#xD;&#xA;			SELECT &#xD;&#xA;				Region&#xD;&#xA;				, Channel&#xD;&#xA;				, SubCategory&#xD;&#xA;				, SUM(NewCusts) AS newCustsMTD&#xD;&#xA;			FROM &#xD;&#xA;				[BiLogiReporting].[dbo].[rptNewCustomerDaily_new] nc WITH (NOLOCK)&#xD;&#xA;			WHERE&#xD;&#xA;				rptDate &gt;= @start &#xD;&#xA;				AND rptDate &lt; @end&#xD;&#xA;				AND ((Region = '@Request.islHeatMapRegion~' or '@Request.islHeatMapRegion~' = 'All Regions' or '@Request.islHeatMapRegion~' = '')&#xD;&#xA;				or ('@Request.islHeatMapRegion~' = 'Intl excl China' and Region not in ('United States','China'))&#xD;&#xA;				or ('@Request.islHeatMapRegion~' = 'Intl Total' and Region not in ('United States')))&#xD;&#xA;&#xD;&#xA;			GROUP BY &#xD;&#xA;				Region&#xD;&#xA;				, Channel&#xD;&#xA;				, SubCategory&#xD;&#xA;		) x &#xD;&#xA;		ON o.Region = x.Region &#xD;&#xA;		AND o.Channel = x.Channel&#xD;&#xA;		AND o.SubCategory = x.SubCategory&#xD;&#xA;	OPTION (MAXDOP 1);&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;	-- update w/actual PY numbers&#xD;&#xA;	UPDATE&#xD;&#xA;		o&#xD;&#xA;	SET &#xD;&#xA;		newCustsPY = x.newCustsPY&#xD;&#xA;	FROM &#xD;&#xA;		@output o&#xD;&#xA;		INNER JOIN&#xD;&#xA;			(&#xD;&#xA;				SELECT&#xD;&#xA;					Region&#xD;&#xA;					, Channel&#xD;&#xA;					, SubCategory&#xD;&#xA;					, SUM (NewCusts) AS newCustsPY&#xD;&#xA;				FROM &#xD;&#xA;					[BiLogiReporting].[dbo].[rptNewCustomerDaily_new] nc WITH (NOLOCK)&#xD;&#xA;				WHERE&#xD;&#xA;					rptDate &gt;= DATEADD(YEAR, -1, @start) &#xD;&#xA;					AND rptDate &lt; DATEADD(YEAR, -1, DATEADD(MONTH, 1, @start))&#xD;&#xA;					AND ((Region = '@Request.islHeatMapRegion~' or '@Request.islHeatMapRegion~' = 'All Regions' or '@Request.islHeatMapRegion~' = '')&#xD;&#xA;					or ('@Request.islHeatMapRegion~' = 'Intl excl China' and Region not in ('United States','China'))&#xD;&#xA;					or ('@Request.islHeatMapRegion~' = 'Intl Total' and Region not in ('United States')))&#xD;&#xA;&#xD;&#xA;				GROUP BY &#xD;&#xA;					Region&#xD;&#xA;					, Channel&#xD;&#xA;					, SubCategory&#xD;&#xA;			) x &#xD;&#xA;			ON o.Region = x.Region &#xD;&#xA;			AND o.Channel = x.Channel&#xD;&#xA;			AND o.SubCategory = x.SubCategory&#xD;&#xA;&#xD;&#xA;	-- if not current month, set MTD totals = actual MTD totals, not projections&#xD;&#xA;	IF @isCurrentMonth = @false&#xD;&#xA;		BEGIN&#xD;&#xA;			UPDATE &#xD;&#xA;				o&#xD;&#xA;			SET &#xD;&#xA;				newCustsMonthEnd = x.newCustsMonthEnd&#xD;&#xA;			FROM &#xD;&#xA;				@output o&#xD;&#xA;				INNER JOIN &#xD;&#xA;					(&#xD;&#xA;						SELECT&#xD;&#xA;							Region&#xD;&#xA;							, Channel&#xD;&#xA;							, SubCategory&#xD;&#xA;							, SUM(NewCusts) AS newCustsMonthEnd&#xD;&#xA;						FROM &#xD;&#xA;							[BiLogiReporting].[dbo].[rptNewCustomerDaily_new] nc WITH (NOLOCK)&#xD;&#xA;						WHERE&#xD;&#xA;							rptDate &gt;= @start&#xD;&#xA;							AND rptDate &lt; DATEADD(MONTH, 1, @start)&#xD;&#xA;						GROUP BY &#xD;&#xA;							Region&#xD;&#xA;							, Channel&#xD;&#xA;							, SubCategory&#xD;&#xA;					) x &#xD;&#xA;					ON o.Region = x.Region &#xD;&#xA;					AND o.Channel = x.Channel&#xD;&#xA;					AND o.SubCategory = x.SubCategory&#xD;&#xA;			OPTION (MAXDOP 1);&#xD;&#xA;		END&#xD;&#xA;&#xD;&#xA;	-- output&#xD;&#xA;	SELECT&#xD;&#xA;		a.channel&#xD;&#xA;		, a.channelHeading&#xD;&#xA;		, a.subCategoryHeading&#xD;&#xA;		, a.isSummary&#xD;&#xA;		, a.sortOrder&#xD;&#xA;		, a.newCustsMTD&#xD;&#xA;		, a.newCustsMonthEnd&#xD;&#xA;		, a.newCustsPY&#xD;&#xA;		, a.variance&#xD;&#xA;		, COALESCE(budget.NewCusts,0) AS budget&#xD;&#xA;		, a.newCustsMonthEnd - COALESCE(budget.NewCusts,0) AS varBudget&#xD;&#xA;	FROM (&#xD;&#xA;		SELECT &#xD;&#xA;			o.channel&#xD;&#xA;			, COALESCE(headSummary.channelHeading, head.channelHeading) AS channelHeading&#xD;&#xA;			, CASE WHEN headSummary.channelHeading IS NULL THEN '' ELSE @subCategoryHeading END AS subCategoryHeading&#xD;&#xA;			, head.isSummary&#xD;&#xA;			, MIN(head.sortOrder) AS sortOrder&#xD;&#xA;			, SUM(o.newCustsMTD) AS newCustsMTD&#xD;&#xA;			, SUM((o.newCustsMonthEnd) * @marketingFactor) AS newCustsMonthEnd&#xD;&#xA;			, SUM(o.newCustsPY) AS newCustsPY&#xD;&#xA;			, (SUM(o.newCustsMonthEnd) * @marketingFactor) - SUM(o.newCustsPY) AS variance&#xD;&#xA;		FROM &#xD;&#xA;			@output o &#xD;&#xA;			INNER JOIN [BiLogiReporting].[dbo].[rptNewCustomerDaily_channelHeadings] head WITH (NOLOCK)&#xD;&#xA;				ON o.channel = head.channel&#xD;&#xA;    			AND o.subcategory = head.subcategory&#xD;&#xA;			LEFT OUTER JOIN [BiLogiReporting].[dbo].[rptNewCustomerDaily_channelHeadings] headSummary WITH (NOLOCK)&#xD;&#xA;				ON o.channel = headSummary.channel&#xD;&#xA;				AND headSummary.isSummary = @true&#xD;&#xA;		WHERE &#xD;&#xA;			head.isSummary = @false&#xD;&#xA;		GROUP BY &#xD;&#xA;   			o.channel&#xD;&#xA;			, COALESCE(headSummary.channelHeading, head.channelHeading)&#xD;&#xA;			, CASE WHEN headSummary.channelHeading IS NULL THEN '' ELSE @subCategoryHeading END&#xD;&#xA;			, head.isSummary&#xD;&#xA;		) AS a&#xD;&#xA;	LEFT OUTER JOIN&#xD;&#xA;		(&#xD;&#xA;		SELECT&#xD;&#xA;			RptChannel&#xD;&#xA;			, sum(NewCusts) as NewCusts&#xD;&#xA;		FROM [BiLogiReporting].[dbo].[rptNewCustomerBudget] WITH (NOLOCK)&#xD;&#xA;		WHERE month = @start	&#xD;&#xA;			AND ((rptRegion = '@Request.islHeatMapRegion~' or '@Request.islHeatMapRegion~' = 'All Regions' or '@Request.islHeatMapRegion~' = '')&#xD;&#xA;			or ('@Request.islHeatMapRegion~' = 'Intl excl China' and rptRegion not in ('United States','China'))&#xD;&#xA;			or ('@Request.islHeatMapRegion~' = 'Intl Total' and rptRegion not in ('United States')))&#xD;&#xA;		GROUP BY RptChannel&#xD;&#xA;		) budget on a.channel = budget.RptChannel&#xD;&#xA;    ORDER BY &#xD;&#xA;        a.sortOrder&#xD;&#xA;" ConnectionID="connM1BIG-BIGReporting" />
            <Quicktip Title="@Chart.channel~">
              <QuicktipRow Value="@Chart.newCustsMonthEnd~" Format="#,#" Caption="Projected:" />
              <QuicktipRow Value="@Chart.newCustsPY~" Format="#,#" Caption="Last Year:" />
              <QuicktipRow Value="@Chart.budget~" Format="#,#" Caption="Budget:" />
            </Quicktip>
            <HeatmapFontLabel FontSize="8" />
          </Chart>
          <LineBreak />
          <Label Caption="Projection based on acquisitions per economic day in the prior 14 days" Class="ThemeTextSmall" />
        </PanelContent>
      </Panel>
      <Panel ID="pnlNewCust_HeatMapRegion" Caption="Region Heat Map" IdeDisplayStatus="Collapsed">
        <PanelContent>
          <Division Class="ThemeAlignCenter">
            <Spaces Size="25" />
            <InputSelectList OptionCaptionColumn="channel" ID="islHeatMapChannel" OptionValueColumn="channel" DefaultValue="@Request.islNewCustTrendChannel~" IncludeBlank="True" IncludeBlankCaption="All Channels" IncludeBlankValue="All Channels">
              <DataLayer Type="SQL" ConnectionID="connM1BIG-BIGReporting" Source="SELECT distinct channel&#xD;&#xA;  FROM [BiLogiReporting].[dbo].[rptNewCustomerDaily_new] (nolock)&#xD;&#xA;  where rptDate &gt;= '@Request.rptMonth~' and rptDate &lt; '@Request.rptDay~'&#xD;&#xA;  option(maxdop 1);&#xD;&#xA;" ID="dlSelectChannel" />
              <EventHandler DhtmlEvent="onchange">
                <Action Type="RefreshElement" ElementID="hmNewCustsRegion" ID="actRefreshRegionHM" />
              </EventHandler>
            </InputSelectList>
            <LineBreak />
            <LineBreak />
          </Division>
          <Chart Type="Heatmap" HeatmapSizeDataColumn="newCustsMonthEndRegion" HeatmapColorDataColumn="varianceRegion" HeatmapLabelDataColumn="region" ChartHeight="360" ChartWidth="500" ID="hmNewCustsRegion" HighValueColor="Green" MediumValueColor="Yellow" LowValueColor="Red">
            <DataLayer Type="SQL" ID="dlNewCustHeatMapRegion" Source="/********************************************************************************************************************&#xD;&#xA;    Name:			New Customers By Region&#xD;&#xA;    Author:			Scott Cooper&#xD;&#xA;    Create Date:	2013/05/01&#xD;&#xA;    Description:	This displays new customer information by region&#xD;&#xA;	&#xD;&#xA;    Processing:&#xD;&#xA;&#xD;&#xA;    Assumptions / Special Processing:&#xD;&#xA;&#xD;&#xA;    User-Defined Variables:&#xD;&#xA;	    @start				DATE			/*  Start Date for measurement (beginning of month)		*/&#xD;&#xA;		@end				DATE			/*	End Date for measurement							*/&#xD;&#xA;		@current			DATE			/*	Current Month start date							*/&#xD;&#xA;		@isCurrentMonth		INT				/*	Is measurement month same as current month?			*/&#xD;&#xA;		@marketingFactor	FLOAT			/*	Multiplier based on economic day projectiong		*/&#xD;&#xA;		@econDays_mtd  		FLOAT 			/*	Economic days MTD									*/&#xD;&#xA;		@econDays_monthEnd 	FLOAT 			/*	Economic days for full measurement month			*/&#xD;&#xA;		@econDays_14d 		FLOAT 			/*	Economic days for past 14 days						*/&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;	Temporary Tables Utilized:&#xD;&#xA;        @output             Table containing results to display&#xD;&#xA;&#xD;&#xA;    Modifications:&#xD;&#xA;        20130501    Scott Cooper			Updates to initial coding by MXNguyen&#xD;&#xA;		20130710	Mike Nguyen				Added Budget&#xD;&#xA;&#xD;&#xA;*******************************************************************************************************************/&#xD;&#xA;SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;&#xD;&#xA;SET NOCOUNT ON;&#xD;&#xA;SET STATISTICS IO OFF;&#xD;&#xA;SET STATISTICS TIME OFF;&#xD;&#xA;&#xD;&#xA;/********************/&#xD;&#xA;/*  Declarations    */&#xD;&#xA;/************************************************************************************************************************/&#xD;&#xA;/*  This section defined variables and constants used in the programs                                                   */&#xD;&#xA;/************************************************************************************************************************/&#xD;&#xA;&#xD;&#xA;    /********************************************************************************************************************/&#xD;&#xA;    /*  Standard variable values                                                                                        */&#xD;&#xA;    /********************************************************************************************************************/&#xD;&#xA;	DECLARE @true	INT = 1&#xD;&#xA;	DECLARE @false 	INT = 0&#xD;&#xA;&#xD;&#xA;    /********************************************************************************************************************/&#xD;&#xA;    /*	Pre-Defined Constants																							*/&#xD;&#xA;    /********************************************************************************************************************/&#xD;&#xA;	&#xD;&#xA;    /********************************************************************************************************************/&#xD;&#xA;    /*	Passed Variables                                                                                                */&#xD;&#xA;    /********************************************************************************************************************/&#xD;&#xA;	DECLARE @start 				DATE = '@Request.rptMonth~'&#xD;&#xA;	DECLARE @end 				DATE = '@Request.rptDay~'&#xD;&#xA;	DECLARE @current 			DATE = '@Request.rptCurrentMonth~'&#xD;&#xA;&#xD;&#xA;    /********************************************************************************************************************/&#xD;&#xA;    /*	Variables set during the course of the code execution															*/&#xD;&#xA;    /********************************************************************************************************************/&#xD;&#xA;	DECLARE @isCurrentMonth 	INT = CASE WHEN @start = @current THEN @true ELSE @false END&#xD;&#xA;	DECLARE @marketingFactor 	FLOAT = CASE WHEN @isCurrentMonth = @true THEN CAST('@Local.calcProjectionMarketingFactor~' AS FLOAT) ELSE 1.0 END&#xD;&#xA;&#xD;&#xA;	DECLARE @econDays_mtd  		FLOAT &#xD;&#xA;	DECLARE @econDays_monthEnd 	FLOAT &#xD;&#xA;	DECLARE @econDays_14d 		FLOAT &#xD;&#xA;&#xD;&#xA;&#xD;&#xA;/********************/&#xD;&#xA;/*  Initial Setup   */&#xD;&#xA;/********************************************************************************************************************/&#xD;&#xA;/*  This section creates the needed table structures and assigns the promo codes and pf_IDs to be measured          */&#xD;&#xA;/********************************************************************************************************************/&#xD;&#xA;&#xD;&#xA;	DECLARE @output TABLE(&#xD;&#xA;		region 				VARCHAR(50)&#xD;&#xA;		, channel 			VARCHAR(50)&#xD;&#xA;		, subCategory		VARCHAR(50)&#xD;&#xA;		, newCustsMTD 		INT 			DEFAULT 0&#xD;&#xA;		, newCusts14d 		INT 			DEFAULT 0&#xD;&#xA;		, rate14d 			FLOAT 			DEFAULT 0&#xD;&#xA;		, newCustsMonthEnd 	FLOAT 			DEFAULT 0&#xD;&#xA;		, newCustsPY 		INT				DEFAULT 0&#xD;&#xA;		)&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;/********************/&#xD;&#xA;/*  Processing		*/&#xD;&#xA;/********************************************************************************************************************/&#xD;&#xA;/*  This section processes the needed information																	*/&#xD;&#xA;/********************************************************************************************************************/&#xD;&#xA;	SELECT @econDays_mtd = sum(economicDays) from biLogiReporting.dbo.rptNewCustomerEconomicDays d (nolock) where acquisitionDate &gt;= @start and acquisitionDate &lt; @end&#xD;&#xA;	SELECT @econDays_monthEnd = sum(economicDays) from biLogiReporting.dbo.rptNewCustomerEconomicDays d (nolock) where acquisitionDate &gt;= @start and acquisitionDate &lt; dateadd(month, 1, @start)&#xD;&#xA;	SELECT @econDays_14d = sum(economicDays) from biLogiReporting.dbo.rptNewCustomerEconomicDays d (nolock) where acquisitionDate &gt;= dateadd(d,-14,@end) and acquisitionDate &lt; @end&#xD;&#xA;&#xD;&#xA;	-- populate the regions, subcategories &amp; channels&#xD;&#xA;	INSERT INTO @output(&#xD;&#xA;		region&#xD;&#xA;		, channel&#xD;&#xA;		, subCategory&#xD;&#xA;		)&#xD;&#xA;	SELECT DISTINCT &#xD;&#xA;		Region&#xD;&#xA;		, Channel&#xD;&#xA;		, SubCategory &#xD;&#xA;	FROM &#xD;&#xA;		[BiLogiReporting].[dbo].[rptNewCustomerDaily_new] WITH (NOLOCK)&#xD;&#xA;	WHERE&#xD;&#xA;    	rptDate &gt;= DATEADD(YEAR, -1,@start)  &#xD;&#xA;		AND (channel = '@Request.islHeatMapChannel~' or '@Request.islHeatMapChannel~' = 'All Channels' or '@Request.islHeatMapChannel~' = '')&#xD;&#xA;&#xD;&#xA;    -- update w/current new customers (last 14 days)&#xD;&#xA;	UPDATE &#xD;&#xA;		o&#xD;&#xA;	SET &#xD;&#xA;		region = x.region&#xD;&#xA;		, channel = x.channel&#xD;&#xA;		, subCategory = x.subcategory&#xD;&#xA;		, newCusts14d = x.newCusts14d&#xD;&#xA;		, rate14d = x.rate14d&#xD;&#xA;	FROM &#xD;&#xA;		@output o&#xD;&#xA;		INNER JOIN &#xD;&#xA;			(&#xD;&#xA;				SELECT&#xD;&#xA;					Region&#xD;&#xA;					, Channel&#xD;&#xA;					, SubCategory&#xD;&#xA;					, SUM(NewCusts) AS newCusts14d&#xD;&#xA;					, SUM(NewCusts) / @econDays_14d AS rate14d&#xD;&#xA;				FROM &#xD;&#xA;					[BiLogiReporting].[dbo].[rptNewCustomerDaily_new] nc WITH (NOLOCK)&#xD;&#xA;				WHERE&#xD;&#xA;					rptDate &gt;= DATEADD(DAY, -14, @end) &#xD;&#xA;					AND rptDate &lt; @end&#xD;&#xA;					AND (channel = '@Request.islHeatMapChannel~' or '@Request.islHeatMapChannel~' = 'All Channels' or '@Request.islHeatMapChannel~' = '')&#xD;&#xA;				GROUP BY &#xD;&#xA;					Region&#xD;&#xA;					, Channel&#xD;&#xA;					, SubCategory&#xD;&#xA;			) x &#xD;&#xA;			ON o.Region = x.Region &#xD;&#xA;			AND o.Channel = x.Channel&#xD;&#xA;			AND o.SubCategory = x.SubCategory&#xD;&#xA;	OPTION (MAXDOP 1);&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;	-- update w/actual MTD numbers and project ME numbers&#xD;&#xA;	UPDATE &#xD;&#xA;		o&#xD;&#xA;	SET &#xD;&#xA;		newCustsMTD = x.newCustsMTD&#xD;&#xA;    	, newCustsMonthEnd = CASE WHEN @isCurrentMonth = @true THEN COALESCE(x.newCustsMTD, 0) + (@econDays_monthEnd - @econDays_mtd) * o.rate14d ELSE 0 END&#xD;&#xA;	FROM &#xD;&#xA;		@output o&#xD;&#xA;	LEFT OUTER JOIN&#xD;&#xA;		(&#xD;&#xA;			SELECT &#xD;&#xA;				Region&#xD;&#xA;				, Channel&#xD;&#xA;				, SuBCategory&#xD;&#xA;				, SUM(NewCusts) AS newCustsMTD&#xD;&#xA;			FROM &#xD;&#xA;				[BiLogiReporting].[dbo].[rptNewCustomerDaily_new] nc WITH (NOLOCK)&#xD;&#xA;			WHERE&#xD;&#xA;				rptDate &gt;= @start &#xD;&#xA;				AND rptDate &lt; @end&#xD;&#xA;				AND (channel = '@Request.islHeatMapChannel~' or '@Request.islHeatMapChannel~' = 'All Channels' or '@Request.islHeatMapChannel~' = '')&#xD;&#xA;			GROUP BY &#xD;&#xA;				Region&#xD;&#xA;				, Channel&#xD;&#xA;				, SubCategory&#xD;&#xA;		) x &#xD;&#xA;		ON o.Region = x.Region &#xD;&#xA;		AND o.Channel = x.Channel&#xD;&#xA;		AND o.SubCategory = x.SubCategory&#xD;&#xA;	OPTION (MAXDOP 1);&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;	-- update w/actual PY numbers&#xD;&#xA;	UPDATE&#xD;&#xA;		o&#xD;&#xA;	SET &#xD;&#xA;		newCustsPY = x.newCustsPY&#xD;&#xA;	FROM &#xD;&#xA;		@output o&#xD;&#xA;		INNER JOIN&#xD;&#xA;			(&#xD;&#xA;				SELECT&#xD;&#xA;					Region&#xD;&#xA;					, Channel&#xD;&#xA;					, SubCategory&#xD;&#xA;					, SUM (NewCusts) AS newCustsPY&#xD;&#xA;				FROM &#xD;&#xA;					[BiLogiReporting].[dbo].[rptNewCustomerDaily_new] nc WITH (NOLOCK)&#xD;&#xA;				WHERE&#xD;&#xA;					rptDate &gt;= DATEADD(YEAR, -1, @start) &#xD;&#xA;					AND rptDate &lt; DATEADD(YEAR, -1, DATEADD(MONTH, 1, @start))&#xD;&#xA;					AND (channel = '@Request.islHeatMapChannel~' or '@Request.islHeatMapChannel~' = 'All Channels' or '@Request.islHeatMapChannel~' = '')&#xD;&#xA;				GROUP BY &#xD;&#xA;					Region&#xD;&#xA;					, Channel&#xD;&#xA;					, SubCategory&#xD;&#xA;			) x &#xD;&#xA;			ON o.Region = x.Region &#xD;&#xA;			AND o.Channel = x.Channel&#xD;&#xA;			AND o.SubCategory = x.SubCategory&#xD;&#xA;	&#xD;&#xA;	-- if not current month, set MTD totals = actual MTD totals, not projections&#xD;&#xA;	IF @isCurrentMonth = @false&#xD;&#xA;		BEGIN&#xD;&#xA;			UPDATE &#xD;&#xA;				o&#xD;&#xA;			SET &#xD;&#xA;				newCustsMonthEnd = x.newCustsMonthEnd&#xD;&#xA;			FROM &#xD;&#xA;				@output o&#xD;&#xA;				INNER JOIN &#xD;&#xA;					(&#xD;&#xA;						SELECT&#xD;&#xA;							Region&#xD;&#xA;							, Channel&#xD;&#xA;							, SubCategory&#xD;&#xA;							, SUM(NewCusts) AS newCustsMonthEnd&#xD;&#xA;						FROM &#xD;&#xA;							[BiLogiReporting].[dbo].[rptNewCustomerDaily_new] nc WITH (NOLOCK)&#xD;&#xA;						WHERE&#xD;&#xA;							rptDate &gt;= @start&#xD;&#xA;							AND rptDate &lt; DATEADD(MONTH, 1, @start)&#xD;&#xA;						GROUP BY &#xD;&#xA;							Region&#xD;&#xA;							, Channel&#xD;&#xA;							, SubCategory&#xD;&#xA;					) x &#xD;&#xA;					ON o.Region = x.Region &#xD;&#xA;					AND o.Channel = x.Channel&#xD;&#xA;					AND o.SubCategory = x.SubCategory&#xD;&#xA;			OPTION (MAXDOP 1);&#xD;&#xA;		END&#xD;&#xA;&#xD;&#xA;	-- output&#xD;&#xA;	SELECT&#xD;&#xA;		a.region&#xD;&#xA;		, a.newCustsMTDRegion&#xD;&#xA;		, a.newCustsMonthEndRegion&#xD;&#xA;		, a.newCustsPYRegion&#xD;&#xA;		, a.varianceRegion&#xD;&#xA;		, COALESCE(budget.NewCusts,0) AS budget&#xD;&#xA;		, a.newCustsMonthEndRegion - COALESCE(budget.NewCusts,0) AS varBudget&#xD;&#xA;		--, a.newCustsMonthEndRegion / a.newCustsPYRegion -1 as VariancePctRegion&#xD;&#xA;	FROM&#xD;&#xA;		(&#xD;&#xA;		SELECT &#xD;&#xA;			o.region&#xD;&#xA;			, SUM(o.newCustsMTD) AS newCustsMTDRegion&#xD;&#xA;			, SUM((o.newCustsMonthEnd) * @marketingFactor) AS newCustsMonthEndRegion&#xD;&#xA;			, SUM(o.newCustsPY) AS newCustsPYRegion&#xD;&#xA;			, (SUM(o.newCustsMonthEnd) * @marketingFactor) - SUM(o.newCustsPY) AS varianceRegion&#xD;&#xA;		FROM &#xD;&#xA;			@output o &#xD;&#xA;		GROUP BY &#xD;&#xA;		o.region&#xD;&#xA;		) AS a&#xD;&#xA;	LEFT OUTER JOIN&#xD;&#xA;		(&#xD;&#xA;		SELECT&#xD;&#xA;			RptRegion&#xD;&#xA;			, sum(NewCusts) as NewCusts&#xD;&#xA;		FROM [BiLogiReporting].[dbo].[rptNewCustomerBudget] WITH (NOLOCK)&#xD;&#xA;		WHERE month = @start&#xD;&#xA;		AND (Rptchannel = '@Request.islHeatMapChannel~' or '@Request.islHeatMapChannel~' = 'All Channels' or '@Request.islHeatMapChannel~' = '')&#xD;&#xA;		GROUP BY RptRegion&#xD;&#xA;		) budget on a.Region = budget.RptRegion&#xD;&#xA;    ORDER BY &#xD;&#xA;		a.region&#xD;&#xA;		" ConnectionID="connM1BIG-BIGReporting" />
            <Quicktip Title="@Chart.region~">
              <QuicktipRow Value="@Chart.newCustsMonthEndRegion~" Format="#,#" Caption="Projected:" />
              <QuicktipRow Value="@Chart.newCustsPYRegion~" Format="#,#" Caption="Last Year:" />
              <QuicktipRow Value="@Chart.budget~" Format="#,#" Caption="Budget:" />
            </Quicktip>
            <HeatmapFontLabel FontSize="8" />
          </Chart>
          <LineBreak />
          <Label Caption="Projection based on acquisitions per economic day in the prior 14 days" Class="ThemeTextSmall" />
        </PanelContent>
      </Panel>
      <Panel ID="pnlNewCust_MonthMeter" Caption="Month-End Projection" IdeDisplayStatus="Collapsed">
        <PanelContent>
          <Division Class="ThemeAlignCenter">
            <Rows Class="ThemeAlignCenter" WidthScale="px" Width="300">
              <Row>
                <Column>
                  <Label Caption="Current Month" Class="gdThemeAnimatedGaugeChartTitle" />
                </Column>
              </Row>
            </Rows>
            <AnimatedGauge Type="Bar" ID="chtNewCustomerMTD" AnimatedBarGaugeStyle="HorizontalBar" ChartHeight="100" LowerBound="0" UpperBound="@Local.calcProjectionBuffer~" Value="@Local.newCustsMTD~" ChartWidth="360" Animation="False" TickColor="black" TickLabelColor="black" TickLabelFontSize="12" BackgroundColor="white" FontColor="Black">
              <AnimatedGaugeLine BarStartValue="0" BarEndValue="@Local.NCForecast~" ID="aglMinBuffer" Caption="@Local.NCForecastText~" Color="#E88622" />
              <AnimatedGaugeLine BarStartValue="@Local.projection~" BarEndValue="@Local.calcProjectionBuffer~" ID="aglMaxBuffer" Color="#ffffff" />
            </AnimatedGauge>
            <Rows Class="ThemeAlignCenter" WidthScale="%" Width="100">
              <Row>
                <Column>
                  <Label Caption="Prior Year" Class="gdThemeAnimatedGaugeChartTitle" />
                </Column>
              </Row>
            </Rows>
            <AnimatedGauge Type="Bar" AnimatedBarGaugeStyle="HorizontalBar" ChartHeight="100" ID="chtNewCustomerPY" UpperBound="@Local.calcPYProjectionBuffer~" Value="@Local.newCustsPYMTD~" ChartWidth="360" Animation="True" BackgroundColor="White" LowerBound="0" TickLabelColor="black" TickLabelFontSize="12" TickColor="black">
              <AnimatedGaugeLine BarEndValue="@Local.newCustsPY~" BarStartValue="0" Color="#5cd1f6" ID="aglPYMinBuffer" Caption="@Local.newCustsPYText~" />
              <AnimatedGaugeLine BarStartValue="@Local.newCustsPY~" BarEndValue="@Local.calcPYProjectionBuffer~" Color="#ffffff" ID="aglPYMaxBuffer" />
            </AnimatedGauge>
            <Remark>
              <Label Caption="Marker indicates value as of Report Date" Class="ThemeTextNormal" />
            </Remark>
          </Division>
          <Division>
            <Rows Class="ThemeAlignCenter" WidthScale="%" Width="100">
              <Row>
                <Column PaddingLeft="15px" PaddingRight="15px" PaddingBottom="15px">
                  <Image Caption="gaugeBar_orange.png" />
                  <Spaces />
                  <Spaces />
                  <Label Caption="CM Projection" Class="ThemeTextNormal" />
                </Column>
                <Column PaddingLeft="15px" PaddingRight="15px" PaddingBottom="15px">
                  <Image Caption="gaugeBar_blue.png" />
                  <Spaces />
                  <Spaces />
                  <Label Caption="PY Actual EOM Total" Class="ThemeTextNormal" />
                </Column>
                <Column>
                  <Image Caption="gaugeMarker.png" />
                  <Spaces />
                  <Spaces />
                  <Label Caption="Total as of Report Date" Class="ThemeTextNormal" />
                </Column>
              </Row>
            </Rows>
          </Division>
        </PanelContent>
      </Panel>
    </Dashboard2>
  </Body>
  <ReportFooter>
    <Division Class="ThemeAlignCenter">
      <IncludeSharedElement DefinitionFile="SharedElements.SharedFooter" SharedElementID="sharedFooter" ID="sharedFooterElement" />
    </Division>
  </ReportFooter>
  <ideTestParams rptMonth="1/1/2015" rptDay="1/7/2015" islNewCustTrendRegion="" islNewCustTrendChannel="" rptCurrentMonth="1/1/2015" islNewCustTrendChannel7Day="" islNewCustTrendRegion7Day="" islHeatMapChannel="" islHeatMapRegion="" />
</Report>