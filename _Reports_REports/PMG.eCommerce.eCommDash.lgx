<?xml version="1.0" encoding="utf-8"?>
<Report ID="PMG.eCommerce.eCommDash" SavedBy="JOMAX\tpieh" SavedAt="11/5/2013 10:53:54 AM" EngineVersion="11.0.43">
  <StyleSheet StyleSheet="ReportsStyles.css" />
  <DefaultRequestParams rptDay="=DateAdd(&quot;d&quot;,&quot;-1&quot;,Date())" rptYesterday="=DateAdd(&quot;d&quot;,&quot;-1&quot;,Date())" />
  <Remark>
    <LocalData ID="ldTrafficCache" IdeDisplayStatus="Collapsed">
      <DataLayer Type="Cached" CacheKey="TrafficAll,@Request.rptDay~" ID="dlTrafficAllDataCache" ExpirationTimeSpan="24:00" ExpirationNow="True">
        <DataLayer Type="SP" ConnectionID="connM1BIG-biLogiReporting" ID="dlTrafficAll" Command="dbo.rptEcommLogiDashTrafficAll_get_sp">
          <SPParameters>
            <SPParameter SPParamDirection="Input" ID="@ReportDay" SPParamType="dt-7" SPParamSize="7" Value="@Request.rptDay~" />
          </SPParameters>
          <Lookup IncludeCondition="True" ID="luTooltips">
            <DataLayer Type="SQL" ConnectionID="connM1BIG-biLogiReporting" ID="dtToolTips" Source="&#xD;&#xA;USE [BiLogiReporting]&#xD;&#xA;&#xD;&#xA;DECLARE @toolTips TABLE&#xD;&#xA;    (&#xD;&#xA;        ttTraffic VARCHAR(50) ,&#xD;&#xA;        ToolTips VARCHAR(250)&#xD;&#xA;    );&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;INSERT INTO @toolTips (ttTraffic, ToolTips)&#xD;&#xA;	VALUES&#xD;&#xA;		--('Total Visits', 'Total unique daily visits'),&#xD;&#xA;		('Paid Media', 'Acquisition channel other than Branding (ie ISC traffic)'),&#xD;&#xA;		('SEO', 'Acquisition channel  is Branding, referred by a Search Engine (ie Google, Bing, Yahoo, Ask, Baidu)'),&#xD;&#xA;		('Direct Entry', 'Acquisition channel  is Branding, referred by DirectNav (ie No referring site)'),&#xD;&#xA;		('Other', 'Everything else'),&#xD;&#xA;		('% Sales Visits', '% of Total Visits that  saw a sales page (www, in, uk, ca, au, es, cart, auctions, myr page (HP excluded) or a HP bounce)'),&#xD;&#xA;		('% Acct Management', '% of Total Visits that saw the mya page, excluding myr'),&#xD;&#xA;		('% Support', '% of Total Visits that saw a ‘support’, ‘community’ or ‘help’ page during their visit'),&#xD;&#xA;		('Cart Create Rate', 'Cart Creates / (Sales Visits - Sales Bouncing Visits)'),&#xD;&#xA;		('Total Conversion Rate', 'Ordering Visits / Sales Visits')&#xD;&#xA;;&#xD;&#xA;&#xD;&#xA;SELECT  *&#xD;&#xA;FROM @toolTips&#xD;&#xA;WHERE ttTraffic = '@Data.Traffic~'&#xD;&#xA;" />
          </Lookup>
        </DataLayer>
        <DataLayerLink ID="dlTrafficAllDataLink" />
      </DataLayer>
    </LocalData>
  </Remark>
  <Remark>
    <LocalData ID="ldSalesCache">
      <Remark>
        <DataLayer Type="Cached" CacheKey="SalesAll,@Request.rptDay~" ID="dlSalesAllDataCache" ExpirationTimeSpan="24:00" ExpirationNow="True">
          <DataLayer Type="SP" ConnectionID="connM1BIG-biLogiReporting" ID="dlSalesAll" Command="dbo.rptEcommLogiDashSalesAll_get_sp">
            <SPParameters>
              <SPParameter SPParamDirection="Input" ID="@ReportDay" SPParamType="dt-7" SPParamSize="7" Value="@Request.rptDay~" />
            </SPParameters>
          </DataLayer>
          <DataLayerLink ID="dlSalesAllDataLink" />
        </DataLayer>
      </Remark>
    </LocalData>
  </Remark>
  <LocalData ID="ldCountryCache">
    <DataLayer Type="Cached" CacheKey="CountryAll,@Request.rptDay~" ID="dlCountryAllDataCache" ExpirationTimeSpan="24:00">
      <DataLayer Type="SP" ConnectionID="connM1BIG-biLogiReporting" ID="dlCountryAll" Command="dbo.rptEcommLogiDashCountryTrafficAll_get_sp">
        <SPParameters>
          <SPParameter SPParamDirection="Input" ID="@ReportDay" SPParamType="dt-7" SPParamSize="7" Value="@Request.rptDay~" />
        </SPParameters>
      </DataLayer>
      <DataLayerLink ID="dlCountryAllDataLink" />
    </DataLayer>
  </LocalData>
  <ReportHeader>
    <IncludeSharedElement DefinitionFile="SharedElements.SharedHeaderNoMenu" SharedElementID="sharedHeaderRptName" ID="sharedHeaderElement" />
  </ReportHeader>
  <Body>
    <LineBreak />
    <Rows Class="gdDefaultRowBground">
      <Row Class="gdReportHeader" ID="rowTitle">
        <Column ID="colHeader" Width="50" ColSpan="10">
          <Label Caption="eCommerce Dash" Class="ThemeTextSmall">
            <Action Type="Link" ID="actLinkeComm">
              <Target Type="Link" ID="tgtrpteCommerce" Link="@Function.AppVirtualPath~?rdReport=PMG.eCommerce.eCommDash" />
            </Action>
          </Label>
          <Label Caption=" | " Class="ThemeTextSmall" />
          <Label Caption="Finance Budget" Class="ThemeTextSmall">
            <Action Type="Link" ID="actLinkBudget">
              <Target Type="Link" ID="tgtrptFinBudget" Link="@Function.AppVirtualPath~?rdReport=PMG.eCommerce.eCommFinBudget" />
            </Action>
          </Label>
          <LineBreak LineCount="2" />
          <Label Caption="eCommerce Report" Class="gdReportHeaderNameBI" />
          <LineBreak LineCount="2" />
          <Remark>
            <Spaces Size="3" />
          </Remark>
          <Spaces Size="3" />
          <InputDate ID="rptDay" Caption="Report Date:" DefaultValue="@Request.rptDay~" CaptionClass="rdAlternateTextColorWhite">
            <Validation Type="Date" ErrorMsg="Data for this date is not available at this time" RangeStart="1/1/2013" RangeEnd="@Request.rptYesterday~" Class="ThemeErrorText" />
          </InputDate>
          <Spaces Size="3" />
          <Button ID="btnSubmit" Caption="Submit">
            <Action Type="Report" ID="actSubmitReport" Validate="True" EnterKeyDefault="True">
              <Target Type="Report" ID="tgtCurrentReport" Report="PMG.eCommerce.eCommDash" RequestForwarding="True" />
            </Action>
          </Button>
          <LineBreak LineCount="1" />
        </Column>
      </Row>
      <Row ID="RowOne">
        <Column ID="colTrafficINT" Class="gdColumnCell">
          <Division>
            <DataTable ID="dtTrafficINT" CellSpacing="5 px" AltRowClass="gdThemeAltRowNoPadding td" ColumnHeaderClass="gdTableHeader" CaptionClass="gdColumnCellTitle" Width="700">
              <DataLayer Type="Cached" CacheKey="TrafficINT,@Request.rptDay~" ExpirationTimeSpan="24:00" ID="dlTrafficINTDataCache">
                <DataLayer Type="SP" Command="rptEcommLogiDashFormatTrafficAll_get_sp" ConnectionID="connM1BIG-biLogiReporting" ID="dlTrafficINT">
                  <SPParameters>
                    <SPParameter SPParamDirection="Input" ID="@ReportDay" SPParamType="dt-7" SPParamSize="7" Value="@Request.rptDay~" />
                    <SPParameter SPParamDirection="Input" ID="@Format" SPParamSize="50" SPParamType="dt-200" Value="FormatINT" />
                  </SPParameters>
                  <Lookup IncludeCondition="True" ID="luTooltips">
                    <DataLayer Type="SQL" ConnectionID="connM1BIG-biLogiReporting" ID="dtToolTips" Source="&#xD;&#xA;USE [BiLogiReporting]&#xD;&#xA;&#xD;&#xA;DECLARE @toolTips TABLE&#xD;&#xA;    (&#xD;&#xA;        ttTraffic VARCHAR(50) ,&#xD;&#xA;        ToolTips VARCHAR(250)&#xD;&#xA;    );&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;INSERT INTO @toolTips (ttTraffic, ToolTips)&#xD;&#xA;	VALUES&#xD;&#xA;		--('Total Visits', 'Total unique daily visits'),&#xD;&#xA;		('Paid Media', 'Acquisition channel other than Branding (ie ISC traffic)'),&#xD;&#xA;		('SEO', 'Acquisition channel  is Branding, referred by a Search Engine (ie Google, Bing, Yahoo, Ask, Baidu)'),&#xD;&#xA;		('Direct Entry', 'Acquisition channel  is Branding, referred by DirectNav (ie No referring site)'),&#xD;&#xA;		('Other', 'Everything else')--,&#xD;&#xA;		--('% Sales Visits', '% of Total Visits that  saw a sales page (www, in, uk, ca, au, es, cart, auctions, myr page (HP excluded) or a HP bounce)'),&#xD;&#xA;		--('% Acct Management', '% of Total Visits that saw the mya page, excluding myr'),&#xD;&#xA;		--('% Support', '% of Total Visits that saw a ‘support’, ‘community’ or ‘help’ page during their visit'),&#xD;&#xA;		--('Cart Create Rate', 'Cart Creates / (Sales Visits - Sales Bouncing Visits)'),&#xD;&#xA;		--('Total Conversion Rate', 'Ordering Visits / Sales Visits')&#xD;&#xA;;&#xD;&#xA;&#xD;&#xA;SELECT  *&#xD;&#xA;FROM @toolTips&#xD;&#xA;WHERE ttTraffic = '@Data.Traffic~'&#xD;&#xA;" />
                  </Lookup>
                </DataLayer>
              </DataLayer>
              <Remark>
                <DataLayer Type="Linked" LinkedDataLayerID="dlTrafficAllDataLink" ID="dlTrafficAllDataLinked1" />
              </Remark>
              <DataTableColumn ID="colTraffic" Header="Traffic" Width="110" WidthScale="px">
                <Label ID="lblTraffic" Caption="@Data.Traffic~">
                  <ConditionalClass Condition="&quot;@Data.Traffic~&quot; = &quot;Paid Media&quot; OR &quot;@Data.Traffic~&quot; = &quot;SEO&quot; OR &quot;@Data.Traffic~&quot; = &quot;Direct Entry&quot; OR &quot;@Data.Traffic~&quot; = &quot;Other&quot; OR &quot;@Data.Traffic~&quot; = &quot;Sales CR&quot; OR &quot;@Data.Traffic~&quot; = &quot;Mgmt CR&quot; OR &quot;@Data.Traffic~&quot; = &quot;Support CR&quot;" Class="gdThemeAlignLeftPadLeft" />
                  <TooltipPanel ID="ttTraffic">
                    <Label Caption="@Data.ToolTips~" ID="@ToolTips" />
                  </TooltipPanel>
                </Label>
              </DataTableColumn>
              <DataTableColumn ID="colDaily" Header="Daily" Width="75" WidthScale="px" Class="ThemeAlignRight">
                <Label ID="lblDaily" Caption="@Data.Daily~">
                  <TooltipPanel ID="ttTrafficDailyINT">
                    <Chart Type="XY" XYChartType="Line" ChartHeight="200" ChartWidth="200" BackgroundColor="White" ChartTitle="Rolling 7 Days (000s)" ChartLabelColumnDataType="Date" ChartLabelColumn="rptDate" ChartDataColumn="Value">
                      <DataLayer Type="SQL" Source="USE [BiLogiReporting]&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;DECLARE @rptDate  AS DATE = '@Request.rptDay~',&#xD;&#xA;	@Format AS VARCHAR(50) = 'FormatINT'&#xD;&#xA;&#xD;&#xA;        IF @rptDate  IS NULL &#xD;&#xA;            BEGIN&#xD;&#xA;                SET @rptDate  = DATEADD(DAY, -1, GETDATE());&#xD;&#xA;            END;&#xD;&#xA;        IF @rptDate  = DATEADD(dd, 0, DATEDIFF(dd, 0, GETDATE())) &#xD;&#xA;            BEGIN &#xD;&#xA;                SET @rptDate  = DATEADD(DAY, -1, @rptDate );&#xD;&#xA;            END;&#xD;&#xA;		&#xD;&#xA;&#xD;&#xA;if OBJECT_ID('tempdb.dbo.#myMetricsINT') is not null drop table #myMetricsINT&#xD;&#xA;CREATE TABLE #myMetricsINT (SortOrder INT IDENTITY(1, 1), Metric VARCHAR(100) PRIMARY KEY, metricFormat varchar(100));&#xD;&#xA;&#xD;&#xA;INSERT  INTO #myMetricsINT&#xD;&#xA;VALUES  ( 'Total Visits', '#,##0' ),&#xD;&#xA;        ( 'Paid Media', '#,##0' ),&#xD;&#xA;        ( 'SEO', '#,##0' ),&#xD;&#xA;        ( 'Direct Entry', '#,##0' ),&#xD;&#xA;        ( 'Other', '#,##0' ),&#xD;&#xA;        ( '% Sales Visits', '#,##0.0%' ),&#xD;&#xA;        ( '% Acct Management', '#,##0.0%' ),&#xD;&#xA;        ( '% Support', '#,##0.0%' ),&#xD;&#xA;        ( 'Cart Create Rate', '#,##0.0%' ),&#xD;&#xA;        ( 'Total Conversion Rate', '#,##0.0%' ),&#xD;&#xA;        ( 'Sales CR', '#,##0.0%' ),&#xD;&#xA;        ( 'Mgmt CR', '#,##0.0%' ),&#xD;&#xA;        ( 'Support CR', '#,##0.0%' ),&#xD;&#xA;        ( 'Avg Min On Site', '#,##0.0' ),&#xD;&#xA;        ( 'Avg Page Count', '#,##0.0' );&#xD;&#xA;&#xD;&#xA;if OBJECT_ID('tempdb.dbo.#myDataINT') is not null drop table #myDataINT&#xD;&#xA;CREATE TABLE #myDataINT (visitDate date, channel nvarchar(50), isSales bit, isMgmt bit, isSupport bit, referredBy nvarchar(20), Divisor int, visits int, orderingVisits int, bouncingVisits int&#xD;&#xA;	, cartCreates int, secOnSite int, TrafficPageCount int);&#xD;&#xA;&#xD;&#xA;CREATE nonCLUSTERED INDEX x0 ON #myDataINT (visitDate);&#xD;&#xA;CREATE nonCLUSTERED INDEX x1 ON #myDataINT (channel);&#xD;&#xA;CREATE nonCLUSTERED INDEX x2 ON #myDataINT (isSales);&#xD;&#xA;CREATE nonCLUSTERED INDEX x3 ON #myDataINT (isMgmt);&#xD;&#xA;CREATE nonCLUSTERED INDEX x4 ON #myDataINT (isSupport);&#xD;&#xA;CREATE nonCLUSTERED INDEX x5 ON #myDataINT (referredBy);&#xD;&#xA;CREATE nonCLUSTERED INDEX x6 ON #myDataINT (Divisor);&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;INSERT INTO #myDataINT (visitDate, channel, isSales, isMgmt, isSupport, referredBy, Divisor, visits, orderingVisits, bouncingVisits, cartCreates, secOnSite, TrafficPageCount)&#xD;&#xA;SELECT visitDate, channel, isSales, isMgmt, isSupport, referredBy, 1 as Divisor&#xD;&#xA;	, SUM(visits) as visits, SUM(orderingVisits) as orderingVisits, SUM(bouncingVisits) as bouncingVisits&#xD;&#xA;	, SUM(cartCreates) as cartCreates, SUM(secOnSite) as secOnSite, SUM(TrafficPageCount) as TrafficPageCount&#xD;&#xA;FROM     [dbo].[rptEcommLogiDashTrafficMart] b WITH ( NOLOCK )&#xD;&#xA;WHERE b.visitDate &gt;= DATEADD(DAY,-98,@rptDate)  AND b.visitDate &lt;= @rptDate&#xD;&#xA;GROUP BY visitDate, channel, isSales, isMgmt, isSupport, referredBy;&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;IF  @Format = 'FormatINT' &#xD;&#xA;	BEGIN&#xD;&#xA;&#xD;&#xA;With mytable AS (&#xD;&#xA;				SELECT b.visitDate AS rptDate,&#xD;&#xA;								SUM(b7.visits) / MAX(b.Divisor) AS [Total Visits] ,&#xD;&#xA;&#xD;&#xA;								SUM(CASE WHEN b.channel &lt;&gt; 'Branding'&#xD;&#xA;											THEN b7.visits&#xD;&#xA;									END) / MAX(b.Divisor) AS [Paid Media] ,&#xD;&#xA;&#xD;&#xA;								SUM(CASE WHEN b.channel = 'Branding'&#xD;&#xA;												AND b.referredBy = 'Search Engine'&#xD;&#xA;											THEN b7.visits&#xD;&#xA;									END) / MAX(b.Divisor) AS SEO ,&#xD;&#xA;&#xD;&#xA;								SUM(CASE WHEN b.Channel = 'Branding'&#xD;&#xA;												AND b.referredBy = 'DirectNav'&#xD;&#xA;											THEN b7.visits&#xD;&#xA;									END) / MAX(b.Divisor) AS [Direct Entry] ,&#xD;&#xA;&#xD;&#xA;								SUM(CASE WHEN b.Channel = 'Branding'&#xD;&#xA;												AND b.referredBy &lt;&gt; 'DirectNav'&#xD;&#xA;												AND b.referredBy &lt;&gt; 'Search Engine'&#xD;&#xA;											THEN b7.visits&#xD;&#xA;									END) / MAX(b.Divisor) AS Other &#xD;&#xA;			FROM #myDataINT b &#xD;&#xA;				JOIN #myDataINT b7 ON b7.visitDate &gt; dateadd(day, -7, b.visitDate) and b7.visitDate &lt;= b.visitDate&#xD;&#xA;					AND b.channel = b7.channel AND b.isSales = b7.isSales AND b.isMgmt = b7.isMgmt AND b.isSupport = b7.isSupport &#xD;&#xA;					AND b.referredBy = b7.referredBy AND b.Divisor = b7.Divisor&#xD;&#xA;			WHERE b.visitDate &gt;= DATEADD(DAY,-91,@rptDate)&#xD;&#xA;			GROUP BY b.visitDate&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;),&#xD;&#xA;pivoted AS&#xD;&#xA;	( SELECT   *&#xD;&#xA;                       FROM     mytable UNPIVOT ( value FOR Metric IN ( [Total Visits],&#xD;&#xA;                                                              [Paid Media],&#xD;&#xA;                                                              SEO,&#xD;&#xA;                                                              [Direct Entry],&#xD;&#xA;                                                              Other) ) up&#xD;&#xA;	)&#xD;&#xA;&#xD;&#xA;	SELECT mr.Metric, mr.rptDate, mr.Value  * .001 as Value -- 000s&#xD;&#xA;    FROM    pivoted mr&#xD;&#xA;		JOIN #myMetricsINT mm ON mm.Metric = mr.Metric&#xD;&#xA;	WHERE mr.Metric = '@Data.Traffic~'&#xD;&#xA;&#xD;&#xA;END&#xD;&#xA;&#xD;&#xA;IF  @Format = 'FormatPERC' &#xD;&#xA;	BEGIN&#xD;&#xA;&#xD;&#xA;With mytable AS (&#xD;&#xA;				SELECT b.visitDate AS rptDate,&#xD;&#xA;								CAST(SUM(CASE WHEN b.isSales = 1 THEN b7.visits&#xD;&#xA;											END) AS DECIMAL(18, 4)) / SUM(b7.visits)&#xD;&#xA;								/ COALESCE(1, b.Divisor) AS [% Sales Visits] ,&#xD;&#xA;&#xD;&#xA;								CAST(SUM(CASE WHEN b.isMgmt = 1 THEN b7.visits&#xD;&#xA;											END) AS DECIMAL(18, 4)) / SUM(b7.visits)&#xD;&#xA;								/ COALESCE(1, b.Divisor) AS [% Acct Management] ,&#xD;&#xA;&#xD;&#xA;								CAST(SUM(CASE WHEN b.isSupport = 1 THEN b7.visits&#xD;&#xA;											END) AS DECIMAL(18, 4)) / SUM(b7.visits)&#xD;&#xA;								/ COALESCE(1, b.Divisor) AS [% Support] ,&#xD;&#xA;&#xD;&#xA;								CAST(SUM(b7.cartcreates) AS DECIMAL(18, 4))&#xD;&#xA;								/ ( SUM(b7.visits) - SUM(b7.bouncingvisits) )&#xD;&#xA;								/ COALESCE(1, b.Divisor) AS [Cart Create Rate] ,&#xD;&#xA;&#xD;&#xA;								CAST(SUM(b7.orderingvisits) AS DECIMAL(18, 4))&#xD;&#xA;								/ SUM(b7.visits) / COALESCE(1, b.Divisor) AS [Total Conversion Rate] ,&#xD;&#xA;								CAST(SUM(CASE WHEN b.isSales = 1&#xD;&#xA;												THEN b7.orderingvisits&#xD;&#xA;											END) AS DECIMAL(18, 4))&#xD;&#xA;								/ SUM(CASE WHEN b.isSales = 1 THEN b7.visits&#xD;&#xA;										END) / COALESCE(1, b.Divisor) AS [Sales CR] ,&#xD;&#xA;&#xD;&#xA;								CAST(SUM(CASE WHEN b.isMgmt = 1&#xD;&#xA;												THEN b7.orderingvisits&#xD;&#xA;											END) AS DECIMAL(18, 4))&#xD;&#xA;								/ SUM(CASE WHEN b.isMgmt = 1 THEN b7.visits&#xD;&#xA;										END) / COALESCE(1, b.Divisor) AS [Mgmt CR] ,&#xD;&#xA;&#xD;&#xA;								CAST(SUM(CASE WHEN b.isSupport = 1&#xD;&#xA;												THEN b7.orderingvisits&#xD;&#xA;											END) AS DECIMAL(18, 4))&#xD;&#xA;								/ SUM(CASE WHEN b.isSupport = 1 THEN b7.visits&#xD;&#xA;										END) / COALESCE(1, b.Divisor) AS [Support CR] &#xD;&#xA;			FROM #myDataINT b &#xD;&#xA;				JOIN #myDataINT b7 ON b7.visitDate &gt; dateadd(day, -7, b.visitDate) and b7.visitDate &lt;= b.visitDate&#xD;&#xA;					AND b.channel = b7.channel AND b.isSales = b7.isSales AND b.isMgmt = b7.isMgmt AND b.isSupport = b7.isSupport &#xD;&#xA;					AND b.referredBy = b7.referredBy AND b.Divisor = b7.Divisor&#xD;&#xA;			WHERE b.visitDate &gt;= DATEADD(DAY,-91,@rptDate)&#xD;&#xA;			GROUP BY b.visitDate&#xD;&#xA;&#xD;&#xA;),&#xD;&#xA;pivoted AS&#xD;&#xA;	( SELECT   *&#xD;&#xA;                       FROM     mytable UNPIVOT ( value FOR Metric IN ( &#xD;&#xA;                                                              [% Sales Visits],&#xD;&#xA;                                                              [% Acct Management],&#xD;&#xA;                                                              [% Support],&#xD;&#xA;                                                              [Cart Create Rate],&#xD;&#xA;                                                              [Total Conversion Rate],&#xD;&#xA;                                                              [Sales CR],&#xD;&#xA;                                                              [Mgmt CR],&#xD;&#xA;                                                              [Support CR]) ) up&#xD;&#xA;	)&#xD;&#xA;&#xD;&#xA;	SELECT mr.Metric, mr.rptDate, mr.Value&#xD;&#xA;    FROM    pivoted mr&#xD;&#xA;		JOIN #myMetricsINT mm ON mm.Metric = mr.Metric&#xD;&#xA;	WHERE mr.Metric = '@Data.Traffic~'&#xD;&#xA;&#xD;&#xA;END&#xD;&#xA;&#xD;&#xA;IF  @Format = 'FormatDEC' &#xD;&#xA;	BEGIN&#xD;&#xA;&#xD;&#xA;With mytable AS (&#xD;&#xA;				SELECT b.visitDate AS rptDate,&#xD;&#xA;								( SUM(CAST(b7.SecOnSite AS DECIMAL(18, 4)))&#xD;&#xA;									/ SUM(b7.visits) ) / 60 / COALESCE(1, b.Divisor) AS [Avg Min On Site] ,&#xD;&#xA;&#xD;&#xA;								( SUM(CAST(b7.TrafficPageCount AS DECIMAL(18, 4)))&#xD;&#xA;								/ SUM(b7.visits)) / COALESCE(1, b.Divisor) AS [Avg Page Count]&#xD;&#xA;			FROM #myDataINT b &#xD;&#xA;				JOIN #myDataINT b7 ON b7.visitDate &gt; dateadd(day, -7, b.visitDate) and b7.visitDate &lt;= b.visitDate&#xD;&#xA;					AND b.channel = b7.channel AND b.isSales = b7.isSales AND b.isMgmt = b7.isMgmt AND b.isSupport = b7.isSupport &#xD;&#xA;					AND b.referredBy = b7.referredBy AND b.Divisor = b7.Divisor&#xD;&#xA;			WHERE b.visitDate &gt;= DATEADD(DAY,-91,@rptDate)&#xD;&#xA;			GROUP BY b.visitDate&#xD;&#xA;&#xD;&#xA;),&#xD;&#xA;pivoted AS&#xD;&#xA;	( SELECT   *&#xD;&#xA;                       FROM     mytable UNPIVOT ( value FOR Metric IN ( &#xD;&#xA;                                                              [Avg Min on Site],&#xD;&#xA;                                                              [Avg Page Count] ) ) up&#xD;&#xA;	)&#xD;&#xA;&#xD;&#xA;	SELECT mr.Metric, mr.rptDate, mr.Value&#xD;&#xA;    FROM    pivoted mr&#xD;&#xA;		JOIN #myMetricsINT mm ON mm.Metric = mr.Metric&#xD;&#xA;	WHERE mr.Metric = '@Data.Traffic~'&#xD;&#xA;&#xD;&#xA;END&#xD;&#xA;;&#xD;&#xA;&#xD;&#xA;Drop TABLE #myMetricsINT&#xD;&#xA;Drop TABLE #myDataINT&#xD;&#xA;&#xD;&#xA;" ConnectionID="connM1BIG-biLogiReporting" ID="dl7DayTrafficINT">
                        <SqlParameters>
                          <SqlParameter Value="@Request.rptDay~" SqlParamType="dt-7" ID="@ReportDay" />
                        </SqlParameters>
                        <SortFilter SortColumn="rptDate" DataType="Date" ID="sfDate" SortSequence="Ascending" />
                      </DataLayer>
                      <FontLabel FontAngle="90" FontSize="8" FontColor="black" BorderColor="Black" />
                      <FontChartTitle FontSize="14" FontColor="Black" />
                      <FontData FontSize="8" FontColor="Black" BorderColor="Black" />
                      <FontYAxisTitle FontColor="Black" />
                      <LabelScale Format="MMM-yy" LinearTickIncrement="Months" ScalingMode="LinearTime" />
                      <DataScale Format="###,###,##0" />
                    </Chart>
                  </TooltipPanel>
                </Label>
              </DataTableColumn>
              <DataTableColumn ID="colDailyGoal" Header="Daily Goal" Width="75" WidthScale="px" Class="ThemeAlignRight">
                <Label ID="lblDailyGoal" Caption="@Data.DailyGoal~" />
              </DataTableColumn>
              <DataTableColumn ID="colDailyVariance" Header="Daily Variance" Width="60" WidthScale="px" Class="ThemeAlignRight">
                <Label ID="lblDailyVariance" Caption="@Data.DailyVariance~">
                  <ConditionalClass Class="ThemeTextNegative" Condition="Left(&quot;@Data.DailyVariance~&quot;,1) = &quot;-&quot;" />
                </Label>
              </DataTableColumn>
              <DataTableColumn ID="colMTD" Header="MTD" Width="75" WidthScale="px" Class="ThemeAlignRight">
                <Label ID="lblMTD" Caption="@Data.Mtd~">
                  <TooltipPanel ID="ttTrafficMnthlyINT">
                    <Chart Type="XY" XYChartType="Line" ChartHeight="200" BackgroundColor="White" ChartTitle="6-Month Trend (000s)" ChartLabelColumnDataType="Date" ChartLabelColumn="rptMonth" ChartDataColumn="Value" ChartWidth="200">
                      <Remark>
                        <DataLayer Type="SP" Command="rptEcommLogiDash6MonthTrend_get_sp" ConnectionID="connM1BIG-biLogiReporting" ID="dl6MnthTraffic" IdeDisplayStatus="Collapsed">
                          <SPParameters>
                            <SPParameter SPParamDirection="Input" ID="@ReportDay" SPParamType="dt-7" SPParamSize="7" Value="@Request.rptDay~" />
                            <SPParameter SPParamDirection="Input" ID="@Format" SPParamSize="50" SPParamType="dt-200" Value="FormatINT" />
                          </SPParameters>
                          <SortFilter SortColumn="rptMonth" DataType="Date" ID="sfMonth" SortSequence="Ascending" />
                        </DataLayer>
                      </Remark>
                      <DataLayer Type="SQL" Source="USE [BiLogiReporting]&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;DECLARE @rptDay AS DATE = '@Request.rptDay~',&#xD;&#xA;	@Format AS VARCHAR(50) = 'FormatINT'&#xD;&#xA;DECLARE @rptMonth DATE = DATEADD(MONTH, DATEDIFF(MONTH, 0, @rptDay), 0) &#xD;&#xA;&#xD;&#xA;        IF @rptDay IS NULL &#xD;&#xA;            BEGIN&#xD;&#xA;                SET @rptDay = DATEADD(DAY, -1, GETDATE());&#xD;&#xA;            END;&#xD;&#xA;        IF @rptDay = DATEADD(dd, 0, DATEDIFF(dd, 0, GETDATE())) &#xD;&#xA;            BEGIN &#xD;&#xA;                SET @rptDay = DATEADD(DAY, -1, @rptDay);&#xD;&#xA;            END;&#xD;&#xA;		&#xD;&#xA;&#xD;&#xA;DECLARE @myDates TABLE (colName nvarchar(500), startDate DATE, endDate DATE, Divisor FLOAT);&#xD;&#xA;&#xD;&#xA;INSERT  INTO @myDates&#xD;&#xA;SELECT  @rptMonth, DATEADD(month,-6,@rptDay)&#xD;&#xA;		, DATEADD(day,1,@rptDay), 1&#xD;&#xA;OPTION  ( MAXDOP 1 );&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;DECLARE @myResults TABLE (Metric VARCHAR(100) PRIMARY KEY, rptMonth DECIMAL(18, 4));&#xD;&#xA;&#xD;&#xA;DECLARE @myMetrics TABLE (SortOrder INT IDENTITY(1, 1), Metric VARCHAR(100) PRIMARY KEY, metricFormat varchar(100));&#xD;&#xA;&#xD;&#xA;INSERT  INTO @myMetrics&#xD;&#xA;VALUES  ( 'Total Visits', '#,##0' ),&#xD;&#xA;        ( 'Paid Media', '#,##0' ),&#xD;&#xA;        ( 'SEO', '#,##0' ),&#xD;&#xA;        ( 'Direct Entry', '#,##0' ),&#xD;&#xA;        ( 'Other', '#,##0' ),&#xD;&#xA;        ( '% Sales Visits', '#,##0.0%' ),&#xD;&#xA;        ( '% Acct Management', '#,##0.0%' ),&#xD;&#xA;        ( '% Support', '#,##0.0%' ),&#xD;&#xA;        ( 'Cart Create Rate', '#,##0.0%' ),&#xD;&#xA;        ( 'Total Conversion Rate', '#,##0.0%' ),&#xD;&#xA;        ( 'Sales CR', '#,##0.0%' ),&#xD;&#xA;        ( 'Mgmt CR', '#,##0.0%' ),&#xD;&#xA;        ( 'Support CR', '#,##0.0%' ),&#xD;&#xA;        ( 'Avg Min On Site', '#,##0.0' ),&#xD;&#xA;        ( 'Avg Page Count', '#,##0.0' );&#xD;&#xA;&#xD;&#xA;IF  @Format = 'FormatINT' &#xD;&#xA;	BEGIN&#xD;&#xA;&#xD;&#xA;With mytable AS (&#xD;&#xA;				SELECT DATEADD(M,-1,DATEADD(D,1,DATEADD(M,(DATEDIFF(m,-1,b.visitDate)),-1))) AS rptMonth ,&#xD;&#xA;								SUM(visits) / MAX(md.Divisor) AS [Total Visits] ,&#xD;&#xA;								SUM(CASE WHEN channel &lt;&gt; 'Branding'&#xD;&#xA;											THEN visits&#xD;&#xA;									END) / MAX(md.Divisor) AS [Paid Media] ,&#xD;&#xA;								SUM(CASE WHEN channel = 'Branding'&#xD;&#xA;												AND referredBy = 'Search Engine'&#xD;&#xA;											THEN visits&#xD;&#xA;									END) / MAX(md.Divisor) AS SEO ,&#xD;&#xA;								SUM(CASE WHEN Channel = 'Branding'&#xD;&#xA;												AND referredBy = 'DirectNav'&#xD;&#xA;											THEN visits&#xD;&#xA;									END) / MAX(md.Divisor) AS [Direct Entry] ,&#xD;&#xA;								SUM(CASE WHEN Channel = 'Branding'&#xD;&#xA;												AND referredBy &lt;&gt; 'DirectNav'&#xD;&#xA;												AND referredBy &lt;&gt; 'Search Engine'&#xD;&#xA;											THEN visits&#xD;&#xA;									END) / MAX(md.Divisor) AS Other &#xD;&#xA;			FROM     [dbo].[rptEcommLogiDashTrafficMart] b WITH ( NOLOCK )&#xD;&#xA;				JOIN @myDates md ON b.visitDate &gt;= DATEADD(D,1,DATEADD(M,(DATEDIFF(m,-1,md.startDate)),-1)) AND b.visitDate &lt; md.endDate&#xD;&#xA;					AND DATEPART(DAY, b.visitDate) &lt;= DATEPART(DAY, @rptDay) &#xD;&#xA;			GROUP BY DATEADD(M,-1,DATEADD(D,1,DATEADD(M,(DATEDIFF(m,-1,b.visitDate)),-1)))&#xD;&#xA;&#xD;&#xA;),&#xD;&#xA;pivoted AS&#xD;&#xA;	( SELECT   *&#xD;&#xA;                       FROM     mytable UNPIVOT ( value FOR Metric IN ( [Total Visits],&#xD;&#xA;                                                              [Paid Media],&#xD;&#xA;                                                              SEO,&#xD;&#xA;                                                              [Direct Entry],&#xD;&#xA;                                                              Other) ) up&#xD;&#xA;	)&#xD;&#xA;&#xD;&#xA;	SELECT mr.Metric, mr.rptMonth, mr.Value * .001 as Value&#xD;&#xA;    FROM    pivoted mr&#xD;&#xA;		JOIN @myMetrics mm ON mm.Metric = mr.Metric&#xD;&#xA;	WHERE mr.Metric = '@Data.Traffic~'&#xD;&#xA;&#xD;&#xA;END&#xD;&#xA;&#xD;&#xA;IF  @Format = 'FormatPERC' &#xD;&#xA;	BEGIN&#xD;&#xA;&#xD;&#xA;With mytable AS (&#xD;&#xA;				SELECT DATEADD(M,-1,DATEADD(D,1,DATEADD(M,(DATEDIFF(m,-1,b.visitDate)),-1))) AS rptMonth ,&#xD;&#xA;								CAST(SUM(CASE WHEN isSales = 1 THEN visits&#xD;&#xA;											END) AS DECIMAL(18, 4)) / SUM(visits)&#xD;&#xA;								/ COALESCE(1, md.Divisor) AS [% Sales Visits] ,&#xD;&#xA;								CAST(SUM(CASE WHEN isMgmt = 1 THEN visits&#xD;&#xA;											END) AS DECIMAL(18, 4)) / SUM(visits)&#xD;&#xA;								/ COALESCE(1, md.Divisor) AS [% Acct Management] ,&#xD;&#xA;								CAST(SUM(CASE WHEN isSupport = 1 THEN visits&#xD;&#xA;											END) AS DECIMAL(18, 4)) / SUM(visits)&#xD;&#xA;								/ COALESCE(1, md.Divisor) AS [% Support] ,&#xD;&#xA;								CAST(SUM(cartcreates) AS DECIMAL(18, 4))&#xD;&#xA;								/ ( SUM(visits) - SUM(bouncingvisits) )&#xD;&#xA;								/ COALESCE(1, md.Divisor) AS [Cart Create Rate] ,&#xD;&#xA;								CAST(SUM(orderingvisits) AS DECIMAL(18, 4))&#xD;&#xA;								/ SUM(visits) / COALESCE(1, md.Divisor) AS [Total Conversion Rate] ,&#xD;&#xA;								CAST(SUM(CASE WHEN isSales = 1&#xD;&#xA;												THEN orderingvisits&#xD;&#xA;											END) AS DECIMAL(18, 4))&#xD;&#xA;								/ SUM(CASE WHEN isSales = 1 THEN visits&#xD;&#xA;										END) / COALESCE(1, md.Divisor) AS [Sales CR] ,&#xD;&#xA;								CAST(SUM(CASE WHEN isMgmt = 1&#xD;&#xA;												THEN orderingvisits&#xD;&#xA;											END) AS DECIMAL(18, 4))&#xD;&#xA;								/ SUM(CASE WHEN isMgmt = 1 THEN visits&#xD;&#xA;										END) / COALESCE(1, md.Divisor) AS [Mgmt CR] ,&#xD;&#xA;								CAST(SUM(CASE WHEN isSupport = 1&#xD;&#xA;												THEN orderingvisits&#xD;&#xA;											END) AS DECIMAL(18, 4))&#xD;&#xA;								/ SUM(CASE WHEN isSupport = 1 THEN visits&#xD;&#xA;										END) / COALESCE(1, md.Divisor) AS [Support CR] &#xD;&#xA;			FROM     [dbo].[rptEcommLogiDashTrafficMart] b WITH ( NOLOCK )&#xD;&#xA;				JOIN @myDates md ON b.visitDate &gt;= DATEADD(D,1,DATEADD(M,(DATEDIFF(m,-1,md.startDate)),-1)) AND b.visitDate &lt; md.endDate&#xD;&#xA;					AND DATEPART(DAY, b.visitDate) &lt;= DATEPART(DAY, @rptDay) &#xD;&#xA;			GROUP BY DATEADD(M,-1,DATEADD(D,1,DATEADD(M,(DATEDIFF(m,-1,b.visitDate)),-1)))&#xD;&#xA;&#xD;&#xA;),&#xD;&#xA;pivoted AS&#xD;&#xA;	( SELECT   *&#xD;&#xA;                       FROM     mytable UNPIVOT ( value FOR Metric IN ( &#xD;&#xA;                                                              [% Sales Visits],&#xD;&#xA;                                                              [% Acct Management],&#xD;&#xA;                                                              [% Support],&#xD;&#xA;                                                              [Cart Create Rate],&#xD;&#xA;                                                              [Total Conversion Rate],&#xD;&#xA;                                                              [Sales CR],&#xD;&#xA;                                                              [Mgmt CR],&#xD;&#xA;                                                              [Support CR]) ) up&#xD;&#xA;	)&#xD;&#xA;&#xD;&#xA;	SELECT mr.Metric, mr.rptMonth, mr.Value&#xD;&#xA;    FROM    pivoted mr&#xD;&#xA;		JOIN @myMetrics mm ON mm.Metric = mr.Metric&#xD;&#xA;	WHERE mr.Metric = '@Data.Traffic~'&#xD;&#xA;&#xD;&#xA;END&#xD;&#xA;&#xD;&#xA;IF  @Format = 'FormatDEC' &#xD;&#xA;	BEGIN&#xD;&#xA;&#xD;&#xA;With mytable AS (&#xD;&#xA;				SELECT DATEADD(M,-1,DATEADD(D,1,DATEADD(M,(DATEDIFF(m,-1,b.visitDate)),-1))) AS rptMonth ,&#xD;&#xA;								( SUM(CAST(SecOnSite AS DECIMAL(18, 4)))&#xD;&#xA;									/ SUM(visits) ) / 60 / COALESCE(1,&#xD;&#xA;																md.Divisor) AS [Avg Min On Site] ,&#xD;&#xA;								CAST(SUM(TrafficPageCount) AS DECIMAL(18, 4))&#xD;&#xA;								/ SUM(visits) / COALESCE(1, md.Divisor) AS [Avg Page Count]&#xD;&#xA;			FROM     [dbo].[rptEcommLogiDashTrafficMart] b WITH ( NOLOCK )&#xD;&#xA;				JOIN @myDates md ON b.visitDate &gt;= DATEADD(D,1,DATEADD(M,(DATEDIFF(m,-1,md.startDate)),-1)) AND b.visitDate &lt; md.endDate &#xD;&#xA;					AND DATEPART(DAY, b.visitDate) &lt;= DATEPART(DAY, @rptDay) &#xD;&#xA;			GROUP BY DATEADD(M,-1,DATEADD(D,1,DATEADD(M,(DATEDIFF(m,-1,b.visitDate)),-1)))&#xD;&#xA;&#xD;&#xA;),&#xD;&#xA;pivoted AS&#xD;&#xA;	( SELECT   *&#xD;&#xA;                       FROM     mytable UNPIVOT ( value FOR Metric IN ( &#xD;&#xA;                                                              [Avg Min on Site],&#xD;&#xA;                                                              [Avg Page Count] ) ) up&#xD;&#xA;	)&#xD;&#xA;&#xD;&#xA;	SELECT mr.Metric, mr.rptMonth, mr.Value&#xD;&#xA;    FROM    pivoted mr&#xD;&#xA;		JOIN @myMetrics mm ON mm.Metric = mr.Metric&#xD;&#xA;	WHERE mr.Metric = '@Data.Traffic~'&#xD;&#xA;&#xD;&#xA;END&#xD;&#xA;;" ConnectionID="connM1BIG-biLogiReporting" ID="dlMnthlyTrafficINT">
                        <SqlParameters>
                          <SqlParameter Value="@Request.rptDay~" SqlParamType="dt-7" ID="@ReportDay" />
                        </SqlParameters>
                        <SortFilter SortColumn="rptMonth" DataType="Date" ID="sfMonth" SortSequence="Ascending" />
                      </DataLayer>
                      <FontLabel FontAngle="90" FontSize="8" FontColor="black" BorderColor="Black" />
                      <FontChartTitle FontSize="14" FontColor="Black" />
                      <FontData FontSize="8" FontColor="Black" BorderColor="Black" />
                      <FontYAxisTitle FontColor="Black" />
                      <LabelScale Format="MMM-yy" />
                      <DataScale Format="###,###,##0" />
                    </Chart>
                  </TooltipPanel>
                </Label>
              </DataTableColumn>
              <DataTableColumn ID="colMTDGoal" Header="MTD Goal" Width="75" WidthScale="px" Class="ThemeAlignRight">
                <Label ID="lblMTDGoal" Caption="@Data.MtdGoal~" />
              </DataTableColumn>
              <DataTableColumn ID="colMTDVariance" Header="MTD Variance" Width="75" WidthScale="px" Class="ThemeAlignRight">
                <Label ID="lblMTDVariance" Caption="@Data.MTDVariance~">
                  <ConditionalClass Class="ThemeTextNegative" Condition="Left(&quot;@Data.MTDVariance~&quot;,1) = &quot;-&quot;" />
                </Label>
              </DataTableColumn>
            </DataTable>
          </Division>
        </Column>
      </Row>
      <Row ID="RowTwo">
        <Column ID="colTrafficPERC" Class="gdColumnCell">
          <Division>
            <DataTable ID="dtTrafficPERC" CellSpacing="5 px" AltRowClass="gdThemeAltRowNoPadding td" ColumnHeaderClass="gdTableHeader" CaptionClass="gdColumnCellTitle" Width="700">
              <DataLayer Type="Cached" CacheKey="TrafficPERC,@Request.rptDay~" ExpirationTimeSpan="24:00" ID="dlTrafficPERCDataCache">
                <DataLayer Type="SP" Command="rptEcommLogiDashFormatTrafficAll_get_sp" ConnectionID="connM1BIG-biLogiReporting" ID="dlTrafficPERC">
                  <SPParameters>
                    <SPParameter SPParamDirection="Input" ID="@ReportDay" SPParamType="dt-7" SPParamSize="7" Value="@Request.rptDay~" />
                    <SPParameter SPParamDirection="Input" ID="@Format" SPParamSize="50" SPParamType="dt-200" Value="FormatPERC" />
                  </SPParameters>
                  <Lookup IncludeCondition="True" ID="luTooltips">
                    <DataLayer Type="SQL" ConnectionID="connM1BIG-biLogiReporting" ID="dtToolTips" Source="&#xD;&#xA;USE [BiLogiReporting]&#xD;&#xA;&#xD;&#xA;DECLARE @toolTips TABLE&#xD;&#xA;    (&#xD;&#xA;        ttTraffic VARCHAR(50) ,&#xD;&#xA;        ToolTips VARCHAR(250)&#xD;&#xA;    );&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;INSERT INTO @toolTips (ttTraffic, ToolTips)&#xD;&#xA;	VALUES&#xD;&#xA;		--('Total Visits', 'Total unique daily visits'),&#xD;&#xA;		--('Paid Media', 'Acquisition channel other than Branding (ie ISC traffic)'),&#xD;&#xA;		--('SEO', 'Acquisition channel  is Branding, referred by a Search Engine (ie Google, Bing, Yahoo, Ask, Baidu)'),&#xD;&#xA;		--('Direct Entry', 'Acquisition channel  is Branding, referred by DirectNav (ie No referring site)'),&#xD;&#xA;		--('Other', 'Everything else'),&#xD;&#xA;		('% Sales Visits', '% of Total Visits that  saw a sales page (www, in, uk, ca, au, es, cart, auctions, myr page (HP excluded) or a HP bounce)'),&#xD;&#xA;		('% Acct Management', '% of Total Visits that saw the mya page, excluding myr'),&#xD;&#xA;		('% Support', '% of Total Visits that saw a ‘support’, ‘community’ or ‘help’ page during their visit')--,&#xD;&#xA;		--('Cart Create Rate', 'Cart Creates / (Sales Visits - Sales Bouncing Visits)'),&#xD;&#xA;		--('Total Conversion Rate', 'Ordering Visits / Sales Visits')&#xD;&#xA;;&#xD;&#xA;&#xD;&#xA;SELECT  *&#xD;&#xA;FROM @toolTips&#xD;&#xA;WHERE ttTraffic = '@Data.Traffic~'&#xD;&#xA;" />
                  </Lookup>
                </DataLayer>
              </DataLayer>
              <Remark>
                <DataLayer Type="Linked" LinkedDataLayerID="dlTrafficAllDataLink" ID="dlTrafficAllDataLinked1" />
              </Remark>
              <DataTableColumn ID="colTraffic" Header="Traffic" Width="110" WidthScale="px">
                <Label ID="lblTraffic" Caption="@Data.Traffic~">
                  <ConditionalClass Condition="&quot;@Data.Traffic~&quot; = &quot;Paid Media&quot; OR &quot;@Data.Traffic~&quot; = &quot;SEO&quot; OR &quot;@Data.Traffic~&quot; = &quot;Direct Entry&quot; OR &quot;@Data.Traffic~&quot; = &quot;Other&quot; OR &quot;@Data.Traffic~&quot; = &quot;Sales CR&quot; OR &quot;@Data.Traffic~&quot; = &quot;Mgmt CR&quot; OR &quot;@Data.Traffic~&quot; = &quot;Support CR&quot;" Class="gdThemeAlignLeftPadLeft" />
                  <TooltipPanel ID="ttTraffic">
                    <Label Caption="@Data.ToolTips~" ID="@ToolTips" />
                  </TooltipPanel>
                </Label>
              </DataTableColumn>
              <DataTableColumn ID="colDaily" Header="Daily" Width="75" WidthScale="px" Class="ThemeAlignRight">
                <Label ID="lblDaily" Caption="@Data.Daily~">
                  <TooltipPanel ID="ttTrafficDailyPERC">
                    <Chart Type="XY" XYChartType="Line" ChartHeight="200" ChartWidth="200" BackgroundColor="White" ChartTitle="Rolling 7 Days" ChartLabelColumnDataType="Date" ChartLabelColumn="rptDate" ChartDataColumn="Value">
                      <DataLayer Type="SQL" Source="USE [BiLogiReporting]&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;DECLARE @rptDate  AS DATE = '@Request.rptDay~',&#xD;&#xA;	@Format AS VARCHAR(50) = 'FormatPERC'&#xD;&#xA;&#xD;&#xA;        IF @rptDate  IS NULL &#xD;&#xA;            BEGIN&#xD;&#xA;                SET @rptDate  = DATEADD(DAY, -1, GETDATE());&#xD;&#xA;            END;&#xD;&#xA;        IF @rptDate  = DATEADD(dd, 0, DATEDIFF(dd, 0, GETDATE())) &#xD;&#xA;            BEGIN &#xD;&#xA;                SET @rptDate  = DATEADD(DAY, -1, @rptDate );&#xD;&#xA;            END;&#xD;&#xA;		&#xD;&#xA;&#xD;&#xA;if OBJECT_ID('tempdb.dbo.#myMetricsPERC') is not null drop table #myMetricsPERC&#xD;&#xA;CREATE TABLE #myMetricsPERC (SortOrder INT IDENTITY(1, 1), Metric VARCHAR(100) PRIMARY KEY, metricFormat varchar(100));&#xD;&#xA;&#xD;&#xA;INSERT  INTO #myMetricsPERC&#xD;&#xA;VALUES  ( 'Total Visits', '#,##0' ),&#xD;&#xA;        ( 'Paid Media', '#,##0' ),&#xD;&#xA;        ( 'SEO', '#,##0' ),&#xD;&#xA;        ( 'Direct Entry', '#,##0' ),&#xD;&#xA;        ( 'Other', '#,##0' ),&#xD;&#xA;        ( '% Sales Visits', '#,##0.0%' ),&#xD;&#xA;        ( '% Acct Management', '#,##0.0%' ),&#xD;&#xA;        ( '% Support', '#,##0.0%' ),&#xD;&#xA;        ( 'Cart Create Rate', '#,##0.0%' ),&#xD;&#xA;        ( 'Total Conversion Rate', '#,##0.0%' ),&#xD;&#xA;        ( 'Sales CR', '#,##0.0%' ),&#xD;&#xA;        ( 'Mgmt CR', '#,##0.0%' ),&#xD;&#xA;        ( 'Support CR', '#,##0.0%' ),&#xD;&#xA;        ( 'Avg Min On Site', '#,##0.0' ),&#xD;&#xA;        ( 'Avg Page Count', '#,##0.0' );&#xD;&#xA;&#xD;&#xA;if OBJECT_ID('tempdb.dbo.#myDataPERC') is not null drop table #myDataPERC&#xD;&#xA;CREATE TABLE #myDataPERC (visitDate date, channel nvarchar(50), isSales bit, isMgmt bit, isSupport bit, referredBy nvarchar(20), Divisor int, visits int, orderingVisits int, bouncingVisits int&#xD;&#xA;	, cartCreates int, secOnSite int, TrafficPageCount int);&#xD;&#xA;&#xD;&#xA;CREATE nonCLUSTERED INDEX x0 ON #myDataPERC (visitDate);&#xD;&#xA;CREATE nonCLUSTERED INDEX x1 ON #myDataPERC (channel);&#xD;&#xA;CREATE nonCLUSTERED INDEX x2 ON #myDataPERC (isSales);&#xD;&#xA;CREATE nonCLUSTERED INDEX x3 ON #myDataPERC (isMgmt);&#xD;&#xA;CREATE nonCLUSTERED INDEX x4 ON #myDataPERC (isSupport);&#xD;&#xA;CREATE nonCLUSTERED INDEX x5 ON #myDataPERC (referredBy);&#xD;&#xA;CREATE nonCLUSTERED INDEX x6 ON #myDataPERC (Divisor);&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;INSERT INTO #myDataPERC (visitDate, channel, isSales, isMgmt, isSupport, referredBy, Divisor, visits, orderingVisits, bouncingVisits, cartCreates, secOnSite, TrafficPageCount)&#xD;&#xA;SELECT visitDate, channel, isSales, isMgmt, isSupport, referredBy, 1 as Divisor&#xD;&#xA;	, SUM(visits) as visits, SUM(orderingVisits) as orderingVisits, SUM(bouncingVisits) as bouncingVisits&#xD;&#xA;	, SUM(cartCreates) as cartCreates, SUM(secOnSite) as secOnSite, SUM(TrafficPageCount) as TrafficPageCount&#xD;&#xA;FROM     [dbo].[rptEcommLogiDashTrafficMart] b WITH ( NOLOCK )&#xD;&#xA;WHERE b.visitDate &gt;= DATEADD(DAY,-98,@rptDate)  AND b.visitDate &lt;= @rptDate&#xD;&#xA;GROUP BY visitDate, channel, isSales, isMgmt, isSupport, referredBy;&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;IF  @Format = 'FormatINT' &#xD;&#xA;	BEGIN&#xD;&#xA;&#xD;&#xA;With mytable AS (&#xD;&#xA;				SELECT b.visitDate AS rptDate,&#xD;&#xA;								SUM(b7.visits) / MAX(b.Divisor) AS [Total Visits] ,&#xD;&#xA;&#xD;&#xA;								SUM(CASE WHEN b.channel &lt;&gt; 'Branding'&#xD;&#xA;											THEN b7.visits&#xD;&#xA;									END) / MAX(b.Divisor) AS [Paid Media] ,&#xD;&#xA;&#xD;&#xA;								SUM(CASE WHEN b.channel = 'Branding'&#xD;&#xA;												AND b.referredBy = 'Search Engine'&#xD;&#xA;											THEN b7.visits&#xD;&#xA;									END) / MAX(b.Divisor) AS SEO ,&#xD;&#xA;&#xD;&#xA;								SUM(CASE WHEN b.Channel = 'Branding'&#xD;&#xA;												AND b.referredBy = 'DirectNav'&#xD;&#xA;											THEN b7.visits&#xD;&#xA;									END) / MAX(b.Divisor) AS [Direct Entry] ,&#xD;&#xA;&#xD;&#xA;								SUM(CASE WHEN b.Channel = 'Branding'&#xD;&#xA;												AND b.referredBy &lt;&gt; 'DirectNav'&#xD;&#xA;												AND b.referredBy &lt;&gt; 'Search Engine'&#xD;&#xA;											THEN b7.visits&#xD;&#xA;									END) / MAX(b.Divisor) AS Other &#xD;&#xA;			FROM #myDataPERC b &#xD;&#xA;				JOIN #myDataPERC b7 ON b7.visitDate &gt; dateadd(day, -7, b.visitDate) and b7.visitDate &lt;= b.visitDate&#xD;&#xA;					AND b.channel = b7.channel AND b.isSales = b7.isSales AND b.isMgmt = b7.isMgmt AND b.isSupport = b7.isSupport &#xD;&#xA;					AND b.referredBy = b7.referredBy AND b.Divisor = b7.Divisor&#xD;&#xA;			WHERE b.visitDate &gt;= DATEADD(DAY,-91,@rptDate)&#xD;&#xA;			GROUP BY b.visitDate&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;),&#xD;&#xA;pivoted AS&#xD;&#xA;	( SELECT   *&#xD;&#xA;                       FROM     mytable UNPIVOT ( value FOR Metric IN ( [Total Visits],&#xD;&#xA;                                                              [Paid Media],&#xD;&#xA;                                                              SEO,&#xD;&#xA;                                                              [Direct Entry],&#xD;&#xA;                                                              Other) ) up&#xD;&#xA;	)&#xD;&#xA;&#xD;&#xA;	SELECT mr.Metric, mr.rptDate, mr.Value  * .001 as Value -- 000s&#xD;&#xA;    FROM    pivoted mr&#xD;&#xA;		JOIN #myMetricsINT mm ON mm.Metric = mr.Metric&#xD;&#xA;	WHERE mr.Metric = '@Data.Traffic~'&#xD;&#xA;	GROUP BY mr.Metric, mr.rptDate&#xD;&#xA;&#xD;&#xA;END&#xD;&#xA;&#xD;&#xA;IF  @Format = 'FormatPERC' &#xD;&#xA;	BEGIN&#xD;&#xA;&#xD;&#xA;With mytable AS (&#xD;&#xA;				SELECT b.visitDate AS rptDate,&#xD;&#xA;								CAST(SUM(CASE WHEN b.isSales = 1 THEN b7.visits&#xD;&#xA;											END) AS DECIMAL(18, 4)) / SUM(b7.visits)&#xD;&#xA;								/ COALESCE(1, b.Divisor) AS [% Sales Visits] ,&#xD;&#xA;&#xD;&#xA;								CAST(SUM(CASE WHEN b.isMgmt = 1 THEN b7.visits&#xD;&#xA;											END) AS DECIMAL(18, 4)) / SUM(b7.visits)&#xD;&#xA;								/ COALESCE(1, b.Divisor) AS [% Acct Management] ,&#xD;&#xA;&#xD;&#xA;								CAST(SUM(CASE WHEN b.isSupport = 1 THEN b7.visits&#xD;&#xA;											END) AS DECIMAL(18, 4)) / SUM(b7.visits)&#xD;&#xA;								/ COALESCE(1, b.Divisor) AS [% Support] ,&#xD;&#xA;&#xD;&#xA;								CAST(SUM(b7.cartcreates) AS DECIMAL(18, 4))&#xD;&#xA;								/ ( SUM(b7.visits) - SUM(b7.bouncingvisits) )&#xD;&#xA;								/ COALESCE(1, b.Divisor) AS [Cart Create Rate] ,&#xD;&#xA;&#xD;&#xA;								CAST(SUM(b7.orderingvisits) AS DECIMAL(18, 4))&#xD;&#xA;								/ SUM(b7.visits) / COALESCE(1, b.Divisor) AS [Total Conversion Rate] ,&#xD;&#xA;								CAST(SUM(CASE WHEN b.isSales = 1&#xD;&#xA;												THEN b7.orderingvisits&#xD;&#xA;											END) AS DECIMAL(18, 4))&#xD;&#xA;								/ SUM(CASE WHEN b.isSales = 1 THEN b7.visits&#xD;&#xA;										END) / COALESCE(1, b.Divisor) AS [Sales CR] ,&#xD;&#xA;&#xD;&#xA;								CAST(SUM(CASE WHEN b.isMgmt = 1&#xD;&#xA;												THEN b7.orderingvisits&#xD;&#xA;											END) AS DECIMAL(18, 4))&#xD;&#xA;								/ SUM(CASE WHEN b.isMgmt = 1 THEN b7.visits&#xD;&#xA;										END) / COALESCE(1, b.Divisor) AS [Mgmt CR] ,&#xD;&#xA;&#xD;&#xA;								CAST(SUM(CASE WHEN b.isSupport = 1&#xD;&#xA;												THEN b7.orderingvisits&#xD;&#xA;											END) AS DECIMAL(18, 4))&#xD;&#xA;								/ SUM(CASE WHEN b.isSupport = 1 THEN b7.visits&#xD;&#xA;										END) / COALESCE(1, b.Divisor) AS [Support CR] &#xD;&#xA;			FROM #myDataPERC b &#xD;&#xA;				JOIN #myDataPERC b7 ON b7.visitDate &gt; dateadd(day, -7, b.visitDate) and b7.visitDate &lt;= b.visitDate&#xD;&#xA;					AND b.channel = b7.channel AND b.isSales = b7.isSales AND b.isMgmt = b7.isMgmt AND b.isSupport = b7.isSupport &#xD;&#xA;					AND b.referredBy = b7.referredBy AND b.Divisor = b7.Divisor&#xD;&#xA;			WHERE b.visitDate &gt;= DATEADD(DAY,-91,@rptDate)&#xD;&#xA;			GROUP BY b.visitDate&#xD;&#xA;&#xD;&#xA;),&#xD;&#xA;pivoted AS&#xD;&#xA;	( SELECT   *&#xD;&#xA;                       FROM     mytable UNPIVOT ( value FOR Metric IN ( &#xD;&#xA;                                                              [% Sales Visits],&#xD;&#xA;                                                              [% Acct Management],&#xD;&#xA;                                                              [% Support],&#xD;&#xA;                                                              [Cart Create Rate],&#xD;&#xA;                                                              [Total Conversion Rate],&#xD;&#xA;                                                              [Sales CR],&#xD;&#xA;                                                              [Mgmt CR],&#xD;&#xA;                                                              [Support CR]) ) up&#xD;&#xA;	)&#xD;&#xA;&#xD;&#xA;	SELECT mr.Metric, mr.rptDate, mr.Value&#xD;&#xA;    FROM    pivoted mr&#xD;&#xA;		JOIN #myMetricsPERC mm ON mm.Metric = mr.Metric&#xD;&#xA;	WHERE mr.Metric = '@Data.Traffic~'&#xD;&#xA;&#xD;&#xA;END&#xD;&#xA;&#xD;&#xA;IF  @Format = 'FormatDEC' &#xD;&#xA;	BEGIN&#xD;&#xA;&#xD;&#xA;With mytable AS (&#xD;&#xA;				SELECT b.visitDate AS rptDate,&#xD;&#xA;								( SUM(CAST(b7.SecOnSite AS DECIMAL(18, 4)))&#xD;&#xA;									/ SUM(b7.visits) ) / 60 / COALESCE(1, b.Divisor) AS [Avg Min On Site] ,&#xD;&#xA;&#xD;&#xA;								( SUM(CAST(b7.TrafficPageCount AS DECIMAL(18, 4)))&#xD;&#xA;								/ SUM(b7.visits)) / COALESCE(1, b.Divisor) AS [Avg Page Count]&#xD;&#xA;			FROM #myDataPERC b &#xD;&#xA;				JOIN #myDataPERC b7 ON b7.visitDate &gt; dateadd(day, -7, b.visitDate) and b7.visitDate &lt;= b.visitDate&#xD;&#xA;					AND b.channel = b7.channel AND b.isSales = b7.isSales AND b.isMgmt = b7.isMgmt AND b.isSupport = b7.isSupport &#xD;&#xA;					AND b.referredBy = b7.referredBy AND b.Divisor = b7.Divisor&#xD;&#xA;			WHERE b.visitDate &gt;= DATEADD(DAY,-91,@rptDate)&#xD;&#xA;			GROUP BY b.visitDate&#xD;&#xA;&#xD;&#xA;),&#xD;&#xA;pivoted AS&#xD;&#xA;	( SELECT   *&#xD;&#xA;                       FROM     mytable UNPIVOT ( value FOR Metric IN ( &#xD;&#xA;                                                              [Avg Min on Site],&#xD;&#xA;                                                              [Avg Page Count] ) ) up&#xD;&#xA;	)&#xD;&#xA;&#xD;&#xA;	SELECT mr.Metric, mr.rptDate, mr.Value&#xD;&#xA;    FROM    pivoted mr&#xD;&#xA;		JOIN #myMetricsPERC mm ON mm.Metric = mr.Metric&#xD;&#xA;	WHERE mr.Metric = '@Data.Traffic~'&#xD;&#xA;&#xD;&#xA;END&#xD;&#xA;;&#xD;&#xA;&#xD;&#xA;Drop TABLE #myMetricsPERC&#xD;&#xA;Drop TABLE #myDataPERC&#xD;&#xA;&#xD;&#xA;" ConnectionID="connM1BIG-biLogiReporting" ID="dl7DayTrafficPERC" IdeDisplayStatus="Collapsed">
                        <SqlParameters>
                          <SqlParameter Value="@Request.rptDay~" SqlParamType="dt-7" ID="@ReportDay" />
                        </SqlParameters>
                        <SortFilter SortColumn="rptDate" DataType="Date" ID="sfDate" SortSequence="Ascending" />
                      </DataLayer>
                      <FontLabel FontAngle="90" FontSize="8" FontColor="black" BorderColor="Black" />
                      <FontChartTitle FontSize="14" FontColor="Black" />
                      <FontData FontSize="8" FontColor="Black" BorderColor="Black" />
                      <FontYAxisTitle FontColor="Black" />
                      <LabelScale Format="MMM-yy" LinearTickIncrement="Months" ScalingMode="LinearTime" />
                      <DataScale Format="##0.0%" />
                    </Chart>
                  </TooltipPanel>
                </Label>
              </DataTableColumn>
              <DataTableColumn ID="colDailyGoal" Header="Daily Goal" Width="75" WidthScale="px" Class="ThemeAlignRight">
                <Label ID="lblDailyGoal" Caption="@Data.DailyGoal~" />
              </DataTableColumn>
              <DataTableColumn ID="colDailyVariance" Header="Daily Variance" Width="60" WidthScale="px" Class="ThemeAlignRight">
                <Label ID="lblDailyVariance" Caption="@Data.DailyVariance~">
                  <ConditionalClass Class="ThemeTextNegative" Condition="Left(&quot;@Data.DailyVariance~&quot;,1) = &quot;-&quot;" />
                </Label>
              </DataTableColumn>
              <DataTableColumn ID="colMTD" Header="MTD" Width="75" WidthScale="px" Class="ThemeAlignRight">
                <Label ID="lblMTD" Caption="@Data.Mtd~">
                  <TooltipPanel ID="ttTrafficMnthlyPERC">
                    <Chart Type="XY" XYChartType="Line" ChartHeight="200" BackgroundColor="White" ChartTitle="6-Month Trend" ChartLabelColumnDataType="Date" ChartLabelColumn="rptMonth" ChartDataColumn="Value" ChartWidth="200">
                      <DataLayer Type="SQL" Source="USE [BiLogiReporting]&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;DECLARE @rptDay AS DATE = '@Request.rptDay~',&#xD;&#xA;	@Format AS VARCHAR(50) = 'FormatPERC'&#xD;&#xA;DECLARE @rptMonth DATE = DATEADD(MONTH, DATEDIFF(MONTH, 0, @rptDay), 0) &#xD;&#xA;&#xD;&#xA;        IF @rptDay IS NULL &#xD;&#xA;            BEGIN&#xD;&#xA;                SET @rptDay = DATEADD(DAY, -1, GETDATE());&#xD;&#xA;            END;&#xD;&#xA;        IF @rptDay = DATEADD(dd, 0, DATEDIFF(dd, 0, GETDATE())) &#xD;&#xA;            BEGIN &#xD;&#xA;                SET @rptDay = DATEADD(DAY, -1, @rptDay);&#xD;&#xA;            END;&#xD;&#xA;		&#xD;&#xA;&#xD;&#xA;DECLARE @myDates TABLE (colName nvarchar(500), startDate DATE, endDate DATE, Divisor FLOAT);&#xD;&#xA;&#xD;&#xA;INSERT  INTO @myDates&#xD;&#xA;SELECT  @rptMonth, DATEADD(month,-6,@rptDay)&#xD;&#xA;		, DATEADD(day,1,@rptDay), 1&#xD;&#xA;OPTION  ( MAXDOP 1 );&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;DECLARE @myResults TABLE (Metric VARCHAR(100) PRIMARY KEY, rptMonth DECIMAL(18, 4));&#xD;&#xA;&#xD;&#xA;DECLARE @myMetrics TABLE (SortOrder INT IDENTITY(1, 1), Metric VARCHAR(100) PRIMARY KEY, metricFormat varchar(100));&#xD;&#xA;&#xD;&#xA;INSERT  INTO @myMetrics&#xD;&#xA;VALUES  ( 'Total Visits', '#,##0' ),&#xD;&#xA;        ( 'Paid Media', '#,##0' ),&#xD;&#xA;        ( 'SEO', '#,##0' ),&#xD;&#xA;        ( 'Direct Entry', '#,##0' ),&#xD;&#xA;        ( 'Other', '#,##0' ),&#xD;&#xA;        ( '% Sales Visits', '#,##0.0%' ),&#xD;&#xA;        ( '% Acct Management', '#,##0.0%' ),&#xD;&#xA;        ( '% Support', '#,##0.0%' ),&#xD;&#xA;        ( 'Cart Create Rate', '#,##0.0%' ),&#xD;&#xA;        ( 'Total Conversion Rate', '#,##0.0%' ),&#xD;&#xA;        ( 'Sales CR', '#,##0.0%' ),&#xD;&#xA;        ( 'Mgmt CR', '#,##0.0%' ),&#xD;&#xA;        ( 'Support CR', '#,##0.0%' ),&#xD;&#xA;        ( 'Avg Min On Site', '#,##0.0' ),&#xD;&#xA;        ( 'Avg Page Count', '#,##0.0' );&#xD;&#xA;&#xD;&#xA;IF  @Format = 'FormatINT' &#xD;&#xA;	BEGIN&#xD;&#xA;&#xD;&#xA;With mytable AS (&#xD;&#xA;				SELECT DATEADD(M,-1,DATEADD(D,1,DATEADD(M,(DATEDIFF(m,-1,b.visitDate)),-1))) AS rptMonth ,&#xD;&#xA;								SUM(visits) / MAX(md.Divisor) AS [Total Visits] ,&#xD;&#xA;								SUM(CASE WHEN channel &lt;&gt; 'Branding'&#xD;&#xA;											THEN visits&#xD;&#xA;									END) / MAX(md.Divisor) AS [Paid Media] ,&#xD;&#xA;								SUM(CASE WHEN channel = 'Branding'&#xD;&#xA;												AND referredBy = 'Search Engine'&#xD;&#xA;											THEN visits&#xD;&#xA;									END) / MAX(md.Divisor) AS SEO ,&#xD;&#xA;								SUM(CASE WHEN Channel = 'Branding'&#xD;&#xA;												AND referredBy = 'DirectNav'&#xD;&#xA;											THEN visits&#xD;&#xA;									END) / MAX(md.Divisor) AS [Direct Entry] ,&#xD;&#xA;								SUM(CASE WHEN Channel = 'Branding'&#xD;&#xA;												AND referredBy &lt;&gt; 'DirectNav'&#xD;&#xA;												AND referredBy &lt;&gt; 'Search Engine'&#xD;&#xA;											THEN visits&#xD;&#xA;									END) / MAX(md.Divisor) AS Other &#xD;&#xA;			FROM     [dbo].[rptEcommLogiDashTrafficMart] b WITH ( NOLOCK )&#xD;&#xA;				JOIN @myDates md ON b.visitDate &gt;= DATEADD(D,1,DATEADD(M,(DATEDIFF(m,-1,md.startDate)),-1)) AND b.visitDate &lt; md.endDate&#xD;&#xA;					AND DATEPART(DAY, b.visitDate) &lt;= DATEPART(DAY, @rptDay) &#xD;&#xA;			GROUP BY DATEADD(M,-1,DATEADD(D,1,DATEADD(M,(DATEDIFF(m,-1,b.visitDate)),-1)))&#xD;&#xA;&#xD;&#xA;),&#xD;&#xA;pivoted AS&#xD;&#xA;	( SELECT   *&#xD;&#xA;                       FROM     mytable UNPIVOT ( value FOR Metric IN ( [Total Visits],&#xD;&#xA;                                                              [Paid Media],&#xD;&#xA;                                                              SEO,&#xD;&#xA;                                                              [Direct Entry],&#xD;&#xA;                                                              Other) ) up&#xD;&#xA;	)&#xD;&#xA;&#xD;&#xA;	SELECT mr.Metric, mr.rptMonth, mr.Value * .001 as Value&#xD;&#xA;    FROM    pivoted mr&#xD;&#xA;		JOIN @myMetrics mm ON mm.Metric = mr.Metric&#xD;&#xA;	WHERE mr.Metric = '@Data.Traffic~'&#xD;&#xA;&#xD;&#xA;END&#xD;&#xA;&#xD;&#xA;IF  @Format = 'FormatPERC' &#xD;&#xA;	BEGIN&#xD;&#xA;&#xD;&#xA;With mytable AS (&#xD;&#xA;				SELECT DATEADD(M,-1,DATEADD(D,1,DATEADD(M,(DATEDIFF(m,-1,b.visitDate)),-1))) AS rptMonth ,&#xD;&#xA;								CAST(SUM(CASE WHEN isSales = 1 THEN visits&#xD;&#xA;											END) AS DECIMAL(18, 4)) / SUM(visits)&#xD;&#xA;								/ COALESCE(1, md.Divisor) AS [% Sales Visits] ,&#xD;&#xA;								CAST(SUM(CASE WHEN isMgmt = 1 THEN visits&#xD;&#xA;											END) AS DECIMAL(18, 4)) / SUM(visits)&#xD;&#xA;								/ COALESCE(1, md.Divisor) AS [% Acct Management] ,&#xD;&#xA;								CAST(SUM(CASE WHEN isSupport = 1 THEN visits&#xD;&#xA;											END) AS DECIMAL(18, 4)) / SUM(visits)&#xD;&#xA;								/ COALESCE(1, md.Divisor) AS [% Support] ,&#xD;&#xA;								CAST(SUM(cartcreates) AS DECIMAL(18, 4))&#xD;&#xA;								/ ( SUM(visits) - SUM(bouncingvisits) )&#xD;&#xA;								/ COALESCE(1, md.Divisor) AS [Cart Create Rate] ,&#xD;&#xA;								CAST(SUM(orderingvisits) AS DECIMAL(18, 4))&#xD;&#xA;								/ SUM(visits) / COALESCE(1, md.Divisor) AS [Total Conversion Rate] ,&#xD;&#xA;								CAST(SUM(CASE WHEN isSales = 1&#xD;&#xA;												THEN orderingvisits&#xD;&#xA;											END) AS DECIMAL(18, 4))&#xD;&#xA;								/ SUM(CASE WHEN isSales = 1 THEN visits&#xD;&#xA;										END) / COALESCE(1, md.Divisor) AS [Sales CR] ,&#xD;&#xA;								CAST(SUM(CASE WHEN isMgmt = 1&#xD;&#xA;												THEN orderingvisits&#xD;&#xA;											END) AS DECIMAL(18, 4))&#xD;&#xA;								/ SUM(CASE WHEN isMgmt = 1 THEN visits&#xD;&#xA;										END) / COALESCE(1, md.Divisor) AS [Mgmt CR] ,&#xD;&#xA;								CAST(SUM(CASE WHEN isSupport = 1&#xD;&#xA;												THEN orderingvisits&#xD;&#xA;											END) AS DECIMAL(18, 4))&#xD;&#xA;								/ SUM(CASE WHEN isSupport = 1 THEN visits&#xD;&#xA;										END) / COALESCE(1, md.Divisor) AS [Support CR] &#xD;&#xA;			FROM     [dbo].[rptEcommLogiDashTrafficMart] b WITH ( NOLOCK )&#xD;&#xA;				JOIN @myDates md ON b.visitDate &gt;= DATEADD(D,1,DATEADD(M,(DATEDIFF(m,-1,md.startDate)),-1)) AND b.visitDate &lt; md.endDate&#xD;&#xA;					AND DATEPART(DAY, b.visitDate) &lt;= DATEPART(DAY, @rptDay) &#xD;&#xA;			GROUP BY DATEADD(M,-1,DATEADD(D,1,DATEADD(M,(DATEDIFF(m,-1,b.visitDate)),-1)))&#xD;&#xA;&#xD;&#xA;),&#xD;&#xA;pivoted AS&#xD;&#xA;	( SELECT   *&#xD;&#xA;                       FROM     mytable UNPIVOT ( value FOR Metric IN ( &#xD;&#xA;                                                              [% Sales Visits],&#xD;&#xA;                                                              [% Acct Management],&#xD;&#xA;                                                              [% Support],&#xD;&#xA;                                                              [Cart Create Rate],&#xD;&#xA;                                                              [Total Conversion Rate],&#xD;&#xA;                                                              [Sales CR],&#xD;&#xA;                                                              [Mgmt CR],&#xD;&#xA;                                                              [Support CR]) ) up&#xD;&#xA;	)&#xD;&#xA;&#xD;&#xA;	SELECT mr.Metric, mr.rptMonth, mr.Value&#xD;&#xA;    FROM    pivoted mr&#xD;&#xA;		JOIN @myMetrics mm ON mm.Metric = mr.Metric&#xD;&#xA;	WHERE mr.Metric = '@Data.Traffic~'&#xD;&#xA;&#xD;&#xA;END&#xD;&#xA;&#xD;&#xA;IF  @Format = 'FormatDEC' &#xD;&#xA;	BEGIN&#xD;&#xA;&#xD;&#xA;With mytable AS (&#xD;&#xA;				SELECT DATEADD(M,-1,DATEADD(D,1,DATEADD(M,(DATEDIFF(m,-1,b.visitDate)),-1))) AS rptMonth ,&#xD;&#xA;								( SUM(CAST(SecOnSite AS DECIMAL(18, 4)))&#xD;&#xA;									/ SUM(visits) ) / 60 / COALESCE(1,&#xD;&#xA;																md.Divisor) AS [Avg Min On Site] ,&#xD;&#xA;								CAST(SUM(TrafficPageCount) AS DECIMAL(18, 4))&#xD;&#xA;								/ SUM(visits) / COALESCE(1, md.Divisor) AS [Avg Page Count]&#xD;&#xA;			FROM     [dbo].[rptEcommLogiDashTrafficMart] b WITH ( NOLOCK )&#xD;&#xA;				JOIN @myDates md ON b.visitDate &gt;= DATEADD(D,1,DATEADD(M,(DATEDIFF(m,-1,md.startDate)),-1)) AND b.visitDate &lt; md.endDate &#xD;&#xA;					AND DATEPART(DAY, b.visitDate) &lt;= DATEPART(DAY, @rptDay) &#xD;&#xA;			GROUP BY DATEADD(M,-1,DATEADD(D,1,DATEADD(M,(DATEDIFF(m,-1,b.visitDate)),-1)))&#xD;&#xA;&#xD;&#xA;),&#xD;&#xA;pivoted AS&#xD;&#xA;	( SELECT   *&#xD;&#xA;                       FROM     mytable UNPIVOT ( value FOR Metric IN ( &#xD;&#xA;                                                              [Avg Min on Site],&#xD;&#xA;                                                              [Avg Page Count] ) ) up&#xD;&#xA;	)&#xD;&#xA;&#xD;&#xA;	SELECT mr.Metric, mr.rptMonth, mr.Value&#xD;&#xA;    FROM    pivoted mr&#xD;&#xA;		JOIN @myMetrics mm ON mm.Metric = mr.Metric&#xD;&#xA;	WHERE mr.Metric = '@Data.Traffic~'&#xD;&#xA;&#xD;&#xA;END&#xD;&#xA;;" ConnectionID="connM1BIG-biLogiReporting" ID="dlMnthlyTrafficPERC">
                        <SqlParameters>
                          <SqlParameter Value="@Request.rptDay~" SqlParamType="dt-7" ID="@ReportDay" />
                        </SqlParameters>
                        <SortFilter SortColumn="rptMonth" DataType="Date" ID="sfMonth" SortSequence="Ascending" />
                      </DataLayer>
                      <FontLabel FontAngle="90" FontSize="8" FontColor="black" BorderColor="Black" />
                      <FontChartTitle FontSize="14" FontColor="Black" />
                      <FontData FontSize="8" FontColor="Black" BorderColor="Black" />
                      <FontYAxisTitle FontColor="Black" />
                      <LabelScale Format="MMM-yy" />
                      <DataScale Format="##0.0%" />
                    </Chart>
                  </TooltipPanel>
                </Label>
              </DataTableColumn>
              <DataTableColumn ID="colMTDGoal" Header="MTD Goal" Width="75" WidthScale="px" Class="ThemeAlignRight">
                <Label ID="lblMTDGoal" Caption="@Data.MtdGoal~" />
              </DataTableColumn>
              <DataTableColumn ID="colMTDVariance" Header="MTD Variance" Width="75" WidthScale="px" Class="ThemeAlignRight">
                <Label ID="lblMTDVariance" Caption="@Data.MTDVariance~">
                  <ConditionalClass Class="ThemeTextNegative" Condition="Left(&quot;@Data.MTDVariance~&quot;,1) = &quot;-&quot;" />
                </Label>
              </DataTableColumn>
            </DataTable>
          </Division>
        </Column>
      </Row>
      <Row ID="RowThree">
        <Column ID="colTrafficDEC" Class="gdColumnCell">
          <Division>
            <DataTable ID="dtTrafficDEC" CellSpacing="5 px" AltRowClass="gdThemeAltRowNoPadding td" ColumnHeaderClass="gdTableHeader" CaptionClass="gdColumnCellTitle" Width="700">
              <DataLayer Type="Cached" CacheKey="TrafficDEC,@Request.rptDay~" ExpirationTimeSpan="24:00" ID="dlTrafficDECDataCache">
                <DataLayer Type="SP" Command="rptEcommLogiDashFormatTrafficAll_get_sp" ConnectionID="connM1BIG-biLogiReporting" ID="dlTrafficDEC">
                  <SPParameters>
                    <SPParameter SPParamDirection="Input" ID="@ReportDay" SPParamType="dt-7" SPParamSize="7" Value="@Request.rptDay~" />
                    <SPParameter SPParamDirection="Input" ID="@Format" SPParamSize="50" SPParamType="dt-200" Value="FormatDEC" />
                  </SPParameters>
                  <Lookup IncludeCondition="True" ID="luTooltips">
                    <DataLayer Type="SQL" ConnectionID="connM1BIG-biLogiReporting" ID="dtToolTips" Source="&#xD;&#xA;USE [BiLogiReporting]&#xD;&#xA;&#xD;&#xA;DECLARE @toolTips TABLE&#xD;&#xA;    (&#xD;&#xA;        ttTraffic VARCHAR(50) ,&#xD;&#xA;        ToolTips VARCHAR(250)&#xD;&#xA;    );&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;INSERT INTO @toolTips (ttTraffic, ToolTips)&#xD;&#xA;	VALUES&#xD;&#xA;		--('Total Visits', 'Total unique daily visits'),&#xD;&#xA;		--('Paid Media', 'Acquisition channel other than Branding (ie ISC traffic)'),&#xD;&#xA;		--('SEO', 'Acquisition channel  is Branding, referred by a Search Engine (ie Google, Bing, Yahoo, Ask, Baidu)'),&#xD;&#xA;		--('Direct Entry', 'Acquisition channel  is Branding, referred by DirectNav (ie No referring site)'),&#xD;&#xA;		--('Other', 'Everything else'),&#xD;&#xA;		--('% Sales Visits', '% of Total Visits that  saw a sales page (www, in, uk, ca, au, es, cart, auctions, myr page (HP excluded) or a HP bounce)'),&#xD;&#xA;		--('% Acct Management', '% of Total Visits that saw the mya page, excluding myr'),&#xD;&#xA;		--('% Support', '% of Total Visits that saw a ‘support’, ‘community’ or ‘help’ page during their visit')--,&#xD;&#xA;		('Cart Create Rate', 'Cart Creates / (Sales Visits - Sales Bouncing Visits)'),&#xD;&#xA;		('Total Conversion Rate', 'Ordering Visits / Sales Visits')&#xD;&#xA;;&#xD;&#xA;&#xD;&#xA;SELECT  *&#xD;&#xA;FROM @toolTips&#xD;&#xA;WHERE ttTraffic = '@Data.Traffic~'&#xD;&#xA;" />
                  </Lookup>
                </DataLayer>
              </DataLayer>
              <Remark>
                <DataLayer Type="Linked" LinkedDataLayerID="dlTrafficAllDataLink" ID="dlTrafficAllDataLinked1" />
              </Remark>
              <DataTableColumn ID="colTraffic" Header="Traffic" Width="110" WidthScale="px">
                <Label ID="lblTraffic" Caption="@Data.Traffic~">
                  <ConditionalClass Condition="&quot;@Data.Traffic~&quot; = &quot;Paid Media&quot; OR &quot;@Data.Traffic~&quot; = &quot;SEO&quot; OR &quot;@Data.Traffic~&quot; = &quot;Direct Entry&quot; OR &quot;@Data.Traffic~&quot; = &quot;Other&quot; OR &quot;@Data.Traffic~&quot; = &quot;Sales CR&quot; OR &quot;@Data.Traffic~&quot; = &quot;Mgmt CR&quot; OR &quot;@Data.Traffic~&quot; = &quot;Support CR&quot;" Class="gdThemeAlignLeftPadLeft" />
                  <TooltipPanel ID="ttTraffic">
                    <Label Caption="@Data.ToolTips~" ID="@ToolTips" />
                  </TooltipPanel>
                </Label>
              </DataTableColumn>
              <DataTableColumn ID="colDaily" Header="Daily" Width="75" WidthScale="px" Class="ThemeAlignRight">
                <Label ID="lblDaily" Caption="@Data.Daily~">
                  <TooltipPanel ID="ttTrafficDailyDEC">
                    <Chart Type="XY" XYChartType="Line" ChartHeight="200" ChartWidth="200" BackgroundColor="White" ChartTitle="Rolling 7 Days" ChartLabelColumnDataType="Date" ChartLabelColumn="rptDate" ChartDataColumn="Value">
                      <DataLayer Type="SQL" Source="USE [BiLogiReporting]&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;DECLARE @rptDate  AS DATE = '@Request.rptDay~',&#xD;&#xA;	@Format AS VARCHAR(50) = 'FormatDEC'&#xD;&#xA;&#xD;&#xA;        IF @rptDate  IS NULL &#xD;&#xA;            BEGIN&#xD;&#xA;                SET @rptDate  = DATEADD(DAY, -1, GETDATE());&#xD;&#xA;            END;&#xD;&#xA;        IF @rptDate  = DATEADD(dd, 0, DATEDIFF(dd, 0, GETDATE())) &#xD;&#xA;            BEGIN &#xD;&#xA;                SET @rptDate  = DATEADD(DAY, -1, @rptDate );&#xD;&#xA;            END;&#xD;&#xA;		&#xD;&#xA;&#xD;&#xA;if OBJECT_ID('tempdb.dbo.#myMetricsDEC') is not null drop table #myMetricsDEC&#xD;&#xA;CREATE TABLE #myMetricsDEC (SortOrder INT IDENTITY(1, 1), Metric VARCHAR(100) PRIMARY KEY, metricFormat varchar(100));&#xD;&#xA;&#xD;&#xA;INSERT  INTO #myMetricsDEC&#xD;&#xA;VALUES  ( 'Total Visits', '#,##0' ),&#xD;&#xA;        ( 'Paid Media', '#,##0' ),&#xD;&#xA;        ( 'SEO', '#,##0' ),&#xD;&#xA;        ( 'Direct Entry', '#,##0' ),&#xD;&#xA;        ( 'Other', '#,##0' ),&#xD;&#xA;        ( '% Sales Visits', '#,##0.0%' ),&#xD;&#xA;        ( '% Acct Management', '#,##0.0%' ),&#xD;&#xA;        ( '% Support', '#,##0.0%' ),&#xD;&#xA;        ( 'Cart Create Rate', '#,##0.0%' ),&#xD;&#xA;        ( 'Total Conversion Rate', '#,##0.0%' ),&#xD;&#xA;        ( 'Sales CR', '#,##0.0%' ),&#xD;&#xA;        ( 'Mgmt CR', '#,##0.0%' ),&#xD;&#xA;        ( 'Support CR', '#,##0.0%' ),&#xD;&#xA;        ( 'Avg Min On Site', '#,##0.0' ),&#xD;&#xA;        ( 'Avg Page Count', '#,##0.0' );&#xD;&#xA;&#xD;&#xA;if OBJECT_ID('tempdb.dbo.#myDataDEC') is not null drop table #myDataDEC&#xD;&#xA;CREATE TABLE #myDataDEC (visitDate date, channel nvarchar(50), isSales bit, isMgmt bit, isSupport bit, referredBy nvarchar(20), Divisor int, visits int, orderingVisits int, bouncingVisits int&#xD;&#xA;	, cartCreates int, secOnSite int, TrafficPageCount int);&#xD;&#xA;&#xD;&#xA;CREATE nonCLUSTERED INDEX x0 ON #myDataDEC (visitDate);&#xD;&#xA;CREATE nonCLUSTERED INDEX x1 ON #myDataDEC (channel);&#xD;&#xA;CREATE nonCLUSTERED INDEX x2 ON #myDataDEC (isSales);&#xD;&#xA;CREATE nonCLUSTERED INDEX x3 ON #myDataDEC (isMgmt);&#xD;&#xA;CREATE nonCLUSTERED INDEX x4 ON #myDataDEC (isSupport);&#xD;&#xA;CREATE nonCLUSTERED INDEX x5 ON #myDataDEC (referredBy);&#xD;&#xA;CREATE nonCLUSTERED INDEX x6 ON #myDataDEC (Divisor);&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;INSERT INTO #myDataDEC (visitDate, channel, isSales, isMgmt, isSupport, referredBy, Divisor, visits, orderingVisits, bouncingVisits, cartCreates, secOnSite, TrafficPageCount)&#xD;&#xA;SELECT visitDate, channel, isSales, isMgmt, isSupport, referredBy, 1 as Divisor&#xD;&#xA;	, SUM(visits) as visits, SUM(orderingVisits) as orderingVisits, SUM(bouncingVisits) as bouncingVisits&#xD;&#xA;	, SUM(cartCreates) as cartCreates, SUM(secOnSite) as secOnSite, SUM(TrafficPageCount) as TrafficPageCount&#xD;&#xA;FROM     [dbo].[rptEcommLogiDashTrafficMart] b WITH ( NOLOCK )&#xD;&#xA;WHERE b.visitDate &gt;= DATEADD(DAY,-98,@rptDate)  AND b.visitDate &lt;= @rptDate&#xD;&#xA;GROUP BY visitDate, channel, isSales, isMgmt, isSupport, referredBy;&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;IF  @Format = 'FormatINT' &#xD;&#xA;	BEGIN&#xD;&#xA;&#xD;&#xA;With mytable AS (&#xD;&#xA;				SELECT b.visitDate AS rptDate,&#xD;&#xA;								SUM(b7.visits) / MAX(b.Divisor) AS [Total Visits] ,&#xD;&#xA;&#xD;&#xA;								SUM(CASE WHEN b.channel &lt;&gt; 'Branding'&#xD;&#xA;											THEN b7.visits&#xD;&#xA;									END) / MAX(b.Divisor) AS [Paid Media] ,&#xD;&#xA;&#xD;&#xA;								SUM(CASE WHEN b.channel = 'Branding'&#xD;&#xA;												AND b.referredBy = 'Search Engine'&#xD;&#xA;											THEN b7.visits&#xD;&#xA;									END) / MAX(b.Divisor) AS SEO ,&#xD;&#xA;&#xD;&#xA;								SUM(CASE WHEN b.Channel = 'Branding'&#xD;&#xA;												AND b.referredBy = 'DirectNav'&#xD;&#xA;											THEN b7.visits&#xD;&#xA;									END) / MAX(b.Divisor) AS [Direct Entry] ,&#xD;&#xA;&#xD;&#xA;								SUM(CASE WHEN b.Channel = 'Branding'&#xD;&#xA;												AND b.referredBy &lt;&gt; 'DirectNav'&#xD;&#xA;												AND b.referredBy &lt;&gt; 'Search Engine'&#xD;&#xA;											THEN b7.visits&#xD;&#xA;									END) / MAX(b.Divisor) AS Other &#xD;&#xA;			FROM #myDataDEC b &#xD;&#xA;				JOIN #myDataDEC b7 ON b7.visitDate &gt; dateadd(day, -7, b.visitDate) and b7.visitDate &lt;= b.visitDate&#xD;&#xA;					AND b.channel = b7.channel AND b.isSales = b7.isSales AND b.isMgmt = b7.isMgmt AND b.isSupport = b7.isSupport &#xD;&#xA;					AND b.referredBy = b7.referredBy AND b.Divisor = b7.Divisor&#xD;&#xA;			WHERE b.visitDate &gt;= DATEADD(DAY,-91,@rptDate)&#xD;&#xA;			GROUP BY b.visitDate&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;),&#xD;&#xA;pivoted AS&#xD;&#xA;	( SELECT   *&#xD;&#xA;                       FROM     mytable UNPIVOT ( value FOR Metric IN ( [Total Visits],&#xD;&#xA;                                                              [Paid Media],&#xD;&#xA;                                                              SEO,&#xD;&#xA;                                                              [Direct Entry],&#xD;&#xA;                                                              Other) ) up&#xD;&#xA;	)&#xD;&#xA;&#xD;&#xA;	SELECT mr.Metric, mr.rptDate, mr.Value  * .001 as Value -- 000s&#xD;&#xA;    FROM    pivoted mr&#xD;&#xA;		JOIN #myMetricsINT mm ON mm.Metric = mr.Metric&#xD;&#xA;	WHERE mr.Metric = '@Data.Traffic~'&#xD;&#xA;	GROUP BY mr.Metric, mr.rptDate&#xD;&#xA;&#xD;&#xA;END&#xD;&#xA;&#xD;&#xA;IF  @Format = 'FormatPERC' &#xD;&#xA;	BEGIN&#xD;&#xA;&#xD;&#xA;With mytable AS (&#xD;&#xA;				SELECT b.visitDate AS rptDate,&#xD;&#xA;								CAST(SUM(CASE WHEN b.isSales = 1 THEN b7.visits&#xD;&#xA;											END) AS DECIMAL(18, 4)) / SUM(b7.visits)&#xD;&#xA;								/ COALESCE(1, b.Divisor) AS [% Sales Visits] ,&#xD;&#xA;&#xD;&#xA;								CAST(SUM(CASE WHEN b.isMgmt = 1 THEN b7.visits&#xD;&#xA;											END) AS DECIMAL(18, 4)) / SUM(b7.visits)&#xD;&#xA;								/ COALESCE(1, b.Divisor) AS [% Acct Management] ,&#xD;&#xA;&#xD;&#xA;								CAST(SUM(CASE WHEN b.isSupport = 1 THEN b7.visits&#xD;&#xA;											END) AS DECIMAL(18, 4)) / SUM(b7.visits)&#xD;&#xA;								/ COALESCE(1, b.Divisor) AS [% Support] ,&#xD;&#xA;&#xD;&#xA;								CAST(SUM(b7.cartcreates) AS DECIMAL(18, 4))&#xD;&#xA;								/ ( SUM(b7.visits) - SUM(b7.bouncingvisits) )&#xD;&#xA;								/ COALESCE(1, b.Divisor) AS [Cart Create Rate] ,&#xD;&#xA;&#xD;&#xA;								CAST(SUM(b7.orderingvisits) AS DECIMAL(18, 4))&#xD;&#xA;								/ SUM(b7.visits) / COALESCE(1, b.Divisor) AS [Total Conversion Rate] ,&#xD;&#xA;								CAST(SUM(CASE WHEN b.isSales = 1&#xD;&#xA;												THEN b7.orderingvisits&#xD;&#xA;											END) AS DECIMAL(18, 4))&#xD;&#xA;								/ SUM(CASE WHEN b.isSales = 1 THEN b7.visits&#xD;&#xA;										END) / COALESCE(1, b.Divisor) AS [Sales CR] ,&#xD;&#xA;&#xD;&#xA;								CAST(SUM(CASE WHEN b.isMgmt = 1&#xD;&#xA;												THEN b7.orderingvisits&#xD;&#xA;											END) AS DECIMAL(18, 4))&#xD;&#xA;								/ SUM(CASE WHEN b.isMgmt = 1 THEN b7.visits&#xD;&#xA;										END) / COALESCE(1, b.Divisor) AS [Mgmt CR] ,&#xD;&#xA;&#xD;&#xA;								CAST(SUM(CASE WHEN b.isSupport = 1&#xD;&#xA;												THEN b7.orderingvisits&#xD;&#xA;											END) AS DECIMAL(18, 4))&#xD;&#xA;								/ SUM(CASE WHEN b.isSupport = 1 THEN b7.visits&#xD;&#xA;										END) / COALESCE(1, b.Divisor) AS [Support CR] &#xD;&#xA;			FROM #myDataDEC b &#xD;&#xA;				JOIN #myDataDEC b7 ON b7.visitDate &gt; dateadd(day, -7, b.visitDate) and b7.visitDate &lt;= b.visitDate&#xD;&#xA;					AND b.channel = b7.channel AND b.isSales = b7.isSales AND b.isMgmt = b7.isMgmt AND b.isSupport = b7.isSupport &#xD;&#xA;					AND b.referredBy = b7.referredBy AND b.Divisor = b7.Divisor&#xD;&#xA;			WHERE b.visitDate &gt;= DATEADD(DAY,-91,@rptDate)&#xD;&#xA;			GROUP BY b.visitDate&#xD;&#xA;&#xD;&#xA;),&#xD;&#xA;pivoted AS&#xD;&#xA;	( SELECT   *&#xD;&#xA;                       FROM     mytable UNPIVOT ( value FOR Metric IN ( &#xD;&#xA;                                                              [% Sales Visits],&#xD;&#xA;                                                              [% Acct Management],&#xD;&#xA;                                                              [% Support],&#xD;&#xA;                                                              [Cart Create Rate],&#xD;&#xA;                                                              [Total Conversion Rate],&#xD;&#xA;                                                              [Sales CR],&#xD;&#xA;                                                              [Mgmt CR],&#xD;&#xA;                                                              [Support CR]) ) up&#xD;&#xA;	)&#xD;&#xA;&#xD;&#xA;	SELECT mr.Metric, mr.rptDate, mr.Value&#xD;&#xA;    FROM    pivoted mr&#xD;&#xA;		JOIN #myMetricsDEC mm ON mm.Metric = mr.Metric&#xD;&#xA;	WHERE mr.Metric = '@Data.Traffic~'&#xD;&#xA;&#xD;&#xA;END&#xD;&#xA;&#xD;&#xA;IF  @Format = 'FormatDEC' &#xD;&#xA;	BEGIN&#xD;&#xA;&#xD;&#xA;With mytable AS (&#xD;&#xA;				SELECT b.visitDate AS rptDate,&#xD;&#xA;								( SUM(CAST(b7.SecOnSite AS DECIMAL(18, 4)))&#xD;&#xA;									/ SUM(b7.visits) ) / 60 / COALESCE(1, b.Divisor) AS [Avg Min On Site] ,&#xD;&#xA;&#xD;&#xA;								( SUM(CAST(b7.TrafficPageCount AS DECIMAL(18, 4)))&#xD;&#xA;								/ SUM(b7.visits)) / COALESCE(1, b.Divisor) AS [Avg Page Count]&#xD;&#xA;			FROM #myDataDEC b &#xD;&#xA;				JOIN #myDataDEC b7 ON b7.visitDate &gt; dateadd(day, -7, b.visitDate) and b7.visitDate &lt;= b.visitDate&#xD;&#xA;					AND b.channel = b7.channel AND b.isSales = b7.isSales AND b.isMgmt = b7.isMgmt AND b.isSupport = b7.isSupport &#xD;&#xA;					AND b.referredBy = b7.referredBy AND b.Divisor = b7.Divisor&#xD;&#xA;			WHERE b.visitDate &gt;= DATEADD(DAY,-91,@rptDate)&#xD;&#xA;			GROUP BY b.visitDate&#xD;&#xA;&#xD;&#xA;),&#xD;&#xA;pivoted AS&#xD;&#xA;	( SELECT   *&#xD;&#xA;                       FROM     mytable UNPIVOT ( value FOR Metric IN ( &#xD;&#xA;                                                              [Avg Min on Site],&#xD;&#xA;                                                              [Avg Page Count] ) ) up&#xD;&#xA;	)&#xD;&#xA;&#xD;&#xA;	SELECT mr.Metric, mr.rptDate, mr.Value&#xD;&#xA;    FROM    pivoted mr&#xD;&#xA;		JOIN #myMetricsDEC mm ON mm.Metric = mr.Metric&#xD;&#xA;	WHERE mr.Metric = '@Data.Traffic~'&#xD;&#xA;&#xD;&#xA;END&#xD;&#xA;;&#xD;&#xA;&#xD;&#xA;Drop TABLE #myMetricsDEC&#xD;&#xA;Drop TABLE #myDataDEC&#xD;&#xA;&#xD;&#xA;" ConnectionID="connM1BIG-biLogiReporting" ID="dl7DayTrafficDEC">
                        <SqlParameters>
                          <SqlParameter Value="@Request.rptDay~" SqlParamType="dt-7" ID="@ReportDay" />
                        </SqlParameters>
                        <SortFilter SortColumn="rptDate" DataType="Date" ID="sfDate" SortSequence="Ascending" />
                      </DataLayer>
                      <FontLabel FontAngle="90" FontSize="8" FontColor="black" BorderColor="Black" />
                      <FontChartTitle FontSize="14" FontColor="Black" />
                      <FontData FontSize="8" FontColor="Black" BorderColor="Black" />
                      <FontYAxisTitle FontColor="Black" />
                      <LabelScale Format="MMM-yy" LinearTickIncrement="Months" ScalingMode="LinearTime" />
                      <DataScale Format="##0.0" />
                    </Chart>
                  </TooltipPanel>
                </Label>
              </DataTableColumn>
              <DataTableColumn ID="colDailyGoal" Header="Daily Goal" Width="75" WidthScale="px" Class="ThemeAlignRight">
                <Label ID="lblDailyGoal" Caption="@Data.DailyGoal~" />
              </DataTableColumn>
              <DataTableColumn ID="colDailyVariance" Header="Daily Variance" Width="60" WidthScale="px" Class="ThemeAlignRight">
                <Label ID="lblDailyVariance" Caption="@Data.DailyVariance~">
                  <ConditionalClass Class="ThemeTextNegative" Condition="Left(&quot;@Data.DailyVariance~&quot;,1) = &quot;-&quot;" />
                </Label>
              </DataTableColumn>
              <DataTableColumn ID="colMTD" Header="MTD" Width="75" WidthScale="px" Class="ThemeAlignRight">
                <Label ID="lblMTD" Caption="@Data.Mtd~">
                  <TooltipPanel ID="ttTrafficMnthlyDEC">
                    <Chart Type="XY" XYChartType="Line" ChartHeight="200" BackgroundColor="White" ChartTitle="6-Month Trend" ChartLabelColumnDataType="Date" ChartLabelColumn="rptMonth" ChartDataColumn="Value" ChartWidth="200">
                      <DataLayer Type="SQL" Source="USE [BiLogiReporting]&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;DECLARE @rptDay AS DATE = '@Request.rptDay~',&#xD;&#xA;	@Format AS VARCHAR(50) = 'FormatDEC'&#xD;&#xA;DECLARE @rptMonth DATE = DATEADD(MONTH, DATEDIFF(MONTH, 0, @rptDay), 0) &#xD;&#xA;&#xD;&#xA;        IF @rptDay IS NULL &#xD;&#xA;            BEGIN&#xD;&#xA;                SET @rptDay = DATEADD(DAY, -1, GETDATE());&#xD;&#xA;            END;&#xD;&#xA;        IF @rptDay = DATEADD(dd, 0, DATEDIFF(dd, 0, GETDATE())) &#xD;&#xA;            BEGIN &#xD;&#xA;                SET @rptDay = DATEADD(DAY, -1, @rptDay);&#xD;&#xA;            END;&#xD;&#xA;		&#xD;&#xA;&#xD;&#xA;DECLARE @myDates TABLE (colName nvarchar(500), startDate DATE, endDate DATE, Divisor FLOAT);&#xD;&#xA;&#xD;&#xA;INSERT  INTO @myDates&#xD;&#xA;SELECT  @rptMonth, DATEADD(month,-6,@rptDay)&#xD;&#xA;		, DATEADD(day,1,@rptDay), 1&#xD;&#xA;OPTION  ( MAXDOP 1 );&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;DECLARE @myResults TABLE (Metric VARCHAR(100) PRIMARY KEY, rptMonth DECIMAL(18, 4));&#xD;&#xA;&#xD;&#xA;DECLARE @myMetrics TABLE (SortOrder INT IDENTITY(1, 1), Metric VARCHAR(100) PRIMARY KEY, metricFormat varchar(100));&#xD;&#xA;&#xD;&#xA;INSERT  INTO @myMetrics&#xD;&#xA;VALUES  ( 'Total Visits', '#,##0' ),&#xD;&#xA;        ( 'Paid Media', '#,##0' ),&#xD;&#xA;        ( 'SEO', '#,##0' ),&#xD;&#xA;        ( 'Direct Entry', '#,##0' ),&#xD;&#xA;        ( 'Other', '#,##0' ),&#xD;&#xA;        ( '% Sales Visits', '#,##0.0%' ),&#xD;&#xA;        ( '% Acct Management', '#,##0.0%' ),&#xD;&#xA;        ( '% Support', '#,##0.0%' ),&#xD;&#xA;        ( 'Cart Create Rate', '#,##0.0%' ),&#xD;&#xA;        ( 'Total Conversion Rate', '#,##0.0%' ),&#xD;&#xA;        ( 'Sales CR', '#,##0.0%' ),&#xD;&#xA;        ( 'Mgmt CR', '#,##0.0%' ),&#xD;&#xA;        ( 'Support CR', '#,##0.0%' ),&#xD;&#xA;        ( 'Avg Min On Site', '#,##0.0' ),&#xD;&#xA;        ( 'Avg Page Count', '#,##0.0' );&#xD;&#xA;&#xD;&#xA;IF  @Format = 'FormatINT' &#xD;&#xA;	BEGIN&#xD;&#xA;&#xD;&#xA;With mytable AS (&#xD;&#xA;				SELECT DATEADD(M,-1,DATEADD(D,1,DATEADD(M,(DATEDIFF(m,-1,b.visitDate)),-1))) AS rptMonth ,&#xD;&#xA;								SUM(visits) / MAX(md.Divisor) AS [Total Visits] ,&#xD;&#xA;								SUM(CASE WHEN channel &lt;&gt; 'Branding'&#xD;&#xA;											THEN visits&#xD;&#xA;									END) / MAX(md.Divisor) AS [Paid Media] ,&#xD;&#xA;								SUM(CASE WHEN channel = 'Branding'&#xD;&#xA;												AND referredBy = 'Search Engine'&#xD;&#xA;											THEN visits&#xD;&#xA;									END) / MAX(md.Divisor) AS SEO ,&#xD;&#xA;								SUM(CASE WHEN Channel = 'Branding'&#xD;&#xA;												AND referredBy = 'DirectNav'&#xD;&#xA;											THEN visits&#xD;&#xA;									END) / MAX(md.Divisor) AS [Direct Entry] ,&#xD;&#xA;								SUM(CASE WHEN Channel = 'Branding'&#xD;&#xA;												AND referredBy &lt;&gt; 'DirectNav'&#xD;&#xA;												AND referredBy &lt;&gt; 'Search Engine'&#xD;&#xA;											THEN visits&#xD;&#xA;									END) / MAX(md.Divisor) AS Other &#xD;&#xA;			FROM     [dbo].[rptEcommLogiDashTrafficMart] b WITH ( NOLOCK )&#xD;&#xA;				JOIN @myDates md ON b.visitDate &gt;= DATEADD(D,1,DATEADD(M,(DATEDIFF(m,-1,md.startDate)),-1)) AND b.visitDate &lt; md.endDate&#xD;&#xA;					AND DATEPART(DAY, b.visitDate) &lt;= DATEPART(DAY, @rptDay) &#xD;&#xA;			GROUP BY DATEADD(M,-1,DATEADD(D,1,DATEADD(M,(DATEDIFF(m,-1,b.visitDate)),-1)))&#xD;&#xA;&#xD;&#xA;),&#xD;&#xA;pivoted AS&#xD;&#xA;	( SELECT   *&#xD;&#xA;                       FROM     mytable UNPIVOT ( value FOR Metric IN ( [Total Visits],&#xD;&#xA;                                                              [Paid Media],&#xD;&#xA;                                                              SEO,&#xD;&#xA;                                                              [Direct Entry],&#xD;&#xA;                                                              Other) ) up&#xD;&#xA;	)&#xD;&#xA;&#xD;&#xA;	SELECT mr.Metric, mr.rptMonth, mr.Value * .001 as Value&#xD;&#xA;    FROM    pivoted mr&#xD;&#xA;		JOIN @myMetrics mm ON mm.Metric = mr.Metric&#xD;&#xA;	WHERE mr.Metric = '@Data.Traffic~'&#xD;&#xA;&#xD;&#xA;END&#xD;&#xA;&#xD;&#xA;IF  @Format = 'FormatPERC' &#xD;&#xA;	BEGIN&#xD;&#xA;&#xD;&#xA;With mytable AS (&#xD;&#xA;				SELECT DATEADD(M,-1,DATEADD(D,1,DATEADD(M,(DATEDIFF(m,-1,b.visitDate)),-1))) AS rptMonth ,&#xD;&#xA;								CAST(SUM(CASE WHEN isSales = 1 THEN visits&#xD;&#xA;											END) AS DECIMAL(18, 4)) / SUM(visits)&#xD;&#xA;								/ COALESCE(1, md.Divisor) AS [% Sales Visits] ,&#xD;&#xA;								CAST(SUM(CASE WHEN isMgmt = 1 THEN visits&#xD;&#xA;											END) AS DECIMAL(18, 4)) / SUM(visits)&#xD;&#xA;								/ COALESCE(1, md.Divisor) AS [% Acct Management] ,&#xD;&#xA;								CAST(SUM(CASE WHEN isSupport = 1 THEN visits&#xD;&#xA;											END) AS DECIMAL(18, 4)) / SUM(visits)&#xD;&#xA;								/ COALESCE(1, md.Divisor) AS [% Support] ,&#xD;&#xA;								CAST(SUM(cartcreates) AS DECIMAL(18, 4))&#xD;&#xA;								/ ( SUM(visits) - SUM(bouncingvisits) )&#xD;&#xA;								/ COALESCE(1, md.Divisor) AS [Cart Create Rate] ,&#xD;&#xA;								CAST(SUM(orderingvisits) AS DECIMAL(18, 4))&#xD;&#xA;								/ SUM(visits) / COALESCE(1, md.Divisor) AS [Total Conversion Rate] ,&#xD;&#xA;								CAST(SUM(CASE WHEN isSales = 1&#xD;&#xA;												THEN orderingvisits&#xD;&#xA;											END) AS DECIMAL(18, 4))&#xD;&#xA;								/ SUM(CASE WHEN isSales = 1 THEN visits&#xD;&#xA;										END) / COALESCE(1, md.Divisor) AS [Sales CR] ,&#xD;&#xA;								CAST(SUM(CASE WHEN isMgmt = 1&#xD;&#xA;												THEN orderingvisits&#xD;&#xA;											END) AS DECIMAL(18, 4))&#xD;&#xA;								/ SUM(CASE WHEN isMgmt = 1 THEN visits&#xD;&#xA;										END) / COALESCE(1, md.Divisor) AS [Mgmt CR] ,&#xD;&#xA;								CAST(SUM(CASE WHEN isSupport = 1&#xD;&#xA;												THEN orderingvisits&#xD;&#xA;											END) AS DECIMAL(18, 4))&#xD;&#xA;								/ SUM(CASE WHEN isSupport = 1 THEN visits&#xD;&#xA;										END) / COALESCE(1, md.Divisor) AS [Support CR] &#xD;&#xA;			FROM     [dbo].[rptEcommLogiDashTrafficMart] b WITH ( NOLOCK )&#xD;&#xA;				JOIN @myDates md ON b.visitDate &gt;= DATEADD(D,1,DATEADD(M,(DATEDIFF(m,-1,md.startDate)),-1)) AND b.visitDate &lt; md.endDate&#xD;&#xA;					AND DATEPART(DAY, b.visitDate) &lt;= DATEPART(DAY, @rptDay) &#xD;&#xA;			GROUP BY DATEADD(M,-1,DATEADD(D,1,DATEADD(M,(DATEDIFF(m,-1,b.visitDate)),-1)))&#xD;&#xA;&#xD;&#xA;),&#xD;&#xA;pivoted AS&#xD;&#xA;	( SELECT   *&#xD;&#xA;                       FROM     mytable UNPIVOT ( value FOR Metric IN ( &#xD;&#xA;                                                              [% Sales Visits],&#xD;&#xA;                                                              [% Acct Management],&#xD;&#xA;                                                              [% Support],&#xD;&#xA;                                                              [Cart Create Rate],&#xD;&#xA;                                                              [Total Conversion Rate],&#xD;&#xA;                                                              [Sales CR],&#xD;&#xA;                                                              [Mgmt CR],&#xD;&#xA;                                                              [Support CR]) ) up&#xD;&#xA;	)&#xD;&#xA;&#xD;&#xA;	SELECT mr.Metric, mr.rptMonth, mr.Value&#xD;&#xA;    FROM    pivoted mr&#xD;&#xA;		JOIN @myMetrics mm ON mm.Metric = mr.Metric&#xD;&#xA;	WHERE mr.Metric = '@Data.Traffic~'&#xD;&#xA;&#xD;&#xA;END&#xD;&#xA;&#xD;&#xA;IF  @Format = 'FormatDEC' &#xD;&#xA;	BEGIN&#xD;&#xA;&#xD;&#xA;With mytable AS (&#xD;&#xA;				SELECT DATEADD(M,-1,DATEADD(D,1,DATEADD(M,(DATEDIFF(m,-1,b.visitDate)),-1))) AS rptMonth ,&#xD;&#xA;								( SUM(CAST(SecOnSite AS DECIMAL(18, 4)))&#xD;&#xA;									/ SUM(visits) ) / 60 / COALESCE(1,&#xD;&#xA;																md.Divisor) AS [Avg Min On Site] ,&#xD;&#xA;								CAST(SUM(TrafficPageCount) AS DECIMAL(18, 4))&#xD;&#xA;								/ SUM(visits) / COALESCE(1, md.Divisor) AS [Avg Page Count]&#xD;&#xA;			FROM     [dbo].[rptEcommLogiDashTrafficMart] b WITH ( NOLOCK )&#xD;&#xA;				JOIN @myDates md ON b.visitDate &gt;= DATEADD(D,1,DATEADD(M,(DATEDIFF(m,-1,md.startDate)),-1)) AND b.visitDate &lt; md.endDate &#xD;&#xA;					AND DATEPART(DAY, b.visitDate) &lt;= DATEPART(DAY, @rptDay) &#xD;&#xA;			GROUP BY DATEADD(M,-1,DATEADD(D,1,DATEADD(M,(DATEDIFF(m,-1,b.visitDate)),-1)))&#xD;&#xA;&#xD;&#xA;),&#xD;&#xA;pivoted AS&#xD;&#xA;	( SELECT   *&#xD;&#xA;                       FROM     mytable UNPIVOT ( value FOR Metric IN ( &#xD;&#xA;                                                              [Avg Min on Site],&#xD;&#xA;                                                              [Avg Page Count] ) ) up&#xD;&#xA;	)&#xD;&#xA;&#xD;&#xA;	SELECT mr.Metric, mr.rptMonth, mr.Value&#xD;&#xA;    FROM    pivoted mr&#xD;&#xA;		JOIN @myMetrics mm ON mm.Metric = mr.Metric&#xD;&#xA;	WHERE mr.Metric = '@Data.Traffic~'&#xD;&#xA;&#xD;&#xA;END&#xD;&#xA;;" ConnectionID="connM1BIG-biLogiReporting" ID="dlMnthlyTrafficDEC">
                        <SqlParameters>
                          <SqlParameter Value="@Request.rptDay~" SqlParamType="dt-7" ID="@ReportDay" />
                        </SqlParameters>
                        <SortFilter SortColumn="rptMonth" DataType="Date" ID="sfMonth" SortSequence="Ascending" />
                      </DataLayer>
                      <FontLabel FontAngle="90" FontSize="8" FontColor="black" BorderColor="Black" />
                      <FontChartTitle FontSize="14" FontColor="Black" />
                      <FontData FontSize="8" FontColor="Black" BorderColor="Black" />
                      <FontYAxisTitle FontColor="Black" />
                      <LabelScale Format="MMM-yy" />
                      <DataScale Format="##0.0" />
                    </Chart>
                  </TooltipPanel>
                </Label>
              </DataTableColumn>
              <DataTableColumn ID="colMTDGoal" Header="MTD Goal" Width="75" WidthScale="px" Class="ThemeAlignRight">
                <Label ID="lblMTDGoal" Caption="@Data.MtdGoal~" />
              </DataTableColumn>
              <DataTableColumn ID="colMTDVariance" Header="MTD Variance" Width="75" WidthScale="px" Class="ThemeAlignRight">
                <Label ID="lblMTDVariance" Caption="@Data.MTDVariance~">
                  <ConditionalClass Class="ThemeTextNegative" Condition="Left(&quot;@Data.MTDVariance~&quot;,1) = &quot;-&quot;" />
                </Label>
              </DataTableColumn>
            </DataTable>
          </Division>
        </Column>
      </Row>
      <Row ID="RowFour">
        <Column ID="colSalesINT" Class="gdColumnCell">
          <Division>
            <DataTable ID="dtSalesINT" CellSpacing="5 px" AltRowClass="gdThemeAltRowNoPadding td" ColumnHeaderClass="gdTableHeader" CaptionClass="gdColumnCellTitle" Width="700">
              <DataLayer Type="Cached" CacheKey="SalesINT,@Request.rptDay~" ID="dlSalesINTDataCache" ExpirationTimeSpan="24:00" ExpirationNow="True">
                <DataLayer Type="SP" ConnectionID="connM1BIG-biLogiReporting" ID="dlSalesINT" Command="dbo.rptEcommLogiDashSalesAllUPDATED_get_sp">
                  <SPParameters>
                    <SPParameter SPParamDirection="Input" ID="@ReportDay" SPParamType="dt-7" SPParamSize="7" Value="@Request.rptDay~" />
                    <SPParameter SPParamDirection="Input" ID="@Format" SPParamSize="50" SPParamType="dt-200" Value="FormatINT" />
                  </SPParameters>
                </DataLayer>
              </DataLayer>
              <Remark>
                <DataLayer Type="Linked" LinkedDataLayerID="dlSalesAllDataLink" ID="dlSalesAllDataLinked1" />
              </Remark>
              <DataTableColumn ID="colSales" Header="Sales" Width="110" WidthScale="px">
                <Label ID="lblSales" Caption="@Data.Sales~">
                  <ConditionalClass Class="gdThemeAlignLeftPadLeft" Condition="&quot;@Data.Sales~&quot; = &quot;Registrations&quot; OR &quot;@Data.Sales~&quot; = &quot;Domains By Proxy&quot; OR &quot;@Data.Sales~&quot; = &quot;SSL&quot; OR &quot;@Data.Sales~&quot; = &quot;Website Builder&quot; OR &quot;@Data.Sales~&quot; = &quot;Hosting&quot; OR &quot;@Data.Sales~&quot; = &quot;Email&quot; OR &quot;@Data.Sales~&quot; = &quot;Add-Ons&quot; OR &quot;@Data.Sales~&quot; = &quot;Other&quot;" />
                </Label>
              </DataTableColumn>
              <DataTableColumn ID="colDaily" Header="Daily" Width="75" WidthScale="px" Class="ThemeAlignRight">
                <Label ID="lblDaily" Caption="@Data.Daily~">
                  <TooltipPanel ID="ttSalesDailyINT">
                    <Chart Type="XY" XYChartType="Line" ChartHeight="200" ChartWidth="200" BackgroundColor="White" ChartTitle="Rolling 7 Days (000s)" ChartLabelColumnDataType="Date" ChartLabelColumn="rptDate" ChartDataColumn="Value">
                      <DataLayer Type="SQL" Source="USE [BiLogiReporting]&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;DECLARE @rptDate AS DATE = '@Request.rptDay~',&#xD;&#xA;	@Format AS VARCHAR(50) = 'FormatINT'&#xD;&#xA;DECLARE @rptMonth DATE = DATEADD(MONTH, DATEDIFF(MONTH, 0, @rptDate), 0) &#xD;&#xA;&#xD;&#xA;        IF @rptDate IS NULL &#xD;&#xA;            BEGIN&#xD;&#xA;                SET @rptDate = DATEADD(DAY, -1, GETDATE());&#xD;&#xA;            END;&#xD;&#xA;        IF @rptDate = DATEADD(dd, 0, DATEDIFF(dd, 0, GETDATE())) &#xD;&#xA;            BEGIN &#xD;&#xA;                SET @rptDate = DATEADD(DAY, -1, @rptDate);&#xD;&#xA;            END;&#xD;&#xA;		&#xD;&#xA;if OBJECT_ID('tempdb.dbo.#myMetricsSlINT') is not null drop table #myMetricsSlINT&#xD;&#xA;CREATE TABLE #myMetricsSlINT (SortOrder INT IDENTITY(1, 1), Metric VARCHAR(100), Product VARCHAR(100), metricFormat varchar(100));&#xD;&#xA;&#xD;&#xA;INSERT  INTO #myMetricsSlINT&#xD;&#xA;VALUES  ( 'New Purchase', 'Total Units', '#,##0' ),&#xD;&#xA;        ( 'New Purchase', 'Registrations', '#,##0' ),&#xD;&#xA;        ( 'New Purchase', 'Domains By Proxy', '#,##0' ),&#xD;&#xA;        ( 'New Purchase', 'Hosting', '#,##0' ),&#xD;&#xA;        ( 'New Purchase', 'Website Builder', '#,##0' ),&#xD;&#xA;        ( 'New Purchase', 'SSL', '#,##0' ),&#xD;&#xA;        ( 'New Purchase', 'Email', '#,##0' ),&#xD;&#xA;        ( 'New Purchase', 'Add-Ons', '#,##0' ),&#xD;&#xA;        ( 'New Purchase', 'Other', '#,##0' ),&#xD;&#xA;        ( 'Renewal', 'Total Units', '#,##0' ),&#xD;&#xA;        ( 'Renewal', 'Registrations', '#,##0' ),&#xD;&#xA;        ( 'Renewal', 'Domains By Proxy', '#,##0' ),&#xD;&#xA;        ( 'Renewal', 'Hosting', '#,##0' ),&#xD;&#xA;        ( 'Renewal', 'Website Builder', '#,##0' ),&#xD;&#xA;        ( 'Renewal', 'SSL', '#,##0' ),&#xD;&#xA;        ( 'Renewal', 'Email', '#,##0' ),&#xD;&#xA;        ( 'Renewal', 'Add-Ons', '#,##0' ),&#xD;&#xA;        ( 'Renewal', 'Other', '#,##0' ),&#xD;&#xA;        ( 'New Purchase', 'AOS', '#,##0.0' ), --AvgProducts&#xD;&#xA;        ( 'Renewal', 'AOS', '$#,##0.00' ), --AOS&#xD;&#xA;        ( 'GCR_New', 'Total Units', '$#,##0' ),&#xD;&#xA;        ( 'GCR_Renew', 'Total Units', '$#,##0' );&#xD;&#xA;&#xD;&#xA;if OBJECT_ID('tempdb.dbo.#myDataSlINT') is not null drop table #myDataSlINT&#xD;&#xA;CREATE TABLE #myDataSlINT (reportDay date, new_renewal nvarchar(50), product nvarchar(255), divisor int, units int, GCR int);&#xD;&#xA;&#xD;&#xA;CREATE nonCLUSTERED INDEX x0 ON #myDataSlINT (reportDay);&#xD;&#xA;CREATE nonCLUSTERED INDEX x1 ON #myDataSlINT (new_renewal);&#xD;&#xA;CREATE nonCLUSTERED INDEX x2 ON #myDataSlINT (product);&#xD;&#xA;CREATE nonCLUSTERED INDEX x3 ON #myDataSlINT (divisor);&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;INSERT INTO #myDataSlINT (reportDay, new_renewal, product, divisor, units, GCR)&#xD;&#xA;SELECT reportDay, new_renewal, product, 1 as Divisor&#xD;&#xA;	, SUM(units) as units&#xD;&#xA;	, SUM(GCR) as GCR&#xD;&#xA;FROM     [dbo].[rptEcommLogiDashSalesUnitMart] b WITH ( NOLOCK )&#xD;&#xA;WHERE b.reportDay &gt;= DATEADD(DAY,-98,@rptDate)  AND b.reportDay &lt; @rptDate&#xD;&#xA;GROUP BY reportDay, new_renewal, product;&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;if OBJECT_ID('tempdb.dbo.#myDataAOSINT') is not null drop table #myDataAOSINT&#xD;&#xA;CREATE TABLE #myDataAOSINT (reportDay date, divisor int, Orders int, GCR int, Units int);&#xD;&#xA;&#xD;&#xA;CREATE nonCLUSTERED INDEX x0 ON #myDataAOSINT (reportDay);&#xD;&#xA;&#xD;&#xA;INSERT INTO #myDataAOSINT (reportDay, divisor, orders, GCR, Units)&#xD;&#xA;SELECT reportDay, 1 as Divisor&#xD;&#xA;	, SUM(orders) as orders&#xD;&#xA;	, SUM(GCR) as GCR&#xD;&#xA;	, SUM(Units) as Units&#xD;&#xA;FROM     [dbo].[rptEcommLogiDashSalesAOSMart] b WITH ( NOLOCK )&#xD;&#xA;WHERE b.reportDay &gt;= DATEADD(DAY,-98,@rptDate)  AND b.reportDay &lt; @rptDate&#xD;&#xA;GROUP BY reportDay;&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;IF  @Format = 'FormatINT' &#xD;&#xA;	BEGIN&#xD;&#xA;&#xD;&#xA;With mytable AS (&#xD;&#xA;				SELECT   b.reportDay AS rptDate ,&#xD;&#xA;                                'Total Units' AS product ,&#xD;&#xA;                                SUM(CASE WHEN b.new_renewal = 'new purchase'&#xD;&#xA;                                         THEN b7.units&#xD;&#xA;                                    END) / MAX(b.Divisor) AS 'New Purchase' ,&#xD;&#xA;                                SUM(CASE WHEN b.new_renewal = 'renewal'&#xD;&#xA;                                         THEN b7.units&#xD;&#xA;                                    END) / MAX(b.Divisor) AS 'Renewal'&#xD;&#xA;                       FROM     #myDataSlINT b &#xD;&#xA;							JOIN #myDataSlINT b7 ON b7.reportDay &gt; dateadd(day, -7, b.reportDay) and b7.reportDay &lt;= b.reportDay&#xD;&#xA;								AND b.New_Renewal = b7.New_Renewal AND b.Product = b7.Product AND b.Divisor = b7.Divisor&#xD;&#xA;					   WHERE b.reportDay &gt;= DATEADD(DAY,-91,@rptDate)&#xD;&#xA;                       GROUP BY b.reportDay&#xD;&#xA;                       UNION ALL&#xD;&#xA;                       SELECT   b.reportDay AS rptDate ,&#xD;&#xA;                                b.product ,&#xD;&#xA;                                SUM(CASE WHEN b.new_renewal = 'new purchase'&#xD;&#xA;                                         THEN b7.units&#xD;&#xA;                                    END) / MAX(b.Divisor) AS 'New Purchase' ,&#xD;&#xA;                                SUM(CASE WHEN b.new_renewal = 'renewal'&#xD;&#xA;                                         THEN b7.units&#xD;&#xA;                                    END) / MAX(b.Divisor) AS 'Renewal' &#xD;&#xA;                       FROM     #myDataSlINT b &#xD;&#xA;							JOIN #myDataSlINT b7 ON b7.reportDay &gt; dateadd(day, -7, b.reportDay) and b7.reportDay &lt;= b.reportDay&#xD;&#xA;								AND b.New_Renewal = b7.New_Renewal AND b.Product = b7.Product AND b.Divisor = b7.Divisor&#xD;&#xA;					   WHERE b.reportDay &gt;= DATEADD(DAY,-91,@rptDate) &#xD;&#xA;                       GROUP BY b.reportDay ,&#xD;&#xA;                                b.product&#xD;&#xA; &#xD;&#xA;),&#xD;&#xA;pivoted AS&#xD;&#xA;	( SELECT   *&#xD;&#xA;				FROM     mytable UNPIVOT ( value FOR Metric IN ( [New Purchase],&#xD;&#xA;                                                              Renewal ) ) up&#xD;&#xA;	)&#xD;&#xA;&#xD;&#xA;	SELECT CASE WHEN mr.Metric = 'New Purchase'&#xD;&#xA;                          AND mr.Product = 'Total Units'&#xD;&#xA;                     THEN 'Total Units [New]'&#xD;&#xA;                     WHEN mr.Metric = 'Renewal'&#xD;&#xA;                          AND mr.Product = 'Total Units'&#xD;&#xA;                     THEN 'Total Units [Renew]'&#xD;&#xA;                     ELSE mr.Product END AS Sales&#xD;&#xA;		, mr.rptDate, mr.Value * .001 as Value&#xD;&#xA;    FROM pivoted mr&#xD;&#xA;		JOIN #myMetricsSlINT mm ON mm.Metric = mr.Metric AND mm.Product = mr.Product&#xD;&#xA;	WHERE CASE WHEN mr.Metric = 'New Purchase'&#xD;&#xA;                          AND mr.Product = 'Total Units'&#xD;&#xA;                     THEN 'Total Units [New]'&#xD;&#xA;                     WHEN mr.Metric = 'Renewal'&#xD;&#xA;                          AND mr.Product = 'Total Units'&#xD;&#xA;                     THEN 'Total Units [Renew]'&#xD;&#xA;                     ELSE mr.Product END = '@Data.Sales~' AND mr.Metric = '@Data.Metric~' &#xD;&#xA;&#xD;&#xA;END&#xD;&#xA;&#xD;&#xA;IF  @Format = 'FormatMON' &#xD;&#xA;	BEGIN&#xD;&#xA;&#xD;&#xA;With mytable AS (&#xD;&#xA;				SELECT    b.reportDay AS rptDate ,&#xD;&#xA;                                'Total Units' AS product ,&#xD;&#xA;                                CAST('' AS FLOAT) AS 'New Purchase' ,&#xD;&#xA;                                CAST('' AS FLOAT) AS 'Renewal' ,&#xD;&#xA;                                CAST(SUM(CASE WHEN b.new_renewal = 'new purchase'&#xD;&#xA;                                         THEN b7.GCR * .00001 END) AS DECIMAL (18,4)) / MAX(b.Divisor) AS 'GCR_New' , -- thousands&#xD;&#xA;                                CAST(SUM(CASE WHEN b.new_renewal = 'renewal'&#xD;&#xA;                                         THEN b7.GCR * .00001 END) AS DECIMAL (18,4)) / MAX(b.Divisor) AS 'GCR_Renew' -- thousands&#xD;&#xA;                       FROM     #myDataSlINT b &#xD;&#xA;							JOIN #myDataSlINT b7 ON b7.reportDay &gt; dateadd(day, -7, b.reportDay) and b7.reportDay &lt;= b.reportDay&#xD;&#xA;								AND b.New_Renewal = b7.New_Renewal AND b.Product = b7.Product AND b.Divisor = b7.Divisor&#xD;&#xA;					   WHERE b.reportDay &gt;= DATEADD(DAY,-91,@rptDate) &#xD;&#xA;                       GROUP BY b.reportDay&#xD;&#xA;                       UNION ALL&#xD;&#xA;                       SELECT   b.reportDay AS rptDate ,&#xD;&#xA;                                'AOS' AS product ,&#xD;&#xA;                                CAST(SUM(b7.Units) AS DECIMAL (18,4)) / SUM(b7.Orders) / COALESCE(1, b.Divisor) AS 'New Purchase' , --AvgProducts&#xD;&#xA;                                CAST(SUM(b7.GCR * .01) AS DECIMAL (18,4)) / SUM(b7.Orders)  / COALESCE(1, b.Divisor) AS 'Renewal' , -- AOS&#xD;&#xA;                                CAST('' AS FLOAT) AS 'GCR_New' ,&#xD;&#xA;                                CAST('' AS FLOAT) AS 'GCR_Renew'&#xD;&#xA;                       FROM    #myDataAOSINT b &#xD;&#xA;							JOIN #myDataAOSINT b7 ON b7.reportDay &gt; dateadd(day, -7, b.reportDay) and b7.reportDay &lt;= b.reportDay&#xD;&#xA;								AND b.Divisor = b7.Divisor&#xD;&#xA;					   WHERE b.reportDay &gt;= DATEADD(DAY,-91,@rptDate) &#xD;&#xA;                       GROUP BY b.reportDay&#xD;&#xA;&#xD;&#xA;),&#xD;&#xA;pivoted AS&#xD;&#xA;	( SELECT   *&#xD;&#xA;				FROM     mytable UNPIVOT ( value FOR Metric IN ( [New Purchase],&#xD;&#xA;                                                              Renewal, GCR_New,&#xD;&#xA;                                                              GCR_Renew ) ) up&#xD;&#xA;	)&#xD;&#xA;&#xD;&#xA;	SELECT CASE      WHEN mr.Metric = 'GCR_New'&#xD;&#xA;                          AND mr.Product = 'Total Units' THEN 'GCR [New]'&#xD;&#xA;                     WHEN mr.Metric = 'GCR_Renew'&#xD;&#xA;                          AND mr.Product = 'Total Units' THEN 'GCR [Renew]'&#xD;&#xA;                     ELSE mr.Product END AS Sales&#xD;&#xA;		, mr.rptDate, mr.Value&#xD;&#xA;    FROM pivoted mr&#xD;&#xA;		JOIN #myMetricsSlINT mm ON mm.Metric = mr.Metric AND mm.Product = mr.Product&#xD;&#xA;	WHERE (mr.Product &lt;&gt; 'Total Units' OR mr.Metric &lt;&gt; 'New Purchase') &#xD;&#xA;		AND (mr.Product &lt;&gt; 'Total Units' OR mr.Metric &lt;&gt; 'Renewal') &#xD;&#xA;		AND (mr.Metric &lt;&gt; 'New Purchase' OR mr.Product &lt;&gt; 'AOS')&#xD;&#xA;	AND CASE WHEN mr.Metric = 'GCR_New'&#xD;&#xA;                          AND mr.Product = 'Total Units' THEN 'GCR [New]'&#xD;&#xA;                     WHEN mr.Metric = 'GCR_Renew'&#xD;&#xA;                          AND mr.Product = 'Total Units' THEN 'GCR [Renew]'&#xD;&#xA;                     ELSE mr.Product END = '@Data.Sales~' AND mr.Metric = '@Data.Metric~' &#xD;&#xA;	ORDER BY mm.SortOrder&#xD;&#xA;&#xD;&#xA;END&#xD;&#xA;;&#xD;&#xA;&#xD;&#xA;DROP TABLE #myMetricsSlINT&#xD;&#xA;DROP TABLE #myDataSlINT&#xD;&#xA;DROP TABLE #myDataAOSINT" ConnectionID="connM1BIG-biLogiReporting" ID="dl7DaySalesINT">
                        <SqlParameters>
                          <SqlParameter Value="@Request.rptDay~" SqlParamType="dt-7" ID="@ReportDay" />
                        </SqlParameters>
                        <SortFilter SortColumn="rptDate" DataType="Date" ID="sfDate" SortSequence="Ascending" />
                      </DataLayer>
                      <FontLabel FontAngle="90" FontSize="8" FontColor="black" BorderColor="Black" />
                      <FontChartTitle FontSize="14" FontColor="Black" />
                      <FontData FontSize="8" FontColor="Black" BorderColor="Black" />
                      <FontYAxisTitle FontColor="Black" />
                      <LabelScale Format="MMM-yy" LinearTickIncrement="Months" ScalingMode="LinearTime" />
                      <DataScale Format="###,###,##0" />
                    </Chart>
                  </TooltipPanel>
                </Label>
              </DataTableColumn>
              <DataTableColumn ID="colDailyGoal" Header="Daily Goal" Width="75" WidthScale="px" Class="ThemeAlignRight">
                <Label ID="lblDailyGoal" Caption="@Data.DailyGoal~" />
              </DataTableColumn>
              <DataTableColumn ID="colDailyVariance" Header="Daily Variance" Width="60" WidthScale="px" Class="ThemeAlignRight">
                <Label ID="lblDailyVariance" Caption="@Data.DailyVariance~">
                  <ConditionalClass Class="ThemeTextNegative" Condition="Left(&quot;@Data.DailyVariance~&quot;,1) = &quot;-&quot;" />
                </Label>
              </DataTableColumn>
              <DataTableColumn ID="colMTD" Header="MTD" Width="75" WidthScale="px" Class="ThemeAlignRight">
                <Label ID="lblMTD" Caption="@Data.Mtd~">
                  <TooltipPanel ID="ttSalesMnthlyINT">
                    <Chart Type="XY" XYChartType="Line" ChartHeight="200" ChartWidth="200" BackgroundColor="White" ChartTitle="6-Month Trend (000s)" ChartLabelColumnDataType="Date" ChartLabelColumn="rptMonth" ChartDataColumn="Value">
                      <DataLayer Type="SQL" Source="USE [BiLogiReporting]&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;DECLARE @rptDay AS DATE = '@Request.rptDay~',&#xD;&#xA;	@Format AS VARCHAR(50) = 'FormatINT'&#xD;&#xA;DECLARE @rptMonth DATE = DATEADD(MONTH, DATEDIFF(MONTH, 0, @rptDay), 0) &#xD;&#xA;&#xD;&#xA;        IF @rptDay IS NULL &#xD;&#xA;            BEGIN&#xD;&#xA;                SET @rptDay = DATEADD(DAY, -1, GETDATE());&#xD;&#xA;            END;&#xD;&#xA;        IF @rptDay = DATEADD(dd, 0, DATEDIFF(dd, 0, GETDATE())) &#xD;&#xA;            BEGIN &#xD;&#xA;                SET @rptDay = DATEADD(DAY, -1, @rptDay);&#xD;&#xA;            END;&#xD;&#xA;		&#xD;&#xA;&#xD;&#xA;DECLARE @myDates TABLE (colName nvarchar(500), startDate DATE, endDate DATE, Divisor FLOAT);&#xD;&#xA;&#xD;&#xA;INSERT  INTO @myDates&#xD;&#xA;SELECT  @rptMonth, DATEADD(month,-6,@rptDay)&#xD;&#xA;		, DATEADD(day,1,@rptDay), 1&#xD;&#xA;OPTION  ( MAXDOP 1 );&#xD;&#xA;&#xD;&#xA;DECLARE @myResults TABLE (Metric VARCHAR(100) PRIMARY KEY, rptMonth DECIMAL(18, 4));&#xD;&#xA;&#xD;&#xA;DECLARE @myMetrics TABLE (SortOrder INT IDENTITY(1, 1), Metric VARCHAR(100), Product VARCHAR(100), metricFormat varchar(100));&#xD;&#xA;&#xD;&#xA;INSERT  INTO @myMetrics&#xD;&#xA;VALUES  ( 'New Purchase', 'Total Units', '#,##0' ),&#xD;&#xA;        ( 'New Purchase', 'Registrations', '#,##0' ),&#xD;&#xA;        ( 'New Purchase', 'Domains By Proxy', '#,##0' ),&#xD;&#xA;        ( 'New Purchase', 'Hosting', '#,##0' ),&#xD;&#xA;        ( 'New Purchase', 'Website Builder', '#,##0' ),&#xD;&#xA;        ( 'New Purchase', 'SSL', '#,##0' ),&#xD;&#xA;        ( 'New Purchase', 'Email', '#,##0' ),&#xD;&#xA;        ( 'New Purchase', 'Add-Ons', '#,##0' ),&#xD;&#xA;        ( 'New Purchase', 'Other', '#,##0' ),&#xD;&#xA;        ( 'Renewal', 'Total Units', '#,##0' ),&#xD;&#xA;        ( 'Renewal', 'Registrations', '#,##0' ),&#xD;&#xA;        ( 'Renewal', 'Domains By Proxy', '#,##0' ),&#xD;&#xA;        ( 'Renewal', 'Hosting', '#,##0' ),&#xD;&#xA;        ( 'Renewal', 'Website Builder', '#,##0' ),&#xD;&#xA;        ( 'Renewal', 'SSL', '#,##0' ),&#xD;&#xA;        ( 'Renewal', 'Email', '#,##0' ),&#xD;&#xA;        ( 'Renewal', 'Add-Ons', '#,##0' ),&#xD;&#xA;        ( 'Renewal', 'Other', '#,##0' ),&#xD;&#xA;        ( 'New Purchase', 'AOS', '#,##0.0' ), --AvgProducts&#xD;&#xA;        ( 'Renewal', 'AOS', '$#,##0.00' ), --AOS&#xD;&#xA;        ( 'GCR_New', 'Total Units', '$#,##0' ),&#xD;&#xA;        ( 'GCR_Renew', 'Total Units', '$#,##0' );&#xD;&#xA;&#xD;&#xA;IF  @Format = 'FormatINT' &#xD;&#xA;	BEGIN&#xD;&#xA;&#xD;&#xA;With mytable AS (&#xD;&#xA;				SELECT   DATEADD(M,-1,DATEADD(D,1,DATEADD(M,(DATEDIFF(m,-1,b.ReportDay)),-1))) AS rptMonth ,&#xD;&#xA;                                'Total Units' AS product ,&#xD;&#xA;                                SUM(CASE WHEN b.new_renewal = 'new purchase'&#xD;&#xA;                                         THEN units&#xD;&#xA;                                    END) / MAX(md.Divisor) AS 'New Purchase' ,&#xD;&#xA;                                SUM(CASE WHEN b.new_renewal = 'renewal'&#xD;&#xA;                                         THEN units&#xD;&#xA;                                    END) / MAX(md.Divisor) AS 'Renewal'&#xD;&#xA;                       FROM     [dbo].[rptEcommLogiDashSalesUnitMart] b WITH ( NOLOCK )&#xD;&#xA;                               JOIN @myDates md ON b.ReportDay &gt;= DATEADD(D,1,DATEADD(M,(DATEDIFF(m,-1,md.startDate)),-1)) AND b.ReportDay &lt; md.endDate&#xD;&#xA;									AND DATEPART(DAY, b.ReportDay) &lt;= DATEPART(DAY, @rptDay) &#xD;&#xA;                       GROUP BY DATEADD(M,-1,DATEADD(D,1,DATEADD(M,(DATEDIFF(m,-1,b.ReportDay)),-1)))&#xD;&#xA;                       UNION ALL&#xD;&#xA;                       SELECT   DATEADD(M,-1,DATEADD(D,1,DATEADD(M,(DATEDIFF(m,-1,b.ReportDay)),-1))) AS rptMonth ,&#xD;&#xA;                                b.product ,&#xD;&#xA;                                SUM(CASE WHEN b.new_renewal = 'new purchase'&#xD;&#xA;                                         THEN units&#xD;&#xA;                                    END) / MAX(md.Divisor) AS 'New Purchase' ,&#xD;&#xA;                                SUM(CASE WHEN b.new_renewal = 'renewal'&#xD;&#xA;                                         THEN units&#xD;&#xA;                                    END) / MAX(md.Divisor) AS 'Renewal' &#xD;&#xA;                       FROM     [dbo].[rptEcommLogiDashSalesUnitMart] b WITH ( NOLOCK )&#xD;&#xA;                                JOIN @myDates md ON b.ReportDay &gt;= DATEADD(D,1,DATEADD(M,(DATEDIFF(m,-1,md.startDate)),-1)) AND b.ReportDay &lt; md.endDate&#xD;&#xA;									AND DATEPART(DAY, b.ReportDay) &lt;= DATEPART(DAY, @rptDay) &#xD;&#xA;                       GROUP BY DATEADD(M,-1,DATEADD(D,1,DATEADD(M,(DATEDIFF(m,-1,b.ReportDay)),-1))) ,&#xD;&#xA;                                b.product&#xD;&#xA; &#xD;&#xA;),&#xD;&#xA;pivoted AS&#xD;&#xA;	( SELECT   *&#xD;&#xA;				FROM     mytable UNPIVOT ( value FOR Metric IN ( [New Purchase],&#xD;&#xA;                                                              Renewal ) ) up&#xD;&#xA;	)&#xD;&#xA;&#xD;&#xA;	SELECT CASE WHEN mr.Metric = 'New Purchase'&#xD;&#xA;                          AND mr.Product = 'Total Units'&#xD;&#xA;                     THEN 'Total Units [New]'&#xD;&#xA;                     WHEN mr.Metric = 'Renewal'&#xD;&#xA;                          AND mr.Product = 'Total Units'&#xD;&#xA;                     THEN 'Total Units [Renew]'&#xD;&#xA;                     ELSE mr.Product END AS Sales&#xD;&#xA;		, mr.rptMonth, mr.Value  * .001 as Value&#xD;&#xA;    FROM pivoted mr&#xD;&#xA;		JOIN @myMetrics mm ON mm.Metric = mr.Metric AND mm.Product = mr.Product&#xD;&#xA;	WHERE CASE WHEN mr.Metric = 'New Purchase'&#xD;&#xA;                          AND mr.Product = 'Total Units'&#xD;&#xA;                     THEN 'Total Units [New]'&#xD;&#xA;                     WHEN mr.Metric = 'Renewal'&#xD;&#xA;                          AND mr.Product = 'Total Units'&#xD;&#xA;                     THEN 'Total Units [Renew]'&#xD;&#xA;                     ELSE mr.Product END = '@Data.Sales~' AND mr.Metric = '@Data.Metric~' &#xD;&#xA;	ORDER BY mm.SortOrder&#xD;&#xA;&#xD;&#xA;END&#xD;&#xA;&#xD;&#xA;IF  @Format = 'FormatMON' &#xD;&#xA;	BEGIN&#xD;&#xA;&#xD;&#xA;With mytable AS (&#xD;&#xA;				SELECT   DATEADD(M,-1,DATEADD(D,1,DATEADD(M,(DATEDIFF(m,-1,b.ReportDay)),-1))) AS rptMonth ,&#xD;&#xA;                                'Total Units' AS product ,&#xD;&#xA;                                '' AS 'New Purchase' ,&#xD;&#xA;                                '' AS 'Renewal' ,&#xD;&#xA;                                (SUM(CASE WHEN b.new_renewal = 'new purchase'&#xD;&#xA;                                         THEN GCR * .0001&#xD;&#xA;                                    END) / MAX(md.Divisor)) AS 'GCR_New' ,&#xD;&#xA;                                (SUM(CASE WHEN b.new_renewal = 'renewal'&#xD;&#xA;                                         THEN GCR * .0001&#xD;&#xA;                                    END) / MAX(md.Divisor)) AS 'GCR_Renew'&#xD;&#xA;                       FROM     [dbo].[rptEcommLogiDashSalesUnitMart] b WITH ( NOLOCK )&#xD;&#xA;                               JOIN @myDates md ON b.ReportDay &gt;= DATEADD(D,1,DATEADD(M,(DATEDIFF(m,-1,md.startDate)),-1)) AND b.ReportDay &lt; md.endDate&#xD;&#xA;									AND DATEPART(DAY, b.ReportDay) &lt;= DATEPART(DAY, @rptDay) &#xD;&#xA;                       GROUP BY DATEADD(M,-1,DATEADD(D,1,DATEADD(M,(DATEDIFF(m,-1,b.ReportDay)),-1)))&#xD;&#xA;                       UNION ALL&#xD;&#xA;                       SELECT   DATEADD(M,-1,DATEADD(D,1,DATEADD(M,(DATEDIFF(m,-1,b.ReportDay)),-1))) AS rptMonth ,&#xD;&#xA;                                'AOS' AS product ,&#xD;&#xA;                                CAST(SUM(Units) AS DECIMAL(18, 4))&#xD;&#xA;                                / SUM(Orders) / COALESCE(1, md.Divisor) AS 'New Purchase' , --AvgProducts&#xD;&#xA;                                CAST(SUM(GCR) AS DECIMAL(18, 4)) / SUM(Orders)&#xD;&#xA;                                / COALESCE(1, md.Divisor) AS 'Renewal' , -- AOS&#xD;&#xA;                                '' AS 'GCR_New' ,&#xD;&#xA;                                '' AS 'GCR_Renew'&#xD;&#xA;                       FROM    [dbo].[rptEcommLogiDashSalesAOSMart] b WITH ( NOLOCK )&#xD;&#xA;                                JOIN @myDates md ON b.ReportDay &gt;= DATEADD(D,1,DATEADD(M,(DATEDIFF(m,-1,md.startDate)),-1)) AND b.ReportDay &lt; md.endDate&#xD;&#xA;									AND DATEPART(DAY, b.ReportDay) &lt;= DATEPART(DAY, @rptDay) &#xD;&#xA;                       GROUP BY DATEADD(M,-1,DATEADD(D,1,DATEADD(M,(DATEDIFF(m,-1,b.ReportDay)),-1))) &#xD;&#xA;&#xD;&#xA;),&#xD;&#xA;pivoted AS&#xD;&#xA;	( SELECT   *&#xD;&#xA;				FROM     mytable UNPIVOT ( value FOR Metric IN ( [New Purchase],&#xD;&#xA;                                                              Renewal, GCR_New,&#xD;&#xA;                                                              GCR_Renew ) ) up&#xD;&#xA;	)&#xD;&#xA;&#xD;&#xA;	SELECT CASE      WHEN mr.Metric = 'GCR_New'&#xD;&#xA;                          AND mr.Product = 'Total Units' THEN 'GCR [New]'&#xD;&#xA;                     WHEN mr.Metric = 'GCR_Renew'&#xD;&#xA;                          AND mr.Product = 'Total Units' THEN 'GCR [Renew]'&#xD;&#xA;                     ELSE mr.Product END AS Sales&#xD;&#xA;		, mr.rptMonth, mr.Value&#xD;&#xA;    FROM pivoted mr&#xD;&#xA;		JOIN @myMetrics mm ON mm.Metric = mr.Metric AND mm.Product = mr.Product&#xD;&#xA;	WHERE (mr.Product &lt;&gt; 'Total Units' OR mr.Metric &lt;&gt; 'New Purchase') &#xD;&#xA;		AND (mr.Product &lt;&gt; 'Total Units' OR mr.Metric &lt;&gt; 'Renewal') &#xD;&#xA;		AND (mr.Metric &lt;&gt; 'New Purchase' OR mr.Product &lt;&gt; 'AOS')&#xD;&#xA;	AND CASE WHEN mr.Metric = 'GCR_New'&#xD;&#xA;                          AND mr.Product = 'Total Units' THEN 'GCR [New]'&#xD;&#xA;                     WHEN mr.Metric = 'GCR_Renew'&#xD;&#xA;                          AND mr.Product = 'Total Units' THEN 'GCR [Renew]'&#xD;&#xA;                     ELSE mr.Product END = '@Data.Sales~' AND mr.Metric = '@Data.Metric~' &#xD;&#xA;	ORDER BY mm.SortOrder&#xD;&#xA;&#xD;&#xA;END&#xD;&#xA;;&#xD;&#xA;&#xD;&#xA;" ConnectionID="connM1BIG-biLogiReporting" ID="dlMnthlySalesINT">
                        <SqlParameters>
                          <SqlParameter Value="@Request.rptDay~" SqlParamType="dt-7" ID="@ReportDay" />
                        </SqlParameters>
                        <SortFilter SortColumn="rptMonth" DataType="Date" ID="sfMonth" SortSequence="Ascending" />
                      </DataLayer>
                      <FontLabel FontAngle="90" FontSize="8" FontColor="black" BorderColor="Black" />
                      <FontChartTitle FontSize="14" FontColor="Black" />
                      <FontData FontSize="8" FontColor="Black" BorderColor="Black" />
                      <FontYAxisTitle FontColor="Black" />
                      <LabelScale Format="MMM-yy" />
                      <DataScale Format="###,###,##0" />
                    </Chart>
                  </TooltipPanel>
                </Label>
              </DataTableColumn>
              <DataTableColumn ID="colMTDGoal" Header="MTD Goal" Width="75" WidthScale="px" Class="ThemeAlignRight">
                <Label ID="lblMTDGoal" Caption="@Data.MtdGoal~" />
              </DataTableColumn>
              <DataTableColumn ID="colMTDVariance" Header="MTD Variance" Width="75" WidthScale="px" Class="ThemeAlignRight">
                <Label ID="lblMTDVariance" Caption="@Data.MTDVariance~">
                  <ConditionalClass Class="ThemeTextNegative" Condition="Left(&quot;@Data.MTDVariance~&quot;,1) = &quot;-&quot;" />
                </Label>
              </DataTableColumn>
            </DataTable>
          </Division>
        </Column>
      </Row>
      <Row ID="RowFive">
        <Column ID="colSalesMON" Class="gdColumnCell">
          <Division>
            <DataTable ID="dtSalesMON" CellSpacing="5 px" AltRowClass="gdThemeAltRowNoPadding td" ColumnHeaderClass="gdTableHeader" CaptionClass="gdColumnCellTitle" Width="700">
              <DataLayer Type="Cached" CacheKey="SalesMON,@Request.rptDay~" ID="dlSalesMONDataCache" ExpirationTimeSpan="24:00" ExpirationNow="True">
                <DataLayer Type="SP" ConnectionID="connM1BIG-biLogiReporting" ID="dlSalesMON" Command="dbo.rptEcommLogiDashSalesAllUPDATED_get_sp">
                  <SPParameters>
                    <SPParameter SPParamDirection="Input" ID="@ReportDay" SPParamType="dt-7" SPParamSize="7" Value="@Request.rptDay~" />
                    <SPParameter SPParamDirection="Input" ID="@Format" SPParamSize="50" SPParamType="dt-200" Value="FormatMON" />
                  </SPParameters>
                </DataLayer>
              </DataLayer>
              <Remark>
                <DataLayer Type="Linked" LinkedDataLayerID="dlSalesAllDataLink" ID="dlSalesAllDataLinked1" />
              </Remark>
              <DataTableColumn ID="colSales" Header="Sales" Width="110" WidthScale="px">
                <Label ID="lblSales" Caption="@Data.Sales~">
                  <ConditionalClass Class="gdThemeAlignLeftPadLeft" Condition="&quot;@Data.Sales~&quot; = &quot;Registrations&quot; OR &quot;@Data.Sales~&quot; = &quot;Domains By Proxy&quot; OR &quot;@Data.Sales~&quot; = &quot;SSL&quot; OR &quot;@Data.Sales~&quot; = &quot;Website Builder&quot; OR &quot;@Data.Sales~&quot; = &quot;Hosting&quot; OR &quot;@Data.Sales~&quot; = &quot;Email&quot; OR &quot;@Data.Sales~&quot; = &quot;Add-Ons&quot; OR &quot;@Data.Sales~&quot; = &quot;Other&quot;" />
                </Label>
              </DataTableColumn>
              <DataTableColumn ID="colDaily" Header="Daily" Width="75" WidthScale="px" Class="ThemeAlignRight">
                <Label ID="lblDaily" Caption="@Data.Daily~">
                  <TooltipPanel ID="ttSalesDailyMON">
                    <Chart Type="XY" XYChartType="Line" ChartHeight="200" ChartWidth="200" BackgroundColor="White" ChartTitle="Rolling 7 Days" ChartLabelColumnDataType="Date" ChartLabelColumn="rptDate" ChartDataColumn="Value">
                      <DataLayer Type="SQL" Source="USE [BiLogiReporting]&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;DECLARE @rptDate AS DATE = '@Request.rptDay~',&#xD;&#xA;	@Format AS VARCHAR(50) = 'FormatMON'&#xD;&#xA;DECLARE @rptMonth DATE = DATEADD(MONTH, DATEDIFF(MONTH, 0, @rptDate), 0) &#xD;&#xA;&#xD;&#xA;        IF @rptDate IS NULL &#xD;&#xA;            BEGIN&#xD;&#xA;                SET @rptDate = DATEADD(DAY, -1, GETDATE());&#xD;&#xA;            END;&#xD;&#xA;        IF @rptDate = DATEADD(dd, 0, DATEDIFF(dd, 0, GETDATE())) &#xD;&#xA;            BEGIN &#xD;&#xA;                SET @rptDate = DATEADD(DAY, -1, @rptDate);&#xD;&#xA;            END;&#xD;&#xA;		&#xD;&#xA;if OBJECT_ID('tempdb.dbo.#myMetricsSlMON') is not null drop table #myMetricsSlMON&#xD;&#xA;CREATE TABLE #myMetricsSlMON (SortOrder INT IDENTITY(1, 1), Metric VARCHAR(100), Product VARCHAR(100), metricFormat varchar(100));&#xD;&#xA;&#xD;&#xA;INSERT  INTO #myMetricsSlMON&#xD;&#xA;VALUES  ( 'New Purchase', 'Total Units', '#,##0' ),&#xD;&#xA;        ( 'New Purchase', 'Registrations', '#,##0' ),&#xD;&#xA;        ( 'New Purchase', 'Domains By Proxy', '#,##0' ),&#xD;&#xA;        ( 'New Purchase', 'Hosting', '#,##0' ),&#xD;&#xA;        ( 'New Purchase', 'Website Builder', '#,##0' ),&#xD;&#xA;        ( 'New Purchase', 'SSL', '#,##0' ),&#xD;&#xA;        ( 'New Purchase', 'Email', '#,##0' ),&#xD;&#xA;        ( 'New Purchase', 'Add-Ons', '#,##0' ),&#xD;&#xA;        ( 'New Purchase', 'Other', '#,##0' ),&#xD;&#xA;        ( 'Renewal', 'Total Units', '#,##0' ),&#xD;&#xA;        ( 'Renewal', 'Registrations', '#,##0' ),&#xD;&#xA;        ( 'Renewal', 'Domains By Proxy', '#,##0' ),&#xD;&#xA;        ( 'Renewal', 'Hosting', '#,##0' ),&#xD;&#xA;        ( 'Renewal', 'Website Builder', '#,##0' ),&#xD;&#xA;        ( 'Renewal', 'SSL', '#,##0' ),&#xD;&#xA;        ( 'Renewal', 'Email', '#,##0' ),&#xD;&#xA;        ( 'Renewal', 'Add-Ons', '#,##0' ),&#xD;&#xA;        ( 'Renewal', 'Other', '#,##0' ),&#xD;&#xA;        ( 'New Purchase', 'AOS', '#,##0.0' ), --AvgProducts&#xD;&#xA;        ( 'Renewal', 'AOS', '$#,##0.00' ), --AOS&#xD;&#xA;        ( 'GCR_New', 'Total Units', '$#,##0' ),&#xD;&#xA;        ( 'GCR_Renew', 'Total Units', '$#,##0' );&#xD;&#xA;&#xD;&#xA;if OBJECT_ID('tempdb.dbo.#myDataSlMON') is not null drop table #myDataSlMON&#xD;&#xA;CREATE TABLE #myDataSlMON (reportDay date, new_renewal nvarchar(50), product nvarchar(255), divisor int, units int, GCR int);&#xD;&#xA;&#xD;&#xA;CREATE nonCLUSTERED INDEX x0 ON #myDataSlMON (reportDay);&#xD;&#xA;CREATE nonCLUSTERED INDEX x1 ON #myDataSlMON (new_renewal);&#xD;&#xA;CREATE nonCLUSTERED INDEX x2 ON #myDataSlMON (product);&#xD;&#xA;CREATE nonCLUSTERED INDEX x3 ON #myDataSlMON (divisor);&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;INSERT INTO #myDataSlMON (reportDay, new_renewal, product, divisor, units, GCR)&#xD;&#xA;SELECT reportDay, new_renewal, product, 1 as Divisor&#xD;&#xA;	, SUM(units) as units&#xD;&#xA;	, SUM(GCR) as GCR&#xD;&#xA;FROM     [dbo].[rptEcommLogiDashSalesUnitMart] b WITH ( NOLOCK )&#xD;&#xA;WHERE b.reportDay &gt;= DATEADD(DAY,-98,@rptDate)  AND b.reportDay &lt; @rptDate&#xD;&#xA;GROUP BY reportDay, new_renewal, product;&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;if OBJECT_ID('tempdb.dbo.#myDataAOSMON') is not null drop table #myDataAOSMON&#xD;&#xA;CREATE TABLE #myDataAOSMON (reportDay date, divisor int, Orders int, GCR int, Units int);&#xD;&#xA;&#xD;&#xA;CREATE nonCLUSTERED INDEX x0 ON #myDataAOSMON (reportDay);&#xD;&#xA;&#xD;&#xA;INSERT INTO #myDataAOSMON (reportDay, divisor, orders, GCR, Units)&#xD;&#xA;SELECT reportDay, 1 as Divisor&#xD;&#xA;	, SUM(orders) as orders&#xD;&#xA;	, SUM(GCR) as GCR&#xD;&#xA;	, SUM(Units) as Units&#xD;&#xA;FROM     [dbo].[rptEcommLogiDashSalesAOSMart] b WITH ( NOLOCK )&#xD;&#xA;WHERE b.reportDay &gt;= DATEADD(DAY,-98,@rptDate)  AND b.reportDay &lt; @rptDate&#xD;&#xA;GROUP BY reportDay;&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;IF  @Format = 'FormatINT' &#xD;&#xA;	BEGIN&#xD;&#xA;&#xD;&#xA;With mytable AS (&#xD;&#xA;				SELECT   b.reportDay AS rptDate ,&#xD;&#xA;                                'Total Units' AS product ,&#xD;&#xA;                                SUM(CASE WHEN b.new_renewal = 'new purchase'&#xD;&#xA;                                         THEN b7.units&#xD;&#xA;                                    END) / MAX(b.Divisor) AS 'New Purchase' ,&#xD;&#xA;                                SUM(CASE WHEN b.new_renewal = 'renewal'&#xD;&#xA;                                         THEN b7.units&#xD;&#xA;                                    END) / MAX(b.Divisor) AS 'Renewal'&#xD;&#xA;                       FROM     #myDataSlMON b &#xD;&#xA;							JOIN #myDataSlMON b7 ON b7.reportDay &gt; dateadd(day, -7, b.reportDay) and b7.reportDay &lt;= b.reportDay&#xD;&#xA;								AND b.New_Renewal = b7.New_Renewal AND b.Product = b7.Product AND b.Divisor = b7.Divisor&#xD;&#xA;					   WHERE b.reportDay &gt;= DATEADD(DAY,-91,@rptDate)&#xD;&#xA;                       GROUP BY b.reportDay&#xD;&#xA;                       UNION ALL&#xD;&#xA;                       SELECT   b.reportDay AS rptDate ,&#xD;&#xA;                                b.product ,&#xD;&#xA;                                SUM(CASE WHEN b.new_renewal = 'new purchase'&#xD;&#xA;                                         THEN b7.units&#xD;&#xA;                                    END) / MAX(b.Divisor) AS 'New Purchase' ,&#xD;&#xA;                                SUM(CASE WHEN b.new_renewal = 'renewal'&#xD;&#xA;                                         THEN b7.units&#xD;&#xA;                                    END) / MAX(b.Divisor) AS 'Renewal' &#xD;&#xA;                       FROM     #myDataSlMON b &#xD;&#xA;							JOIN #myDataSlMON b7 ON b7.reportDay &gt; dateadd(day, -7, b.reportDay) and b7.reportDay &lt;= b.reportDay&#xD;&#xA;								AND b.New_Renewal = b7.New_Renewal AND b.Product = b7.Product AND b.Divisor = b7.Divisor&#xD;&#xA;					   WHERE b.reportDay &gt;= DATEADD(DAY,-91,@rptDate) &#xD;&#xA;                       GROUP BY b.reportDay ,&#xD;&#xA;                                b.product&#xD;&#xA; &#xD;&#xA;),&#xD;&#xA;pivoted AS&#xD;&#xA;	( SELECT   *&#xD;&#xA;				FROM     mytable UNPIVOT ( value FOR Metric IN ( [New Purchase],&#xD;&#xA;                                                              Renewal ) ) up&#xD;&#xA;	)&#xD;&#xA;&#xD;&#xA;	SELECT CASE WHEN mr.Metric = 'New Purchase'&#xD;&#xA;                          AND mr.Product = 'Total Units'&#xD;&#xA;                     THEN 'Total Units [New]'&#xD;&#xA;                     WHEN mr.Metric = 'Renewal'&#xD;&#xA;                          AND mr.Product = 'Total Units'&#xD;&#xA;                     THEN 'Total Units [Renew]'&#xD;&#xA;                     ELSE mr.Product END AS Sales&#xD;&#xA;		, mr.rptDate, mr.Value * .001&#xD;&#xA;    FROM pivoted mr&#xD;&#xA;		JOIN #myMetricsSlMON mm ON mm.Metric = mr.Metric AND mm.Product = mr.Product&#xD;&#xA;	WHERE CASE WHEN mr.Metric = 'New Purchase'&#xD;&#xA;                          AND mr.Product = 'Total Units'&#xD;&#xA;                     THEN 'Total Units [New]'&#xD;&#xA;                     WHEN mr.Metric = 'Renewal'&#xD;&#xA;                          AND mr.Product = 'Total Units'&#xD;&#xA;                     THEN 'Total Units [Renew]'&#xD;&#xA;                     ELSE mr.Product END = '@Data.Sales~' AND mr.Metric = '@Data.Metric~' &#xD;&#xA;&#xD;&#xA;END&#xD;&#xA;&#xD;&#xA;IF  @Format = 'FormatMON' &#xD;&#xA;	BEGIN&#xD;&#xA;&#xD;&#xA;With mytable AS (&#xD;&#xA;				SELECT    b.reportDay AS rptDate ,&#xD;&#xA;                                'Total Units' AS product ,&#xD;&#xA;                                CAST('' AS FLOAT) AS 'New Purchase' ,&#xD;&#xA;                                CAST('' AS FLOAT) AS 'Renewal' ,&#xD;&#xA;                                CAST(SUM(CASE WHEN b.new_renewal = 'new purchase'&#xD;&#xA;                                         THEN b7.GCR * .00001 END) AS DECIMAL (18,4)) / MAX(b.Divisor) AS 'GCR_New' , -- thousands&#xD;&#xA;                                CAST(SUM(CASE WHEN b.new_renewal = 'renewal'&#xD;&#xA;                                         THEN b7.GCR * .00001 END) AS DECIMAL (18,4)) / MAX(b.Divisor) AS 'GCR_Renew' -- thousands&#xD;&#xA;                       FROM     #myDataSlMON b &#xD;&#xA;							JOIN #myDataSlMON b7 ON b7.reportDay &gt; dateadd(day, -7, b.reportDay) and b7.reportDay &lt;= b.reportDay&#xD;&#xA;								AND b.New_Renewal = b7.New_Renewal AND b.Product = b7.Product AND b.Divisor = b7.Divisor&#xD;&#xA;					   WHERE b.reportDay &gt;= DATEADD(DAY,-91,@rptDate) &#xD;&#xA;                       GROUP BY b.reportDay&#xD;&#xA;                       UNION ALL&#xD;&#xA;                       SELECT   b.reportDay AS rptDate ,&#xD;&#xA;                                'AOS' AS product ,&#xD;&#xA;                                CAST(SUM(b7.Units) AS DECIMAL (18,4)) / SUM(b7.Orders) / COALESCE(1, b.Divisor) AS 'New Purchase' , --AvgProducts&#xD;&#xA;                                CAST(SUM(b7.GCR * .01) AS DECIMAL (18,4)) / SUM(b7.Orders)  / COALESCE(1, b.Divisor) AS 'Renewal' , -- AOS&#xD;&#xA;                                CAST('' AS FLOAT) AS 'GCR_New' ,&#xD;&#xA;                                CAST('' AS FLOAT) AS 'GCR_Renew'&#xD;&#xA;                       FROM    #myDataAOSMON b &#xD;&#xA;							JOIN #myDataAOSMON b7 ON b7.reportDay &gt; dateadd(day, -7, b.reportDay) and b7.reportDay &lt;= b.reportDay&#xD;&#xA;								AND b.Divisor = b7.Divisor&#xD;&#xA;					   WHERE b.reportDay &gt;= DATEADD(DAY,-91,@rptDate) &#xD;&#xA;                       GROUP BY b.reportDay&#xD;&#xA;&#xD;&#xA;),&#xD;&#xA;pivoted AS&#xD;&#xA;	( SELECT   *&#xD;&#xA;				FROM     mytable UNPIVOT ( value FOR Metric IN ( [New Purchase],&#xD;&#xA;                                                              Renewal, GCR_New,&#xD;&#xA;                                                              GCR_Renew ) ) up&#xD;&#xA;	)&#xD;&#xA;&#xD;&#xA;	SELECT CASE      WHEN mr.Metric = 'GCR_New'&#xD;&#xA;                          AND mr.Product = 'Total Units' THEN 'GCR 000s [New]'&#xD;&#xA;                     WHEN mr.Metric = 'GCR_Renew'&#xD;&#xA;                          AND mr.Product = 'Total Units' THEN 'GCR 000s [Renew]'&#xD;&#xA;                     ELSE mr.Product END AS Sales&#xD;&#xA;		, mr.rptDate, mr.Value&#xD;&#xA;    FROM pivoted mr&#xD;&#xA;		JOIN #myMetricsSlMON mm ON mm.Metric = mr.Metric AND mm.Product = mr.Product&#xD;&#xA;	WHERE (mr.Product &lt;&gt; 'Total Units' OR mr.Metric &lt;&gt; 'New Purchase') &#xD;&#xA;		AND (mr.Product &lt;&gt; 'Total Units' OR mr.Metric &lt;&gt; 'Renewal') &#xD;&#xA;		AND (mr.Metric &lt;&gt; 'New Purchase' OR mr.Product &lt;&gt; 'AOS')&#xD;&#xA;	AND CASE WHEN mr.Metric = 'GCR_New'&#xD;&#xA;                          AND mr.Product = 'Total Units' THEN 'GCR 000s [New]'&#xD;&#xA;                     WHEN mr.Metric = 'GCR_Renew'&#xD;&#xA;                          AND mr.Product = 'Total Units' THEN 'GCR 000s [Renew]'&#xD;&#xA;                     ELSE mr.Product END = '@Data.Sales~' AND mr.Metric = '@Data.Metric~' &#xD;&#xA;	ORDER BY mm.SortOrder&#xD;&#xA;&#xD;&#xA;END&#xD;&#xA;;&#xD;&#xA;&#xD;&#xA;DROP TABLE #myMetricsSlMON&#xD;&#xA;DROP TABLE #myDataSlMON&#xD;&#xA;DROP TABLE #myDataAOSMON" ConnectionID="connM1BIG-biLogiReporting" ID="dl7DaySalesMON">
                        <SqlParameters>
                          <SqlParameter Value="@Request.rptDay~" SqlParamType="dt-7" ID="@ReportDay" />
                        </SqlParameters>
                        <SortFilter SortColumn="rptDate" DataType="Date" ID="sfDate" SortSequence="Ascending" />
                      </DataLayer>
                      <FontLabel FontAngle="90" FontSize="8" FontColor="black" BorderColor="Black" />
                      <FontChartTitle FontSize="14" FontColor="Black" />
                      <FontData FontSize="8" FontColor="Black" BorderColor="Black" />
                      <FontYAxisTitle FontColor="Black" />
                      <LabelScale Format="MMM-yy" LinearTickIncrement="Months" ScalingMode="LinearTime" />
                      <DataScale Format="Currency" />
                    </Chart>
                  </TooltipPanel>
                </Label>
              </DataTableColumn>
              <DataTableColumn ID="colDailyGoal" Header="Daily Goal" Width="75" WidthScale="px" Class="ThemeAlignRight">
                <Label ID="lblDailyGoal" Caption="@Data.DailyGoal~" />
              </DataTableColumn>
              <DataTableColumn ID="colDailyVariance" Header="Daily Variance" Width="60" WidthScale="px" Class="ThemeAlignRight">
                <Label ID="lblDailyVariance" Caption="@Data.DailyVariance~">
                  <ConditionalClass Class="ThemeTextNegative" Condition="Left(&quot;@Data.DailyVariance~&quot;,1) = &quot;-&quot;" />
                </Label>
              </DataTableColumn>
              <DataTableColumn ID="colMTD" Header="MTD" Width="75" WidthScale="px" Class="ThemeAlignRight">
                <Label ID="lblMTD" Caption="@Data.Mtd~">
                  <TooltipPanel ID="ttSalesMnthlyMON">
                    <Chart Type="XY" XYChartType="Line" ChartHeight="200" ChartWidth="200" BackgroundColor="White" ChartTitle="6-Month Trend (000s)" ChartLabelColumnDataType="Date" ChartLabelColumn="rptMonth" ChartDataColumn="Value">
                      <DataLayer Type="SQL" Source="USE [BiLogiReporting]&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;DECLARE @rptDay AS DATE = '@Request.rptDay~',&#xD;&#xA;	@Format AS VARCHAR(50) = 'FormatMON'&#xD;&#xA;DECLARE @rptMonth DATE = DATEADD(MONTH, DATEDIFF(MONTH, 0, @rptDay), 0) &#xD;&#xA;&#xD;&#xA;        IF @rptDay IS NULL &#xD;&#xA;            BEGIN&#xD;&#xA;                SET @rptDay = DATEADD(DAY, -1, GETDATE());&#xD;&#xA;            END;&#xD;&#xA;        IF @rptDay = DATEADD(dd, 0, DATEDIFF(dd, 0, GETDATE())) &#xD;&#xA;            BEGIN &#xD;&#xA;                SET @rptDay = DATEADD(DAY, -1, @rptDay);&#xD;&#xA;            END;&#xD;&#xA;		&#xD;&#xA;&#xD;&#xA;DECLARE @myDates TABLE (colName nvarchar(500), startDate DATE, endDate DATE, Divisor FLOAT);&#xD;&#xA;&#xD;&#xA;INSERT  INTO @myDates&#xD;&#xA;SELECT  @rptMonth, DATEADD(month,-6,@rptDay)&#xD;&#xA;		, DATEADD(day,1,@rptDay), 1&#xD;&#xA;OPTION  ( MAXDOP 1 );&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;DECLARE @myResults TABLE (Metric VARCHAR(100) PRIMARY KEY, rptMonth DECIMAL(18, 4));&#xD;&#xA;&#xD;&#xA;DECLARE @myMetrics TABLE (SortOrder INT IDENTITY(1, 1), Metric VARCHAR(100), Product VARCHAR(100), metricFormat varchar(100));&#xD;&#xA;&#xD;&#xA;INSERT  INTO @myMetrics&#xD;&#xA;VALUES  ( 'New Purchase', 'Total Units', '#,##0' ),&#xD;&#xA;        ( 'New Purchase', 'Registrations', '#,##0' ),&#xD;&#xA;        ( 'New Purchase', 'Domains By Proxy', '#,##0' ),&#xD;&#xA;        ( 'New Purchase', 'Hosting', '#,##0' ),&#xD;&#xA;        ( 'New Purchase', 'Website Builder', '#,##0' ),&#xD;&#xA;        ( 'New Purchase', 'SSL', '#,##0' ),&#xD;&#xA;        ( 'New Purchase', 'Email', '#,##0' ),&#xD;&#xA;        ( 'New Purchase', 'Add-Ons', '#,##0' ),&#xD;&#xA;        ( 'New Purchase', 'Other', '#,##0' ),&#xD;&#xA;        ( 'Renewal', 'Total Units', '#,##0' ),&#xD;&#xA;        ( 'Renewal', 'Registrations', '#,##0' ),&#xD;&#xA;        ( 'Renewal', 'Domains By Proxy', '#,##0' ),&#xD;&#xA;        ( 'Renewal', 'Hosting', '#,##0' ),&#xD;&#xA;        ( 'Renewal', 'Website Builder', '#,##0' ),&#xD;&#xA;        ( 'Renewal', 'SSL', '#,##0' ),&#xD;&#xA;        ( 'Renewal', 'Email', '#,##0' ),&#xD;&#xA;        ( 'Renewal', 'Add-Ons', '#,##0' ),&#xD;&#xA;        ( 'Renewal', 'Other', '#,##0' ),&#xD;&#xA;        ( 'New Purchase', 'AOS', '#,##0.0' ), --AvgProducts&#xD;&#xA;        ( 'Renewal', 'AOS', '$#,##0.00' ), --AOS&#xD;&#xA;        ( 'GCR_New', 'Total Units', '$#,##0' ),&#xD;&#xA;        ( 'GCR_Renew', 'Total Units', '$#,##0' );&#xD;&#xA;&#xD;&#xA;IF  @Format = 'FormatINT' &#xD;&#xA;	BEGIN&#xD;&#xA;&#xD;&#xA;With mytable AS (&#xD;&#xA;				SELECT   DATEADD(M,-1,DATEADD(D,1,DATEADD(M,(DATEDIFF(m,-1,b.ReportDay)),-1))) AS rptMonth ,&#xD;&#xA;                                'Total Units' AS product ,&#xD;&#xA;                                SUM(CASE WHEN b.new_renewal = 'new purchase'&#xD;&#xA;                                         THEN units&#xD;&#xA;                                    END) / MAX(md.Divisor) AS 'New Purchase' ,&#xD;&#xA;                                SUM(CASE WHEN b.new_renewal = 'renewal'&#xD;&#xA;                                         THEN units&#xD;&#xA;                                    END) / MAX(md.Divisor) AS 'Renewal'&#xD;&#xA;                       FROM     [dbo].[rptEcommLogiDashSalesUnitMart] b WITH ( NOLOCK )&#xD;&#xA;                               JOIN @myDates md ON b.ReportDay &gt;= DATEADD(D,1,DATEADD(M,(DATEDIFF(m,-1,md.startDate)),-1)) AND b.ReportDay &lt; md.endDate&#xD;&#xA;									AND DATEPART(DAY, b.ReportDay) &lt;= DATEPART(DAY, @rptDay) &#xD;&#xA;                       GROUP BY DATEADD(M,-1,DATEADD(D,1,DATEADD(M,(DATEDIFF(m,-1,b.ReportDay)),-1)))&#xD;&#xA;                       UNION ALL&#xD;&#xA;                       SELECT   DATEADD(M,-1,DATEADD(D,1,DATEADD(M,(DATEDIFF(m,-1,b.ReportDay)),-1))) AS rptMonth ,&#xD;&#xA;                                b.product ,&#xD;&#xA;                                SUM(CASE WHEN b.new_renewal = 'new purchase'&#xD;&#xA;                                         THEN units&#xD;&#xA;                                    END) / MAX(md.Divisor) AS 'New Purchase' ,&#xD;&#xA;                                SUM(CASE WHEN b.new_renewal = 'renewal'&#xD;&#xA;                                         THEN units&#xD;&#xA;                                    END) / MAX(md.Divisor) AS 'Renewal' &#xD;&#xA;                       FROM     [dbo].[rptEcommLogiDashSalesUnitMart] b WITH ( NOLOCK )&#xD;&#xA;                                JOIN @myDates md ON b.ReportDay &gt;= DATEADD(D,1,DATEADD(M,(DATEDIFF(m,-1,md.startDate)),-1)) AND b.ReportDay &lt; md.endDate&#xD;&#xA;									AND DATEPART(DAY, b.ReportDay) &lt;= DATEPART(DAY, @rptDay) &#xD;&#xA;                       GROUP BY DATEADD(M,-1,DATEADD(D,1,DATEADD(M,(DATEDIFF(m,-1,b.ReportDay)),-1))) ,&#xD;&#xA;                                b.product&#xD;&#xA; &#xD;&#xA;),&#xD;&#xA;pivoted AS&#xD;&#xA;	( SELECT   *&#xD;&#xA;				FROM     mytable UNPIVOT ( value FOR Metric IN ( [New Purchase],&#xD;&#xA;                                                              Renewal ) ) up&#xD;&#xA;	)&#xD;&#xA;&#xD;&#xA;	SELECT CASE WHEN mr.Metric = 'New Purchase'&#xD;&#xA;                          AND mr.Product = 'Total Units'&#xD;&#xA;                     THEN 'Total Units [New]'&#xD;&#xA;                     WHEN mr.Metric = 'Renewal'&#xD;&#xA;                          AND mr.Product = 'Total Units'&#xD;&#xA;                     THEN 'Total Units [Renew]'&#xD;&#xA;                     ELSE mr.Product END AS Sales&#xD;&#xA;		, mr.rptMonth, mr.Value  * .001 as Value&#xD;&#xA;    FROM pivoted mr&#xD;&#xA;		JOIN @myMetrics mm ON mm.Metric = mr.Metric AND mm.Product = mr.Product&#xD;&#xA;	WHERE CASE WHEN mr.Metric = 'New Purchase'&#xD;&#xA;                          AND mr.Product = 'Total Units'&#xD;&#xA;                     THEN 'Total Units [New]'&#xD;&#xA;                     WHEN mr.Metric = 'Renewal'&#xD;&#xA;                          AND mr.Product = 'Total Units'&#xD;&#xA;                     THEN 'Total Units [Renew]'&#xD;&#xA;                     ELSE mr.Product END = '@Data.Sales~' AND mr.Metric = '@Data.Metric~' &#xD;&#xA;	ORDER BY mm.SortOrder&#xD;&#xA;&#xD;&#xA;END&#xD;&#xA;&#xD;&#xA;IF  @Format = 'FormatMON' &#xD;&#xA;	BEGIN&#xD;&#xA;&#xD;&#xA;With mytable AS (&#xD;&#xA;				SELECT   DATEADD(M,-1,DATEADD(D,1,DATEADD(M,(DATEDIFF(m,-1,b.ReportDay)),-1))) AS rptMonth ,&#xD;&#xA;                                'Total Units' AS product ,&#xD;&#xA;                                '' AS 'New Purchase' ,&#xD;&#xA;                                '' AS 'Renewal' ,&#xD;&#xA;                                (SUM(CASE WHEN b.new_renewal = 'new purchase'&#xD;&#xA;                                         THEN GCR * .00001 &#xD;&#xA;                                    END) / MAX(md.Divisor)) AS 'GCR_New' ,&#xD;&#xA;                                (SUM(CASE WHEN b.new_renewal = 'renewal'&#xD;&#xA;                                         THEN GCR * .00001 &#xD;&#xA;                                    END) / MAX(md.Divisor)) AS 'GCR_Renew'&#xD;&#xA;                       FROM     [dbo].[rptEcommLogiDashSalesUnitMart] b WITH ( NOLOCK )&#xD;&#xA;                               JOIN @myDates md ON b.ReportDay &gt;= DATEADD(D,1,DATEADD(M,(DATEDIFF(m,-1,md.startDate)),-1)) AND b.ReportDay &lt; md.endDate&#xD;&#xA;									AND DATEPART(DAY, b.ReportDay) &lt;= DATEPART(DAY, @rptDay) &#xD;&#xA;                       GROUP BY DATEADD(M,-1,DATEADD(D,1,DATEADD(M,(DATEDIFF(m,-1,b.ReportDay)),-1)))&#xD;&#xA;                       UNION ALL&#xD;&#xA;                       SELECT   DATEADD(M,-1,DATEADD(D,1,DATEADD(M,(DATEDIFF(m,-1,b.ReportDay)),-1))) AS rptMonth ,&#xD;&#xA;                                'AOS' AS product ,&#xD;&#xA;                                CAST(SUM(Units) AS DECIMAL(18, 4))&#xD;&#xA;                                / SUM(Orders) / COALESCE(1, md.Divisor) AS 'New Purchase' , --AvgProducts&#xD;&#xA;                                CAST(SUM(GCR * .01) AS DECIMAL(18, 4)) / SUM(Orders)&#xD;&#xA;                                / COALESCE(1, md.Divisor) AS 'Renewal' , -- AOS&#xD;&#xA;                                '' AS 'GCR_New' ,&#xD;&#xA;                                '' AS 'GCR_Renew'&#xD;&#xA;                       FROM    [dbo].[rptEcommLogiDashSalesAOSMart] b WITH ( NOLOCK )&#xD;&#xA;                                JOIN @myDates md ON b.ReportDay &gt;= DATEADD(D,1,DATEADD(M,(DATEDIFF(m,-1,md.startDate)),-1)) AND b.ReportDay &lt; md.endDate&#xD;&#xA;									AND DATEPART(DAY, b.ReportDay) &lt;= DATEPART(DAY, @rptDay) &#xD;&#xA;                       GROUP BY DATEADD(M,-1,DATEADD(D,1,DATEADD(M,(DATEDIFF(m,-1,b.ReportDay)),-1))) &#xD;&#xA;&#xD;&#xA;),&#xD;&#xA;pivoted AS&#xD;&#xA;	( SELECT   *&#xD;&#xA;				FROM     mytable UNPIVOT ( value FOR Metric IN ( [New Purchase],&#xD;&#xA;                                                              Renewal, GCR_New,&#xD;&#xA;                                                              GCR_Renew ) ) up&#xD;&#xA;	)&#xD;&#xA;&#xD;&#xA;	SELECT CASE      WHEN mr.Metric = 'GCR_New'&#xD;&#xA;                          AND mr.Product = 'Total Units' THEN 'GCR 000s [New]'&#xD;&#xA;                     WHEN mr.Metric = 'GCR_Renew'&#xD;&#xA;                          AND mr.Product = 'Total Units' THEN 'GCR 000s [Renew]'&#xD;&#xA;                     ELSE mr.Product END AS Sales&#xD;&#xA;		, mr.rptMonth, mr.Value&#xD;&#xA;    FROM pivoted mr&#xD;&#xA;		JOIN @myMetrics mm ON mm.Metric = mr.Metric AND mm.Product = mr.Product&#xD;&#xA;	WHERE (mr.Product &lt;&gt; 'Total Units' OR mr.Metric &lt;&gt; 'New Purchase') &#xD;&#xA;		AND (mr.Product &lt;&gt; 'Total Units' OR mr.Metric &lt;&gt; 'Renewal') &#xD;&#xA;		AND (mr.Metric &lt;&gt; 'New Purchase' OR mr.Product &lt;&gt; 'AOS')&#xD;&#xA;	AND CASE WHEN mr.Metric = 'GCR_New'&#xD;&#xA;                          AND mr.Product = 'Total Units' THEN 'GCR 000s [New]'&#xD;&#xA;                     WHEN mr.Metric = 'GCR_Renew'&#xD;&#xA;                          AND mr.Product = 'Total Units' THEN 'GCR 000s [Renew]'&#xD;&#xA;                     ELSE mr.Product END = '@Data.Sales~' AND mr.Metric = '@Data.Metric~' &#xD;&#xA;&#xD;&#xA;END&#xD;&#xA;;&#xD;&#xA;&#xD;&#xA;" ConnectionID="connM1BIG-biLogiReporting" ID="dlMnthlySalesMON">
                        <SqlParameters>
                          <SqlParameter Value="@Request.rptDay~" SqlParamType="dt-7" ID="@ReportDay" />
                        </SqlParameters>
                        <SortFilter SortColumn="rptMonth" DataType="Date" ID="sfMonth" SortSequence="Ascending" />
                      </DataLayer>
                      <FontLabel FontAngle="90" FontSize="8" FontColor="black" BorderColor="Black" />
                      <FontChartTitle FontSize="14" FontColor="Black" />
                      <FontData FontSize="8" FontColor="Black" BorderColor="Black" />
                      <FontYAxisTitle FontColor="Black" />
                      <LabelScale Format="MMM-yy" />
                      <DataScale Format="Currency" />
                    </Chart>
                  </TooltipPanel>
                </Label>
              </DataTableColumn>
              <DataTableColumn ID="colMTDGoal" Header="MTD Goal" Width="75" WidthScale="px" Class="ThemeAlignRight">
                <Label ID="lblMTDGoal" Caption="@Data.MtdGoal~" />
              </DataTableColumn>
              <DataTableColumn ID="colMTDVariance" Header="MTD Variance" Width="75" WidthScale="px" Class="ThemeAlignRight">
                <Label ID="lblMTDVariance" Caption="@Data.MTDVariance~">
                  <ConditionalClass Class="ThemeTextNegative" Condition="Left(&quot;@Data.MTDVariance~&quot;,1) = &quot;-&quot;" />
                </Label>
              </DataTableColumn>
            </DataTable>
          </Division>
        </Column>
      </Row>
      <Row ID="RowSix">
        <Column ID="colCountryAll" Class="gdColumnCell">
          <Division>
            <DataTable ID="dtCountryAll" CellSpacing="5 px" AltRowClass="gdThemeAltRowNoPadding td" ColumnHeaderClass="gdTableHeader" CaptionClass="gdColumnCellTitle" Width="700">
              <DataLayer Type="Linked" LinkedDataLayerID="dlCountryAllDataLink" ID="dlCountryAllDataLinked1" />
              <DataTableColumn ID="colCountry" Header="Country" Width="110" WidthScale="px">
                <Label ID="lblCountry" Caption="@Data.Country~">
                  <ConditionalClass Class="gdThemeAlignLeftPadLeft" Condition="&quot;@Data.Country~&quot; &lt;&gt; &quot;% of Total Visits&quot; AND &quot;@Data.Country~&quot; &lt;&gt; &quot;Conversion Rate&quot; " />
                </Label>
              </DataTableColumn>
              <DataTableColumn ID="colDaily" Header="Daily" Width="75" WidthScale="px" Class="ThemeAlignRight">
                <Label ID="lblDaily" Caption="@Data.Daily~">
                  <TooltipPanel ID="ttCountryDaily">
                    <Chart Type="XY" XYChartType="Line" ChartHeight="200" ChartWidth="200" BackgroundColor="White" ChartTitle="Rolling 7 Days" ChartLabelColumnDataType="Date" ChartLabelColumn="rptDate" ChartDataColumn="Value">
                      <DataLayer Type="SQL" Source="USE [BiLogiReporting]&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;DECLARE @rptDate AS DATE = '@Request.rptDay~'&#xD;&#xA;&#xD;&#xA;        IF @rptDate IS NULL &#xD;&#xA;            BEGIN&#xD;&#xA;                SET @rptDate = DATEADD(DAY, -1, GETDATE());&#xD;&#xA;            END;&#xD;&#xA;        IF @rptDate = DATEADD(dd, 0, DATEDIFF(dd, 0, GETDATE())) &#xD;&#xA;            BEGIN &#xD;&#xA;                SET @rptDate = DATEADD(DAY, -1, @rptDate);&#xD;&#xA;            END;&#xD;&#xA;		&#xD;&#xA;&#xD;&#xA;if OBJECT_ID('tempdb.dbo.#allVisits') is not null drop table #allVisits&#xD;&#xA;CREATE TABLE #allVisits (visitDate DATE, allVisits INT);&#xD;&#xA;&#xD;&#xA;INSERT INTO #allVisits (visitDate, allVisits)&#xD;&#xA;SELECT b.visitDate&#xD;&#xA;	, SUM(b.Visits) AS allVisits&#xD;&#xA;FROM [dbo].[rptEcommLogiDashTrafficMart] b WITH ( NOLOCK )&#xD;&#xA;GROUP BY b.visitDate&#xD;&#xA;OPTION  ( MAXDOP 1 );&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;if OBJECT_ID('tempdb.dbo.#myDataCountry') is not null drop table #myDataCountry&#xD;&#xA;CREATE TABLE #myDataCountry (visitDate date, country nvarchar(128), [% of Total Visits] DECIMAL(18, 4), [Conversion Rate] DECIMAL(18, 4));&#xD;&#xA;&#xD;&#xA;CREATE nonCLUSTERED INDEX x0 ON #myDataCountry (visitDate);&#xD;&#xA;CREATE nonCLUSTERED INDEX x1 ON #myDataCountry (country);&#xD;&#xA;&#xD;&#xA;INSERT INTO #myDataCountry (visitDate, country, [% of Total Visits], [Conversion Rate])&#xD;&#xA;SELECT b.visitDate, b.country&#xD;&#xA;	, CAST(SUM(b.visits) AS DECIMAL(18, 4)) / MAX(av.AllVisits) AS '% of Total Visits'&#xD;&#xA;	, CAST(SUM(b.orderingvisits) AS DECIMAL(18, 4)) / SUM(b.visits)AS 'Conversion Rate'&#xD;&#xA;FROM     [dbo].[rptEcommLogiDashTrafficMart] b WITH ( NOLOCK )&#xD;&#xA;	JOIN #allVisits av ON av.visitDate = b.visitDate&#xD;&#xA;WHERE b.visitDate &gt;= DATEADD(DAY,-98,@rptDate)  AND b.visitDate &lt;= @rptDate&#xD;&#xA;GROUP BY b.visitDate, b.country;&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;if OBJECT_ID('tempdb.dbo.#myMetricsCountry') is not null drop table #myMetrics&#xD;&#xA;CREATE TABLE #myMetricsCountry (SortOrder INT IDENTITY(1, 1), Country VARCHAR(100), Metric VARCHAR(100), metricFormat varchar(100));&#xD;&#xA;&#xD;&#xA;INSERT  INTO #myMetricsCountry&#xD;&#xA;VALUES  ( '% of Total Visits', '% of Total Visits', '0.0%' ),&#xD;&#xA;        ( 'United States', '% of Total Visits', '0.0%' ),&#xD;&#xA;        ( 'Australia', '% of Total Visits', '0.0%' ),&#xD;&#xA;        ( 'Brazil', '% of Total Visits', '0.0%' ),&#xD;&#xA;        ( 'Canada', '% of Total Visits', '0.0%' ),&#xD;&#xA;        ( 'China', '% of Total Visits', '0.0%' ),&#xD;&#xA;        ( 'India', '% of Total Visits', '0.0%' ),&#xD;&#xA;        ( 'RoW', '% of Total Visits', '0.0%' ),&#xD;&#xA;        ( 'Spanish', '% of Total Visits', '0.0%' ),&#xD;&#xA;        ( 'United Kingdom', '% of Total Visits', '0.0%' ),&#xD;&#xA;        ( 'Conversion Rate', 'Conversion Rate', '0.0%' ),&#xD;&#xA;        ( 'United States', 'Conversion Rate', '0.0%' ),&#xD;&#xA;        ( 'Australia', 'Conversion Rate', '0.0%' ),&#xD;&#xA;        ( 'Brazil', 'Conversion Rate', '0.0%' ),&#xD;&#xA;        ( 'Canada', 'Conversion Rate', '0.0%' ),&#xD;&#xA;        ( 'China', 'Conversion Rate', '0.0%' ),&#xD;&#xA;        ( 'India', 'Conversion Rate', '0.0%' ),&#xD;&#xA;        ( 'RoW', 'Conversion Rate', '0.0%' ),&#xD;&#xA;        ( 'Spanish', 'Conversion Rate', '0.0%' ),&#xD;&#xA;        ( 'United Kingdom', 'Conversion Rate', '0.0%' );&#xD;&#xA;&#xD;&#xA;With mytable AS (&#xD;&#xA;				SELECT   b.visitDate AS rptDate ,&#xD;&#xA;                                b.country ,&#xD;&#xA;                                AVG(b7.[% of Total Visits]) AS '% of Total Visits',&#xD;&#xA;                                AVG(b7.[Conversion Rate]) AS 'Conversion Rate'&#xD;&#xA;                       FROM		#myDataCountry b&#xD;&#xA;								JOIN #myDataCountry b7 ON b7.visitDate &gt; dateadd(day, -7, b.visitDate) and b7.visitDate &lt;= b.visitDate&#xD;&#xA;									AND b7.country = b.country&#xD;&#xA;					   WHERE b.visitDate &gt;= DATEADD(DAY,-91,@rptDate)&#xD;&#xA;                       GROUP BY b.visitDate ,&#xD;&#xA;                                b.country&#xD;&#xA;&#xD;&#xA;),&#xD;&#xA;pivoted AS&#xD;&#xA;	( SELECT   *&#xD;&#xA;				FROM     mytable UNPIVOT ( value FOR Metric IN ( [% of Total Visits],&#xD;&#xA;                                                              [Conversion Rate] ) ) up&#xD;&#xA;	)&#xD;&#xA;	SELECT mr.Country, mr.metric, mr.rptDate, mr.Value&#xD;&#xA;    FROM pivoted mr&#xD;&#xA;		JOIN #myMetricsCountry mm ON mm.Metric = mr.Metric AND mm.Country = mr.Country&#xD;&#xA;	WHERE mr.Country = '@Data.Country~' AND mr.Metric = '@Data.Metric~' &#xD;&#xA;	ORDER BY mm.SortOrder&#xD;&#xA;;&#xD;&#xA;&#xD;&#xA;DROP TABLE #myDataCountry&#xD;&#xA;DROP TABLE #allVisits &#xD;&#xA;DROP TABLE #myMetricsCountry" ConnectionID="connM1BIG-biLogiReporting" ID="dl7DayCountry">
                        <SqlParameters>
                          <SqlParameter Value="@Request.rptDay~" SqlParamType="dt-7" ID="@ReportDay" />
                        </SqlParameters>
                        <SortFilter SortColumn="rptDate" DataType="Date" ID="sfDate" SortSequence="Ascending" />
                      </DataLayer>
                      <FontLabel FontAngle="90" FontSize="8" FontColor="black" BorderColor="Black" />
                      <FontChartTitle FontSize="14" FontColor="Black" />
                      <FontData FontSize="8" FontColor="Black" BorderColor="Black" />
                      <FontYAxisTitle FontColor="Black" />
                      <LabelScale Format="MMM-yy" LinearTickIncrement="Months" ScalingMode="LinearTime" />
                      <DataScale Format="##0.0%" />
                    </Chart>
                  </TooltipPanel>
                </Label>
              </DataTableColumn>
              <DataTableColumn ID="colDailyGoal" Header="Daily Goal" Width="75" WidthScale="px" Class="ThemeAlignRight">
                <Label ID="lblDailyGoal" Caption="@Data.DailyGoal~" />
              </DataTableColumn>
              <DataTableColumn ID="colDailyVariance" Header="Daily Variance" Width="60" WidthScale="px" Class="ThemeAlignRight">
                <Label ID="lblDailyVariance" Caption="@Data.DailyVariance~">
                  <ConditionalClass Class="ThemeTextNegative" Condition="Left(&quot;@Data.DailyVariance~&quot;,1) = &quot;-&quot;" />
                </Label>
              </DataTableColumn>
              <DataTableColumn ID="colMTD" Header="MTD" Width="75" WidthScale="px" Class="ThemeAlignRight">
                <Label ID="lblMTD" Caption="@Data.Mtd~">
                  <TooltipPanel ID="ttCountryMnthly">
                    <Chart Type="XY" XYChartType="Line" ChartHeight="200" ChartWidth="200" BackgroundColor="White" ChartTitle="6-Month Trend" ChartLabelColumnDataType="Date" ChartLabelColumn="rptMonth" ChartDataColumn="Value">
                      <DataLayer Type="SQL" Source="USE [BiLogiReporting]&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;DECLARE @rptDay AS DATE = '@Request.rptDay~'&#xD;&#xA;DECLARE @rptMonth DATE = DATEADD(MONTH, DATEDIFF(MONTH, 0, @rptDay), 0) &#xD;&#xA;&#xD;&#xA;        IF @rptDay IS NULL &#xD;&#xA;            BEGIN&#xD;&#xA;                SET @rptDay = DATEADD(DAY, -1, GETDATE());&#xD;&#xA;            END;&#xD;&#xA;        IF @rptDay = DATEADD(dd, 0, DATEDIFF(dd, 0, GETDATE())) &#xD;&#xA;            BEGIN &#xD;&#xA;                SET @rptDay = DATEADD(DAY, -1, @rptDay);&#xD;&#xA;            END;&#xD;&#xA;		&#xD;&#xA;&#xD;&#xA;DECLARE @myDates TABLE (colName nvarchar(500), startDate DATE, endDate DATE, Divisor FLOAT);&#xD;&#xA;&#xD;&#xA;INSERT  INTO @myDates (colName, startDate, endDate, Divisor)&#xD;&#xA;SELECT  @rptMonth, DATEADD(month,-6,@rptDay)&#xD;&#xA;		, DATEADD(day,1,@rptDay), 1&#xD;&#xA;OPTION  ( MAXDOP 1 );&#xD;&#xA;&#xD;&#xA;DECLARE @allVisits TABLE (rptMonth DATE, allVisits INT);&#xD;&#xA;&#xD;&#xA;INSERT INTO @allVisits&#xD;&#xA;SELECT DATEADD(M,-1,DATEADD(D,1,DATEADD(M,(DATEDIFF(m,-1,b.visitDate)),-1))) AS rptMonth&#xD;&#xA;	, SUM(b.Visits) AS allVisits&#xD;&#xA;FROM [dbo].[rptEcommLogiDashTrafficMart] b WITH ( NOLOCK )&#xD;&#xA;	JOIN @myDates md ON b.visitDate &gt;= DATEADD(D,1,DATEADD(M,(DATEDIFF(m,-1,md.startDate)),-1)) AND b.visitDate &lt; md.endDate&#xD;&#xA;		AND DATEPART(DAY, b.visitDate) &lt;= DATEPART(DAY, @rptDay) &#xD;&#xA;GROUP BY DATEADD(M,-1,DATEADD(D,1,DATEADD(M,(DATEDIFF(m,-1,b.visitDate)),-1)))&#xD;&#xA;OPTION  ( MAXDOP 1 );&#xD;&#xA;&#xD;&#xA;--select * from @allVisits;&#xD;&#xA;&#xD;&#xA;DECLARE @myResults TABLE (Metric VARCHAR(100) PRIMARY KEY, rptMonth DECIMAL(18, 4));&#xD;&#xA;&#xD;&#xA;DECLARE @myMetrics TABLE (SortOrder INT IDENTITY(1, 1), Country VARCHAR(100), Metric VARCHAR(100), metricFormat varchar(100));&#xD;&#xA;&#xD;&#xA;INSERT  INTO @myMetrics&#xD;&#xA;VALUES  ( '% of Total Visits', '% of Total Visits', '0.0%' ),&#xD;&#xA;        ( 'United States', '% of Total Visits', '0.0%' ),&#xD;&#xA;        ( 'Australia', '% of Total Visits', '0.0%' ),&#xD;&#xA;        ( 'Brazil', '% of Total Visits', '0.0%' ),&#xD;&#xA;        ( 'Canada', '% of Total Visits', '0.0%' ),&#xD;&#xA;        ( 'China', '% of Total Visits', '0.0%' ),&#xD;&#xA;        ( 'India', '% of Total Visits', '0.0%' ),&#xD;&#xA;        ( 'RoW', '% of Total Visits', '0.0%' ),&#xD;&#xA;        ( 'Spanish', '% of Total Visits', '0.0%' ),&#xD;&#xA;        ( 'United Kingdom', '% of Total Visits', '0.0%' ),&#xD;&#xA;        ( 'Conversion Rate', 'Conversion Rate', '0.0%' ),&#xD;&#xA;        ( 'United States', 'Conversion Rate', '0.0%' ),&#xD;&#xA;        ( 'Australia', 'Conversion Rate', '0.0%' ),&#xD;&#xA;        ( 'Brazil', 'Conversion Rate', '0.0%' ),&#xD;&#xA;        ( 'Canada', 'Conversion Rate', '0.0%' ),&#xD;&#xA;        ( 'China', 'Conversion Rate', '0.0%' ),&#xD;&#xA;        ( 'India', 'Conversion Rate', '0.0%' ),&#xD;&#xA;        ( 'RoW', 'Conversion Rate', '0.0%' ),&#xD;&#xA;        ( 'Spanish', 'Conversion Rate', '0.0%' ),&#xD;&#xA;        ( 'United Kingdom', 'Conversion Rate', '0.0%' );&#xD;&#xA;&#xD;&#xA;With mytable AS (&#xD;&#xA;				SELECT   DATEADD(M,-1,DATEADD(D,1,DATEADD(M,(DATEDIFF(m,-1,b.visitDate)),-1))) AS rptMonth ,&#xD;&#xA;								av.allVisits ,&#xD;&#xA;                                b.country ,&#xD;&#xA;                                CAST(SUM(visits) AS DECIMAL(18, 4))&#xD;&#xA;                                / av.AllVisits / COALESCE(1, md.Divisor) AS '% of Total Visits' ,&#xD;&#xA;                                CAST(SUM(orderingvisits) AS DECIMAL(18, 4))&#xD;&#xA;                                / SUM(visits) / COALESCE(1, md.Divisor) AS 'Conversion Rate'&#xD;&#xA;                       FROM     [dbo].[rptEcommLogiDashTrafficMart] b WITH ( NOLOCK )&#xD;&#xA;                                JOIN @myDates md ON b.visitDate &gt;= DATEADD(D,1,DATEADD(M,(DATEDIFF(m,-1,md.startDate)),-1)) AND b.visitDate &lt; md.endDate&#xD;&#xA;									AND DATEPART(DAY, b.visitDate) &lt;= DATEPART(DAY, @rptDay) &#xD;&#xA;								JOIN @allVisits av ON av.rptMonth = DATEADD(M,-1,DATEADD(D,1,DATEADD(M,(DATEDIFF(m,-1,b.visitDate)),-1)))&#xD;&#xA;                       GROUP BY DATEADD(M,-1,DATEADD(D,1,DATEADD(M,(DATEDIFF(m,-1,b.visitDate)),-1))) ,&#xD;&#xA;                                b.country ,&#xD;&#xA;                                av.AllVisits&#xD;&#xA;&#xD;&#xA;),&#xD;&#xA;pivoted AS&#xD;&#xA;	( SELECT   *&#xD;&#xA;				FROM     mytable UNPIVOT ( value FOR Metric IN ( [% of Total Visits],&#xD;&#xA;                                                              [Conversion Rate] ) ) up&#xD;&#xA;	)&#xD;&#xA;	SELECT mr.Country, mr.metric, mr.rptMonth, mr.Value&#xD;&#xA;    FROM pivoted mr&#xD;&#xA;		JOIN @myMetrics mm ON mm.Metric = mr.Metric AND mm.Country = mr.Country&#xD;&#xA;	WHERE mr.Country = '@Data.Country~' AND mr.Metric = '@Data.Metric~' &#xD;&#xA;	ORDER BY mm.SortOrder&#xD;&#xA;;&#xD;&#xA;&#xD;&#xA;" ConnectionID="connM1BIG-biLogiReporting" ID="dlMnthlyCountry">
                        <SqlParameters>
                          <SqlParameter Value="@Request.rptDay~" SqlParamType="dt-7" ID="@ReportDay" />
                        </SqlParameters>
                        <SortFilter SortColumn="rptMonth" DataType="Date" ID="sfMonth" SortSequence="Ascending" />
                      </DataLayer>
                      <FontLabel FontAngle="90" FontSize="8" FontColor="black" BorderColor="Black" />
                      <FontChartTitle FontSize="14" FontColor="Black" />
                      <FontData FontSize="8" FontColor="Black" BorderColor="Black" />
                      <FontYAxisTitle FontColor="Black" />
                      <LabelScale Format="MMM-yy" />
                      <DataScale Format="##0.0%" />
                    </Chart>
                  </TooltipPanel>
                </Label>
              </DataTableColumn>
              <DataTableColumn ID="colMTDGoal" Header="MTD Goal" Width="75" WidthScale="px" Class="ThemeAlignRight">
                <Label ID="lblMTDGoal" Caption="@Data.MtdGoal~" />
              </DataTableColumn>
              <DataTableColumn ID="colMTDVariance" Header="MTD Variance" Width="75" WidthScale="px" Class="ThemeAlignRight">
                <Label ID="lblMTDVariance" Caption="@Data.MTDVariance~">
                  <ConditionalClass Class="ThemeTextNegative" Condition="Left(&quot;@Data.MTDVariance~&quot;,1) = &quot;-&quot;" />
                </Label>
              </DataTableColumn>
            </DataTable>
          </Division>
        </Column>
      </Row>
    </Rows>
  </Body>
  <ReportFooter />
  <ideTestParams rptDay="" rptYesterday="" />
</Report>